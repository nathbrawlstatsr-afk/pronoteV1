<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCOLARIS - Tableau de bord</title>
    <style>
        :root {
            --couleur-principale: #2C3E50;
            --couleur-secondaire: #3498DB;
            --couleur-accent: #E74C3C;
            --couleur-success: #27AE60;
            --couleur-warning: #F39C12;
            --couleur-fond: #F8F9FA;
            --couleur-bordure: #E1E5E9;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
        }
        
        body {
            background-color: var(--couleur-fond);
            color: #333;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }
        
        /* Header */
        .header-principal {
            background-color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 0 20px;
            z-index: 100;
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--couleur-bordure);
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--couleur-principale);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--couleur-secondaire);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        /* Menu */
        .menu-horizontal {
            background-color: white;
            border-bottom: 1px solid var(--couleur-bordure);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .menu-items {
            display: flex;
            list-style: none;
            min-width: max-content;
        }
        
        .menu-item {
            padding: 15px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            color: #555;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
            transition: all 0.3s ease;
        }
        
        .menu-item:hover {
            background-color: #f8f9fa;
            color: var(--couleur-principale);
        }
        
        .menu-item.active {
            border-bottom-color: var(--couleur-secondaire);
            color: var(--couleur-secondaire);
            background-color: #f0f7ff;
        }
        
        /* Contenu */
        .contenu-principal {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
        }
        
        /* Styles communs */
        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .btn-primary {
            background-color: var(--couleur-secondaire);
            color: white;
        }
        
        .btn-secondary {
            background-color: white;
            color: var(--couleur-principale);
            border: 1px solid var(--couleur-bordure);
        }
        
        .btn-success {
            background-color: var(--couleur-success);
            color: white;
        }
        
        .btn-danger {
            background-color: var(--couleur-accent);
            color: white;
        }
        
        .btn-warning {
            background-color: var(--couleur-warning);
            color: white;
        }
        
        .btn-small {
            padding: 5px 10px;
            font-size: 0.85rem;
        }
        
        /* Cards */
        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border-top: 4px solid var(--couleur-secondaire);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .card-title {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .card-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--couleur-principale);
            margin-bottom: 5px;
        }
        
        /* Tableaux */
        .table-container {
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }
        
        .table-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--couleur-bordure);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .table-title {
            font-size: 1.1rem;
            color: var(--couleur-principale);
            font-weight: 600;
        }
        
        .table-content {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }
        
        th {
            background-color: #F8F9FA;
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: var(--couleur-principale);
            border-bottom: 1px solid var(--couleur-bordure);
            white-space: nowrap;
        }
        
        td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--couleur-bordure);
            vertical-align: top;
        }
        
        tr:hover {
            background-color: #f9f9f9;
        }
        
        /* Badges */
        .badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
        }
        
        .badge-success { background-color: #D5EDDA; color: #155724; }
        .badge-warning { background-color: #FFF3CD; color: #856404; }
        .badge-danger { background-color: #F8D7DA; color: #721C24; }
        .badge-info { background-color: #D1ECF1; color: #0C5460; }
        .badge-primary { background-color: #D6EAF8; color: #1B4F72; }
        
        /* Formulaires */
        .form-container {
            background-color: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }
        
        .form-title {
            font-size: 1.2rem;
            color: var(--couleur-principale);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--couleur-bordure);
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .form-group {
            flex: 1;
            min-width: 250px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--couleur-principale);
        }
        
        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--couleur-bordure);
            border-radius: 4px;
            font-size: 0.95rem;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--couleur-secondaire);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        /* Onglets */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--couleur-bordure);
            margin-bottom: 20px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .tab {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            color: #666;
            white-space: nowrap;
            transition: all 0.3s ease;
        }
        
        .tab:hover {
            color: var(--couleur-secondaire);
        }
        
        .tab.active {
            border-bottom-color: var(--couleur-secondaire);
            color: var(--couleur-secondaire);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 8px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalFadeIn 0.3s;
        }
        
        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--couleur-bordure);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 1.2rem;
            color: var(--couleur-principale);
            font-weight: 600;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
        
        .modal-body {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .modal-footer {
            padding: 20px;
            border-top: 1px solid var(--couleur-bordure);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        /* Mention l√©gale */
        .mention-legale {
            background-color: #FFF3CD;
            border: 1px solid #FFEAA7;
            padding: 15px;
            border-radius: 6px;
            margin-top: 30px;
            font-size: 0.9rem;
            color: #856404;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header-top {
                flex-direction: column;
                gap: 10px;
                padding: 15px 0;
            }
            
            .user-info {
                width: 100%;
                justify-content: space-between;
            }
            
            .contenu-principal {
                padding: 15px;
            }
            
            .form-row {
                flex-direction: column;
                gap: 15px;
            }
            
            .form-group {
                min-width: 100%;
            }
            
            .cards-container {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                width: 95%;
                max-height: 95vh;
            }
        }
        
        /* Calendrier emploi du temps */
        .emploi-container {
            display: grid;
            grid-template-columns: auto repeat(5, 1fr);
            gap: 1px;
            background-color: var(--couleur-bordure);
            border: 1px solid var(--couleur-bordure);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .emploi-jour {
            background-color: white;
            padding: 10px;
            text-align: center;
            font-weight: 600;
            color: var(--couleur-principale);
        }
        
        .emploi-creneau {
            background-color: white;
            padding: 10px;
            border-bottom: 1px solid var(--couleur-bordure);
        }
        
        .emploi-cell {
            background-color: white;
            padding: 10px;
            min-height: 80px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .emploi-cell:hover {
            background-color: #f0f7ff;
        }
        
        .cours-item {
            background-color: #e8f4fc;
            border-left: 4px solid var(--couleur-secondaire);
            padding: 8px;
            margin-bottom: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .cours-item:hover {
            background-color: #d4e9f8;
        }
        
        /* Observations */
        .observation-card {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .observation-positif {
            border-left-color: var(--couleur-success);
        }
        
        .observation-negatif {
            border-left-color: var(--couleur-accent);
        }
        
        .observation-comportement {
            border-left-color: var(--couleur-warning);
        }
        
        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--couleur-secondaire);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header class="header-principal">
        <div class="header-top">
            <div class="logo-container">
                <div class="logo">SCOLARIS</div>
                <div class="etablissement-info" id="etablissementInfo"></div>
            </div>
            <div class="user-info">
                <div class="user-details">
                    <div class="user-name" id="userName"></div>
                    <div class="user-role" id="userRole"></div>
                </div>
                <div class="user-avatar" id="userAvatar"></div>
                <button class="btn btn-secondary btn-small" onclick="deconnexion()">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
        <nav class="menu-horizontal">
            <ul class="menu-items" id="menuItems"></ul>
        </nav>
    </header>
    
    <main class="contenu-principal" id="contenuPrincipal">
        <!-- Le contenu sera inject√© ici par JavaScript -->
    </main>
    
    <div id="modalGenerique" class="modal"></div>
    
    <script>
        // ============================================
        // VARIABLES GLOBALES
        // ============================================
        let SCOLARIS_DATA = null;
        let utilisateurCourant = null;
        let currentView = 'dashboard';
        
        // ============================================
        // INITIALISATION
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            // V√©rifier la connexion
            if (!localStorage.getItem('SCOLARIS_DATA') || !localStorage.getItem('SCOLARIS_USER')) {
                window.location.href = 'index.html';
                return;
            }
            
            // Charger les donn√©es
            SCOLARIS_DATA = JSON.parse(localStorage.getItem('SCOLARIS_DATA'));
            utilisateurCourant = JSON.parse(localStorage.getItem('SCOLARIS_USER'));
            
            // Initialiser les donn√©es si n√©cessaire
            initialiserDonneesParDefaut();
            
            // Afficher les informations
            afficherInformationsEtablissement();
            afficherInformationsUtilisateur();
            genererMenu();
            
            // Afficher le tableau de bord par d√©faut
            afficherTableauDeBord();
            
            // Gestion du modal
            document.getElementById('modalGenerique').addEventListener('click', function(e) {
                if (e.target === this) {
                    fermerModal();
                }
            });
            
            // Initialiser le responsive
            window.addEventListener('resize', gererResponsive);
        });
        
        function initialiserDonneesParDefaut() {
            let doitSauvegarder = false;
            
            // Initialiser les mati√®res si vide
            if (!SCOLARIS_DATA.matieres || SCOLARIS_DATA.matieres.length === 0) {
                SCOLARIS_DATA.matieres = [
                    { id: 1, nom: "Fran√ßais", coefficient: 3, couleur: "#4A6FA5" },
                    { id: 2, nom: "Math√©matiques", coefficient: 3, couleur: "#D96459" },
                    { id: 3, nom: "Histoire-G√©ographie", coefficient: 2, couleur: "#388659" },
                    { id: 4, nom: "Sciences de la Vie et de la Terre", coefficient: 2, couleur: "#8E6C88" },
                    { id: 5, nom: "Langue Vivante A (Anglais)", coefficient: 2, couleur: "#3498DB" },
                    { id: 6, nom: "Physique-Chimie", coefficient: 2, couleur: "#F39C12" },
                    { id: 7, nom: "Technologie", coefficient: 1, couleur: "#8E44AD" },
                    { id: 8, nom: "√âducation Musicale", coefficient: 1, couleur: "#16A085" },
                    { id: 9, nom: "Arts Plastiques", coefficient: 1, couleur: "#D35400" },
                    { id: 10, nom: "√âducation Physique et Sportive", coefficient: 1, couleur: "#C0392B" }
                ];
                doitSauvegarder = true;
            }
            
            // Initialiser les cours si vide
            if (!SCOLARIS_DATA.cours || SCOLARIS_DATA.cours.length === 0) {
                SCOLARIS_DATA.cours = [];
            }
            
            // Initialiser les classes si vide
            if (!SCOLARIS_DATA.classes || SCOLARIS_DATA.classes.length === 0) {
                SCOLARIS_DATA.classes = [];
                doitSauvegarder = true;
            }
            
            // Initialiser les autres tableaux si n√©cessaire
            if (!SCOLARIS_DATA.eleves) SCOLARIS_DATA.eleves = [];
            if (!SCOLARIS_DATA.notes) SCOLARIS_DATA.notes = [];
            if (!SCOLARIS_DATA.observations) SCOLARIS_DATA.observations = [];
            if (!SCOLARIS_DATA.exclusions) SCOLARIS_DATA.exclusions = [];
            if (!SCOLARIS_DATA.absences) SCOLARIS_DATA.absences = [];
            if (!SCOLARIS_DATA.retards) SCOLARIS_DATA.retards = [];
            if (!SCOLARIS_DATA.devoirs) SCOLARIS_DATA.devoirs = [];
            if (!SCOLARIS_DATA.emploi_du_temps) SCOLARIS_DATA.emploi_du_temps = [];
            if (!SCOLARIS_DATA.messages) SCOLARIS_DATA.messages = [];
            if (!SCOLARIS_DATA.documents) SCOLARIS_DATA.documents = [];
            
            if (doitSauvegarder) {
                sauvegarderDonnees();
            }
        }
        
        // ============================================
        // FONCTIONS UTILITAIRES
        // ============================================
        function sauvegarderDonnees() {
            localStorage.setItem('SCOLARIS_DATA', JSON.stringify(SCOLARIS_DATA));
        }
        
        function formatDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            return date.toLocaleDateString('fr-FR');
        }
        
        function formatHeure(heureStr) {
            if (!heureStr) return '';
            return heureStr.substring(0, 5);
        }
        
        function ouvrirModal(html) {
            document.getElementById('modalGenerique').innerHTML = html;
            document.getElementById('modalGenerique').style.display = 'flex';
        }
        
        function fermerModal() {
            document.getElementById('modalGenerique').style.display = 'none';
        }
        
        function setActiveMenu(menuId) {
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.menu === menuId) {
                    item.classList.add('active');
                }
            });
        }
        
        function deconnexion() {
            if (confirm('√ätes-vous s√ªr de vouloir vous d√©connecter ?')) {
                localStorage.removeItem('SCOLARIS_USER');
                window.location.href = 'index.html';
            }
        }
        
        function afficherInformationsEtablissement() {
            const etablissement = SCOLARIS_DATA.system.etablissement;
            document.getElementById('etablissementInfo').innerHTML = `
                <div>${etablissement.nom}</div>
                <div style="font-size: 0.8rem; color: #666;">${etablissement.annee_scolaire}</div>
            `;
        }
        
        function afficherInformationsUtilisateur() {
            document.getElementById('userName').textContent = `${utilisateurCourant.prenom} ${utilisateurCourant.nom}`;
            document.getElementById('userRole').textContent = 
                SCOLARIS_DATA.roles.find(r => r.id === utilisateurCourant.role)?.nom || utilisateurCourant.role;
            document.getElementById('userAvatar').textContent = 
                utilisateurCourant.prenom.charAt(0) + utilisateurCourant.nom.charAt(0);
        }
        
        function gererResponsive() {
            // Adaptation responsive du menu
            const menuItems = document.querySelector('.menu-items');
            if (window.innerWidth < 768) {
                menuItems.style.fontSize = '0.9rem';
            } else {
                menuItems.style.fontSize = '1rem';
            }
        }
        
        function genererMenu() {
            let menuHtml = '';
            const role = utilisateurCourant.role;
            
            if (role === 'admin_systeme' || role === 'proviseur' || role === 'proviseur_adjoint') {
                menuHtml = `
                    <li class="menu-item active" data-menu="dashboard" onclick="afficherTableauDeBord()">
                        <i class="fas fa-tachometer-alt"></i> Tableau de bord
                    </li>
                    <li class="menu-item" data-menu="carnet" onclick="afficherCarnetComplet()">
                        <i class="fas fa-book"></i> Carnet scolaire
                    </li>
                    <li class="menu-item" data-menu="utilisateurs" onclick="afficherGestionUtilisateurs()">
                        <i class="fas fa-users-cog"></i> Utilisateurs
                    </li>
                    <li class="menu-item" data-menu="eleves" onclick="afficherGestionEleves()">
                        <i class="fas fa-user-graduate"></i> √âl√®ves
                    </li>
                    <li class="menu-item" data-menu="enseignants" onclick="afficherGestionEnseignants()">
                        <i class="fas fa-chalkboard-teacher"></i> Enseignants
                    </li>
                    <li class="menu-item" data-menu="classes" onclick="afficherGestionClasses()">
                        <i class="fas fa-users"></i> Classes
                    </li>
                    <li class="menu-item" data-menu="matieres" onclick="afficherGestionMatieres()">
                        <i class="fas fa-book-open"></i> Mati√®res
                    </li>
                    <li class="menu-item" data-menu="cours" onclick="afficherGestionCours()">
                        <i class="fas fa-calendar-alt"></i> Cours
                    </li>
                    <li class="menu-item" data-menu="emploi_temps" onclick="afficherEmploiDuTemps()">
                        <i class="fas fa-calendar-week"></i> Emploi du temps
                    </li>
                    <li class="menu-item" data-menu="parametres" onclick="afficherParametres()">
                        <i class="fas fa-cog"></i> Param√®tres
                    </li>
                `;
            } else if (role === 'enseignant') {
                menuHtml = `
                    <li class="menu-item active" data-menu="dashboard" onclick="afficherTableauDeBord()">
                        <i class="fas fa-tachometer-alt"></i> Tableau de bord
                    </li>
                    <li class="menu-item" data-menu="mes_classes" onclick="afficherMesClasses()">
                        <i class="fas fa-chalkboard-teacher"></i> Mes classes
                    </li>
                    <li class="menu-item" data-menu="carnet" onclick="afficherCarnetComplet()">
                        <i class="fas fa-book"></i> Carnet de notes
                    </li>
                    <li class="menu-item" data-menu="emploi_temps" onclick="afficherEmploiDuTemps()">
                        <i class="fas fa-calendar-alt"></i> Emploi du temps
                    </li>
                    <li class="menu-item" data-menu="devoirs" onclick="afficherGestionDevoirs()">
                        <i class="fas fa-tasks"></i> Devoirs
                    </li>
                    <li class="menu-item" data-menu="cours" onclick="afficherGestionCours()">
                        <i class="fas fa-calendar-alt"></i> Mes cours
                    </li>
                `;
            } else if (role === 'eleve') {
                menuHtml = `
                    <li class="menu-item active" data-menu="dashboard" onclick="afficherTableauDeBordEleve()">
                        <i class="fas fa-tachometer-alt"></i> Tableau de bord
                    </li>
                    <li class="menu-item" data-menu="mes_notes" onclick="afficherMesNotes()">
                        <i class="fas fa-graduation-cap"></i> Mes notes
                    </li>
                    <li class="menu-item" data-menu="emploi_temps" onclick="afficherEmploiDuTempsEleve()">
                        <i class="fas fa-calendar-alt"></i> Emploi du temps
                    </li>
                    <li class="menu-item" data-menu="devoirs" onclick="afficherMesDevoirs()">
                        <i class="fas fa-tasks"></i> Mes devoirs
                    </li>
                `;
            }
            
            document.getElementById('menuItems').innerHTML = menuHtml;
        }
        
        // ============================================
        // TABLEAU DE BORD
        // ============================================
        function afficherTableauDeBord() {
            currentView = 'dashboard';
            const totalEleves = SCOLARIS_DATA.eleves.length;
            const totalClasses = SCOLARIS_DATA.classes.length;
            const totalEnseignants = SCOLARIS_DATA.utilisateurs.filter(u => u.role === 'enseignant' && u.actif).length;
            const today = new Date().toISOString().split('T')[0];
            const absencesAujourdhui = SCOLARIS_DATA.absences.filter(a => a.date === today).length;
            
            document.getElementById('contenuPrincipal').innerHTML = `
                <h1 style="margin-bottom: 25px; color: var(--couleur-principale);">Tableau de bord</h1>
                
                <div class="cards-container">
                    <div class="card" onclick="afficherGestionEleves()" style="cursor: pointer;">
                        <div class="card-title"><i class="fas fa-user-graduate"></i> √âl√®ves inscrits</div>
                        <div class="card-value">${totalEleves}</div>
                        <div class="card-subtitle">Total de l'√©tablissement</div>
                    </div>
                    <div class="card" onclick="afficherGestionClasses()" style="cursor: pointer;">
                        <div class="card-title"><i class="fas fa-users"></i> Classes</div>
                        <div class="card-value">${totalClasses}</div>
                        <div class="card-subtitle">Classes actives</div>
                    </div>
                    <div class="card" onclick="afficherGestionEnseignants()" style="cursor: pointer;">
                        <div class="card-title"><i class="fas fa-chalkboard-teacher"></i> Enseignants</div>
                        <div class="card-value">${totalEnseignants}</div>
                        <div class="card-subtitle">Personnel enseignant</div>
                    </div>
                    <div class="card" onclick="afficherCarnetComplet()" style="cursor: pointer;">
                        <div class="card-title"><i class="fas fa-user-clock"></i> Absences aujourd'hui</div>
                        <div class="card-value">${absencesAujourdhui}</div>
                        <div class="card-subtitle">√âl√®ves absents</div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group" style="flex: 2;">
                        <div class="table-container">
                            <div class="table-header">
                                <div class="table-title">Derni√®res activit√©s</div>
                            </div>
                            <div class="table-content">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Type</th>
                                            <th>Description</th>
                                            <th>Utilisateur</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>${new Date().toLocaleDateString('fr-FR')}</td>
                                            <td><span class="badge badge-success">Connexion</span></td>
                                            <td>Vous √™tes connect√©(e)</td>
                                            <td>${utilisateurCourant.prenom} ${utilisateurCourant.nom}</td>
                                        </tr>
                                        ${totalEleves === 0 ? `
                                        <tr>
                                            <td>Aujourd'hui</td>
                                            <td><span class="badge badge-warning">Action</span></td>
                                            <td>Ajoutez vos premiers √©l√®ves</td>
                                            <td>Syst√®me</td>
                                        </tr>` : ''}
                                        ${SCOLARIS_DATA.observations.slice(-3).reverse().map(obs => {
                                            const eleve = SCOLARIS_DATA.eleves.find(e => e.id === obs.eleve_id);
                                            return `
                                                <tr>
                                                    <td>${formatDate(obs.date)}</td>
                                                    <td><span class="badge ${obs.type === 'positif' ? 'badge-success' : 'badge-danger'}">Observation</span></td>
                                                    <td>${obs.contenu.substring(0, 50)}...</td>
                                                    <td>${eleve ? eleve.prenom + ' ' + eleve.nom : 'Inconnu'}</td>
                                                </tr>
                                            `;
                                        }).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <div class="table-container">
                            <div class="table-header">
                                <div class="table-title">Actions rapides</div>
                            </div>
                            <div class="table-content" style="padding: 15px;">
                                <div style="display: flex; flex-direction: column; gap: 10px;">
                                    ${(utilisateurCourant.role === 'admin_systeme' || utilisateurCourant.role === 'proviseur' || utilisateurCourant.role === 'proviseur_adjoint') ? `
                                    <button class="btn btn-primary" onclick="afficherGestionUtilisateurs()">
                                        <i class="fas fa-user-plus"></i> Ajouter un utilisateur
                                    </button>
                                    <button class="btn btn-primary" onclick="afficherGestionEleves()">
                                        <i class="fas fa-user-graduate"></i> Inscrire un √©l√®ve
                                    </button>
                                    <button class="btn btn-primary" onclick="afficherGestionEnseignants()">
                                        <i class="fas fa-chalkboard-teacher"></i> Ajouter un enseignant
                                    </button>
                                    ` : ''}
                                    ${(utilisateurCourant.role === 'enseignant') ? `
                                    <button class="btn btn-primary" onclick="afficherCarnetComplet()">
                                        <i class="fas fa-book"></i> Saisir des notes
                                    </button>
                                    <button class="btn btn-primary" onclick="afficherEmploiDuTemps()">
                                        <i class="fas fa-calendar-alt"></i> Voir mon emploi du temps
                                    </button>
                                    ` : ''}
                                    <button class="btn btn-secondary" onclick="afficherParametres()">
                                        <i class="fas fa-cog"></i> Param√®tres
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mention-legale">
                    <i class="fas fa-exclamation-circle"></i>
                    Cette plateforme est une simulation fictive √† usage p√©dagogique.
                </div>
            `;
            setActiveMenu('dashboard');
        }
        
        // ============================================
        // CARNET SCOLAIRE COMPLET
        // ============================================
        function afficherCarnetComplet() {
            currentView = 'carnet';
            document.getElementById('contenuPrincipal').innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h1 style="color: var(--couleur-principale);">Carnet scolaire</h1>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" onclick="ouvrirModalNouvelleNote()">
                            <i class="fas fa-plus"></i> Nouvelle note
                        </button>
                        <button class="btn btn-primary" onclick="ouvrirModalNouvelleObservation()">
                            <i class="fas fa-comment-alt"></i> Observation
                        </button>
                        <button class="btn btn-primary" onclick="ouvrirModalNouvelleExclusion()">
                            <i class="fas fa-user-slash"></i> Sanction
                        </button>
                        <button class="btn btn-primary" onclick="ouvrirModalNouvelleAbsence()">
                            <i class="fas fa-user-times"></i> Absence
                        </button>
                    </div>
                </div>
                
                <div class="tabs">
                    <div class="tab active" onclick="changerOngletCarnet('notes')">Notes</div>
                    <div class="tab" onclick="changerOngletCarnet('observations')">Observations</div>
                    <div class="tab" onclick="changerOngletCarnet('exclusions')">Sanctions</div>
                    <div class="tab" onclick="changerOngletCarnet('absences')">Absences</div>
                    <div class="tab" onclick="changerOngletCarnet('retards')">Retards</div>
                </div>
                
                <div id="contenuCarnet">
                    ${genererContenuCarnetNotes()}
                </div>
            `;
            setActiveMenu('carnet');
        }
        
        function genererContenuCarnetNotes() {
            return `
                <div class="form-container">
                    <h3 class="form-title">Saisie des notes</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Classe</label>
                            <select class="form-control" id="filtreClasseNotes" onchange="filtrerNotesParClasse()">
                                <option value="">Toutes les classes</option>
                                ${SCOLARIS_DATA.classes.map(classe => 
                                    `<option value="${classe.id}">${classe.nom}</option>`
                                ).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Mati√®re</label>
                            <select class="form-control" id="filtreMatiereNotes" onchange="filtrerNotesParMatiere()">
                                <option value="">Toutes les mati√®res</option>
                                ${SCOLARIS_DATA.matieres.map(matiere => 
                                    `<option value="${matiere.id}">${matiere.nom}</option>`
                                ).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Type d'√©valuation</label>
                            <select class="form-control" id="filtreTypeNotes">
                                <option value="">Tous les types</option>
                                <option value="devoir">Devoir</option>
                                <option value="interrogation">Interrogation</option>
                                <option value="examen">Examen</option>
                                <option value="participation">Participation</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <div class="table-header">
                            <div class="table-title">Notes des √©l√®ves</div>
                            <button class="btn btn-secondary btn-small" onclick="exporterNotes()">
                                <i class="fas fa-file-export"></i> Exporter
                            </button>
                        </div>
                        <div class="table-content">
                            <table>
                                <thead>
                                    <tr>
                                        <th>√âl√®ve</th>
                                        <th>Classe</th>
                                        <th>Mati√®re</th>
                                        <th>Note</th>
                                        <th>Coefficient</th>
                                        <th>Type</th>
                                        <th>Date</th>
                                        <th>Commentaire</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${SCOLARIS_DATA.notes.map(note => {
                                        const eleve = SCOLARIS_DATA.eleves.find(e => e.id === note.eleve_id);
                                        const classe = eleve ? SCOLARIS_DATA.classes.find(c => c.id === eleve.classe_id) : null;
                                        const matiere = SCOLARIS_DATA.matieres.find(m => m.id === note.matiere_id);
                                        return `
                                            <tr>
                                                <td>${eleve ? eleve.prenom + ' ' + eleve.nom : 'Inconnu'}</td>
                                                <td>${classe ? classe.nom : 'Non affect√©'}</td>
                                                <td>${matiere ? matiere.nom : 'Inconnue'}</td>
                                                <td><strong>${note.valeur}/20</strong></td>
                                                <td>${note.coefficient || 1}</td>
                                                <td><span class="badge badge-info">${note.type || 'Devoir'}</span></td>
                                                <td>${formatDate(note.date)}</td>
                                                <td>${note.commentaire || ''}</td>
                                                <td>
                                                    <div style="display: flex; gap: 5px;">
                                                        <button class="btn btn-secondary btn-small" onclick="modifierNote(${note.id})">
                                                            <i class="fas fa-edit"></i>
                                                        </button>
                                                        <button class="btn btn-danger btn-small" onclick="supprimerNote(${note.id})">
                                                            <i class="fas fa-trash"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        `;
                                    }).join('')}
                                    ${SCOLARIS_DATA.notes.length === 0 ? `
                                    <tr>
                                        <td colspan="9" style="text-align: center; padding: 30px; color: #666;">
                                            <i class="fas fa-graduation-cap" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                                            Aucune note enregistr√©e. Commencez par saisir des notes.
                                        </td>
                                    </tr>` : ''}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function changerOngletCarnet(tab) {
            // Activer l'onglet
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => {
                if (t.textContent.includes(tab)) t.classList.add('active');
            });
            
            let contenu = '';
            
            switch(tab) {
                case 'notes':
                    contenu = genererContenuCarnetNotes();
                    break;
                    
                case 'observations':
                    contenu = `
                        <div class="form-container">
                            <h3 class="form-title">Observations sur les √©l√®ves</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Filtrer par type</label>
                                    <select class="form-control" onchange="filtrerObservations(this.value)">
                                        <option value="">Tous les types</option>
                                        <option value="positif">Positif</option>
                                        <option value="negatif">N√©gatif</option>
                                        <option value="comportement">Comportement</option>
                                        <option value="travail">Travail</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div style="display: flex; flex-direction: column; gap: 15px;">
                                ${SCOLARIS_DATA.observations.map(obs => {
                                    const eleve = SCOLARIS_DATA.eleves.find(e => e.id === obs.eleve_id);
                                    const classe = eleve ? SCOLARIS_DATA.classes.find(c => c.id === eleve.classe_id) : null;
                                    const enseignant = SCOLARIS_DATA.utilisateurs.find(u => u.id === obs.enseignant_id);
                                    const typeClass = {
                                        'positif': 'observation-positif',
                                        'negatif': 'observation-negatif',
                                        'comportement': 'observation-comportement',
                                        'travail': 'observation-positif'
                                    }[obs.type] || 'observation-positif';
                                    
                                    return `
                                        <div class="observation-card ${typeClass}">
                                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                                <div>
                                                    <strong>${eleve ? eleve.prenom + ' ' + eleve.nom : '√âl√®ve inconnu'}</strong>
                                                    <span style="color: #666; margin-left: 10px;">${classe ? classe.nom : ''}</span>
                                                </div>
                                                <div style="color: #666; font-size: 0.9rem;">
                                                    ${formatDate(obs.date)}
                                                </div>
                                            </div>
                                            <div style="margin-bottom: 10px;">
                                                <span class="badge ${obs.type === 'positif' ? 'badge-success' : 'badge-danger'}">
                                                    ${obs.type === 'positif' ? 'üëç Positif' : 
                                                      obs.type === 'negatif' ? 'üëé N√©gatif' : 
                                                      obs.type === 'comportement' ? 'üòê Comportement' : 'üìö Travail'}
                                                </span>
                                            </div>
                                            <p style="margin-bottom: 10px;">${obs.contenu}</p>
                                            <div style="font-size: 0.9rem; color: #666; display: flex; justify-content: space-between;">
                                                <div>
                                                    Par: ${enseignant ? enseignant.prenom + ' ' + enseignant.nom : 'Enseignant inconnu'}
                                                </div>
                                                <div>
                                                    <button class="btn btn-secondary btn-small" onclick="modifierObservation(${obs.id})">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button class="btn btn-danger btn-small" onclick="supprimerObservation(${obs.id})">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                                
                                ${SCOLARIS_DATA.observations.length === 0 ? `
                                <div style="text-align: center; padding: 40px; color: #666;">
                                    <i class="fas fa-comment-alt" style="font-size: 3rem; margin-bottom: 20px;"></i>
                                    <h3>Aucune observation</h3>
                                    <p>Commencez par cr√©er des observations sur les √©l√®ves.</p>
                                </div>` : ''}
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'exclusions':
                    contenu = `
                        <div class="form-container">
                            <h3 class="form-title">Sanctions et exclusions</h3>
                            <div class="table-container">
                                <div class="table-header">
                                    <div class="table-title">Liste des sanctions</div>
                                </div>
                                <div class="table-content">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>√âl√®ve</th>
                                                <th>Classe</th>
                                                <th>Type</th>
                                                <th>Dur√©e</th>
                                                <th>Date d√©but</th>
                                                <th>Date fin</th>
                                                <th>Motif</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${SCOLARIS_DATA.exclusions.map(exclusion => {
                                                const eleve = SCOLARIS_DATA.eleves.find(e => e.id === exclusion.eleve_id);
                                                const classe = eleve ? SCOLARIS_DATA.classes.find(c => c.id === eleve.classe_id) : null;
                                                return `
                                                    <tr>
                                                        <td>${eleve ? eleve.prenom + ' ' + eleve.nom : 'Inconnu'}</td>
                                                        <td>${classe ? classe.nom : 'Non affect√©'}</td>
                                                        <td><span class="badge badge-danger">${exclusion.type}</span></td>
                                                        <td>${exclusion.duree}</td>
                                                        <td>${formatDate(exclusion.date_debut)}</td>
                                                        <td>${formatDate(exclusion.date_fin)}</td>
                                                        <td>${exclusion.motif}</td>
                                                        <td>
                                                            <div style="display: flex; gap: 5px;">
                                                                <button class="btn btn-secondary btn-small" onclick="modifierExclusion(${exclusion.id})">
                                                                    <i class="fas fa-edit"></i>
                                                                </button>
                                                                <button class="btn btn-danger btn-small" onclick="supprimerExclusion(${exclusion.id})">
                                                                    <i class="fas fa-trash"></i>
                                                                </button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                `;
                                            }).join('')}
                                            ${SCOLARIS_DATA.exclusions.length === 0 ? `
                                            <tr>
                                                <td colspan="8" style="text-align: center; padding: 30px; color: #666;">
                                                    <i class="fas fa-user-slash" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                                                    Aucune sanction enregistr√©e.
                                                </td>
                                            </tr>` : ''}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'absences':
                    contenu = `
                        <div class="form-container">
                            <h3 class="form-title">Gestion des absences</h3>
                            <div class="table-container">
                                <div class="table-header">
                                    <div class="table-title">Absences des √©l√®ves</div>
                                </div>
                                <div class="table-content">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>√âl√®ve</th>
                                                <th>Classe</th>
                                                <th>Date</th>
                                                <th>Type</th>
                                                <th>Justifi√©e</th>
                                                <th>Motif</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${SCOLARIS_DATA.absences.map(absence => {
                                                const eleve = SCOLARIS_DATA.eleves.find(e => e.id === absence.eleve_id);
                                                const classe = eleve ? SCOLARIS_DATA.classes.find(c => c.id === eleve.classe_id) : null;
                                                return `
                                                    <tr>
                                                        <td>${eleve ? eleve.prenom + ' ' + eleve.nom : 'Inconnu'}</td>
                                                        <td>${classe ? classe.nom : 'Non affect√©'}</td>
                                                        <td>${formatDate(absence.date)}</td>
                                                        <td><span class="badge badge-warning">${absence.type || 'Absence'}</span></td>
                                                        <td>${absence.justifiee ? 
                                                            '<span class="badge badge-success">Oui</span>' : 
                                                            '<span class="badge badge-danger">Non</span>'}</td>
                                                        <td>${absence.motif || ''}</td>
                                                        <td>
                                                            <div style="display: flex; gap: 5px;">
                                                                <button class="btn btn-secondary btn-small" onclick="modifierAbsence(${absence.id})">
                                                                    <i class="fas fa-edit"></i>
                                                                </button>
                                                                <button class="btn btn-danger btn-small" onclick="supprimerAbsence(${absence.id})">
                                                                    <i class="fas fa-trash"></i>
                                                                </button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                `;
                                            }).join('')}
                                            ${SCOLARIS_DATA.absences.length === 0 ? `
                                            <tr>
                                                <td colspan="7" style="text-align: center; padding: 30px; color: #666;">
                                                    <i class="fas fa-user-times" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                                                    Aucune absence enregistr√©e.
                                                </td>
                                            </tr>` : ''}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'retards':
                    contenu = `
                        <div class="form-container">
                            <h3 class="form-title">Gestion des retards</h3>
                            <div class="table-container">
                                <div class="table-header">
                                    <div class="table-title">Retards des √©l√®ves</div>
                                </div>
                                <div class="table-content">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>√âl√®ve</th>
                                                <th>Classe</th>
                                                <th>Date</th>
                                                <th>Heure</th>
                                                <th>Dur√©e</th>
                                                <th>Justifi√©</th>
                                                <th>Motif</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${SCOLARIS_DATA.retards.map(retard => {
                                                const eleve = SCOLARIS_DATA.eleves.find(e => e.id === retard.eleve_id);
                                                const classe = eleve ? SCOLARIS_DATA.classes.find(c => c.id === eleve.classe_id) : null;
                                                return `
                                                    <tr>
                                                        <td>${eleve ? eleve.prenom + ' ' + eleve.nom : 'Inconnu'}</td>
                                                        <td>${classe ? classe.nom : 'Non affect√©'}</td>
                                                        <td>${formatDate(retard.date)}</td>
                                                        <td>${retard.heure || ''}</td>
                                                        <td>${retard.duree || ''}</td>
                                                        <td>${retard.justifie ? 
                                                            '<span class="badge badge-success">Oui</span>' : 
                                                            '<span class="badge badge-danger">Non</span>'}</td>
                                                        <td>${retard.motif || ''}</td>
                                                        <td>
                                                            <div style="display: flex; gap: 5px;">
                                                                <button class="btn btn-secondary btn-small" onclick="modifierRetard(${retard.id})">
                                                                    <i class="fas fa-edit"></i>
                                                                </button>
                                                                <button class="btn btn-danger btn-small" onclick="supprimerRetard(${retard.id})">
                                                                    <i class="fas fa-trash"></i>
                                                                </button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                `;
                                            }).join('')}
                                            ${SCOLARIS_DATA.retards.length === 0 ? `
                                            <tr>
                                                <td colspan="8" style="text-align: center; padding: 30px; color: #666;">
                                                    <i class="fas fa-clock" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                                                    Aucun retard enregistr√©.
                                                </td>
                                            </tr>` : ''}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
            }
            
            document.getElementById('contenuCarnet').innerHTML = contenu;
        }
        
        // ============================================
        // MODALES DE SAISIE
        // ============================================
        
        function ouvrirModalNouvelleNote() {
            const modalHtml = `
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">üìù Nouvelle note</div>
                        <button class="modal-close" onclick="fermerModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <form id="formNouvelleNote">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>√âl√®ve *</label>
                                    <select class="form-control" id="noteEleve" required>
                                        <option value="">S√©lectionner un √©l√®ve</option>
                                        ${SCOLARIS_DATA.eleves.map(eleve => {
                                            const classe = SCOLARIS_DATA.classes.find(c => c.id === eleve.classe_id);
                                            return `<option value="${eleve.id}">${eleve.nom} ${eleve.prenom} - ${classe ? classe.nom : 'Non affect√©'}</option>`;
                                        }).join('')}
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Mati√®re *</label>
                                    <select class="form-control" id="noteMatiere" required>
                                        <option value="">S√©lectionner une mati√®re</option>
                                        ${SCOLARIS_DATA.matieres.map(matiere => 
                                            `<option value="${matiere.id}">${matiere.nom}</option>`
                                        ).join('')}
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Note (sur 20) *</label>
                                    <input type="number" class="form-control" id="noteValeur" 
                                           min="0" max="20" step="0.5" required>
                                </div>
                                <div class="form-group">
                                    <label>Coefficient</label>
                                    <input type="number" class="form-control" id="noteCoefficient" 
                                           value="1" min="1" max="10">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Type d'√©valuation</label>
                                    <select class="form-control" id="noteType">
                                        <option value="devoir">Devoir</option>
                                        <option value="interrogation">Interrogation</option>
                                        <option value="examen">Examen</option>
                                        <option value="participation">Participation</option>
                                        <option value="oral">Oral</option>
                                        <option value="pratique">Pratique</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Date</label>
                                    <input type="date" class="form-control" id="noteDate" 
                                           value="${new Date().toISOString().split('T')[0]}">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group" style="flex: 2;">
                                    <label>Commentaire</label>
                                    <textarea class="form-control" id="noteCommentaire" rows="3"></textarea>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="fermerModal()">Annuler</button>
                        <button class="btn btn-primary" onclick="creerNouvelleNote()">
                            <i class="fas fa-save"></i> Enregistrer la note
                        </button>
                    </div>
                </div>
            `;
            ouvrirModal(modalHtml);
        }
        
        function creerNouvelleNote() {
            const eleveId = document.getElementById('noteEleve').value;
            const matiereId = document.getElementById('noteMatiere').value;
            const valeur = parseFloat(document.getElementById('noteValeur').value);
            const coefficient = parseInt(document.getElementById('noteCoefficient').value) || 1;
            const type = document.getElementById('noteType').value;
            const date = document.getElementById('noteDate').value || new Date().toISOString().split('T')[0];
            const commentaire = document.getElementById('noteCommentaire').value;
            
            if (!eleveId || !matiereId || isNaN(valeur)) {
                alert('Veuillez remplir tous les champs obligatoires');
                return;
            }
            
            if (valeur < 0 || valeur > 20) {
                alert('La note doit √™tre comprise entre 0 et 20');
                return;
            }
            
            const nouvelId = Math.max(...SCOLARIS_DATA.notes.map(n => n.id), 0) + 1;
            const nouvelleNote = {
                id: nouvelId,
                eleve_id: parseInt(eleveId),
                matiere_id: parseInt(matiereId),
                valeur: valeur,
                coefficient: coefficient,
                type: type,
                date: date,
                commentaire: commentaire,
                created_at: new Date().toISOString()
            };
            
            SCOLARIS_DATA.notes.push(nouvelleNote);
            sauvegarderDonnees();
            alert('Note enregistr√©e avec succ√®s !');
            fermerModal();
            afficherCarnetComplet();
        }
        
        function ouvrirModalNouvelleObservation() {
            const modalHtml = `
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">üìã Nouvelle observation</div>
                        <button class="modal-close" onclick="fermerModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <form id="formNouvelleObservation">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>√âl√®ve concern√© *</label>
                                    <select class="form-control" id="observationEleve" required>
                                        <option value="">S√©lectionner un √©l√®ve</option>
                                        ${SCOLARIS_DATA.eleves.map(eleve => {
                                            const classe = SCOLARIS_DATA.classes.find(c => c.id === eleve.classe_id);
                                            return `<option value="${eleve.id}">${eleve.nom} ${eleve.prenom} - ${classe ? classe.nom : 'Non affect√©'}</option>`;
                                        }).join('')}
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Type d'observation *</label>
                                    <select class="form-control" id="observationType" required>
                                        <option value="positif">üëç Positif</option>
                                        <option value="negatif">üëé N√©gatif</option>
                                        <option value="comportement">üòê Comportement</option>
                                        <option value="travail">üìö Travail</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Date</label>
                                    <input type="date" class="form-control" id="observationDate" 
                                           value="${new Date().toISOString().split('T')[0]}">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group" style="flex: 2;">
                                    <label>Contenu de l'observation *</label>
                                    <textarea class="form-control" id="observationContenu" rows="5" required
                                              placeholder="D√©crivez l'observation..."></textarea>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="fermerModal()">Annuler</button>
                        <button class="btn btn-primary" onclick="creerNouvelleObservation()">
                            <i class="fas fa-save"></i> Enregistrer l'observation
                        </button>
                    </div>
                </div>
            `;
            ouvrirModal(modalHtml);
        }
        
        function creerNouvelleObservation() {
            const eleveId = document.getElementById('observationEleve').value;
            const type = document.getElementById('observationType').value;
            const date = document.getElementById('observationDate').value || new Date().toISOString().split('T')[0];
            const contenu = document.getElementById('observationContenu').value;
            
            if (!eleveId || !contenu) {
                alert('Veuillez remplir tous les champs obligatoires');
                return;
            }
            
            const nouvelId = Math.max(...SCOLARIS_DATA.observations.map(o => o.id), 0) + 1;
            const nouvelleObservation = {
                id: nouvelId,
                eleve_id: parseInt(eleveId),
                type: type,
                date: date,
                contenu: contenu,
                enseignant_id: utilisateurCourant.id,
                created_at: new Date().toISOString()
            };
            
            SCOLARIS_DATA.observations.push(nouvelleObservation);
            sauvegarderDonnees();
            alert('Observation enregistr√©e avec succ√®s !');
            fermerModal();
            afficherCarnetComplet();
        }
        
        function ouvrirModalNouvelleExclusion() {
            const modalHtml = `
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">‚öñÔ∏è Nouvelle sanction</div>
                        <button class="modal-close" onclick="fermerModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <form id="formNouvelleExclusion">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>√âl√®ve sanctionn√© *</label>
                                    <select class="form-control" id="exclusionEleve" required>
                                        <option value="">S√©lectionner un √©l√®ve</option>
                                        ${SCOLARIS_DATA.eleves.map(eleve => {
                                            const classe = SCOLARIS_DATA.classes.find(c => c.id === eleve.classe_id);
                                            return `<option value="${eleve.id}">${eleve.nom} ${eleve.prenom} - ${classe ? classe.nom : 'Non affect√©'}</option>`;
                                        }).join('')}
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Type de sanction *</label>
                                    <select class="form-control" id="exclusionType" required>
                                        <option value="avertissement">Avertissement</option>
                                        <option value="retenue">Retenue</option>
                                        <option value="exclusion_cours">Exclusion de cours</option>
                                        <option value="exclusion_temporaire">Exclusion temporaire</option>
                                        <option value="exclusion_definitive">Exclusion d√©finitive</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Date d√©but *</label>
                                    <input type="date" class="form-control" id="exclusionDateDebut" 
                                           value="${new Date().toISOString().split('T')[0]}" required>
                                </div>
                                <div class="form-group">
                                    <label>Date fin</label>
                                    <input type="date" class="form-control" id="exclusionDateFin">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Dur√©e</label>
                                    <input type="text" class="form-control" id="exclusionDuree" 
                                           placeholder="Ex: 1 journ√©e, 2 heures...">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group" style="flex: 2;">
                                    <label>Motif de la sanction *</label>
                                    <textarea class="form-control" id="exclusionMotif" rows="4" required
                                              placeholder="D√©crivez les faits et le motif de la sanction..."></textarea>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="fermerModal()">Annuler</button>
                        <button class="btn btn-danger" onclick="creerNouvelleExclusion()">
                            <i class="fas fa-gavel"></i> Appliquer la sanction
                        </button>
                    </div>
                </div>
            `;
            ouvrirModal(modalHtml);
        }
        
        function creerNouvelleExclusion() {
            const eleveId = document.getElementById('exclusionEleve').value;
            const type = document.getElementById('exclusionType').value;
            const dateDebut = document.getElementById('exclusionDateDebut').value;
            const dateFin = document.getElementById('exclusionDateFin').value;
            const duree = document.getElementById('exclusionDuree').value;
            const motif = document.getElementById('exclusionMotif').value;
            
            if (!eleveId || !type || !dateDebut || !motif) {
                alert('Veuillez remplir tous les champs obligatoires');
                return;
            }
            
            const nouvelId = Math.max(...SCOLARIS_DATA.exclusions.map(e => e.id), 0) + 1;
            const nouvelleExclusion = {
                id: nouvelId,
                eleve_id: parseInt(eleveId),
                type: type,
                date_debut: dateDebut,
                date_fin: dateFin || null,
                duree: duree,
                motif: motif,
                appliquee_par: utilisateurCourant.id,
                created_at: new Date().toISOString()
            };
            
            SCOLARIS_DATA.exclusions.push(nouvelleExclusion);
            sauvegarderDonnees();
            alert('Sanction enregistr√©e avec succ√®s !');
            fermerModal();
            afficherCarnetComplet();
        }
        
        function ouvrirModalNouvelleAbsence() {
            const modalHtml = `
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">‚è∞ Nouvelle absence</div>
                        <button class="modal-close" onclick="fermerModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <form id="formNouvelleAbsence">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>√âl√®ve absent *</label>
                                    <select class="form-control" id="absenceEleve" required>
                                        <option value="">S√©lectionner un √©l√®ve</option>
                                        ${SCOLARIS_DATA.eleves.map(eleve => {
                                            const classe = SCOLARIS_DATA.classes.find(c => c.id === eleve.classe_id);
                                            return `<option value="${eleve.id}">${eleve.nom} ${eleve.prenom} - ${classe ? classe.nom : 'Non affect√©'}</option>`;
                                        }).join('')}
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Type d'absence</label>
                                    <select class="form-control" id="absenceType">
                                        <option value="maladie">Maladie</option>
                                        <option value="familiale">Raison familiale</option>
                                        <option value="exceptionnelle">Exceptionnelle</option>
                                        <option value="injustifiee">Injustifi√©e</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Date *</label>
                                    <input type="date" class="form-control" id="absenceDate" 
                                           value="${new Date().toISOString().split('T')[0]}" required>
                                </div>
                                <div class="form-group">
                                    <label>Justifi√©e</label>
                                    <select class="form-control" id="absenceJustifiee">
                                        <option value="true">Oui</option>
                                        <option value="false">Non</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group" style="flex: 2;">
                                    <label>Motif</label>
                                    <textarea class="form-control" id="absenceMotif" rows="3"
                                              placeholder="Pr√©cisez le motif de l'absence..."></textarea>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="fermerModal()">Annuler</button>
                        <button class="btn btn-primary" onclick="creerNouvelleAbsence()">
                            <i class="fas fa-save"></i> Enregistrer l'absence
                        </button>
                    </div>
                </div>
            `;
            ouvrirModal(modalHtml);
        }
        
        function creerNouvelleAbsence() {
            const eleveId = document.getElementById('absenceEleve').value;
            const type = document.getElementById('absenceType').value;
            const date = document.getElementById('absenceDate').value;
            const justifiee = document.getElementById('absenceJustifiee').value === 'true';
            const motif = document.getElementById('absenceMotif').value;
            
            if (!eleveId || !date) {
                alert('Veuillez remplir tous les champs obligatoires');
                return;
            }
            
            const nouvelId = Math.max(...SCOLARIS_DATA.absences.map(a => a.id), 0) + 1;
            const nouvelleAbsence = {
                id: nouvelId,
                eleve_id: parseInt(eleveId),
                type: type,
                date: date,
                justifiee: justifiee,
                motif: motif,
                declaree_par: utilisateurCourant.id,
                created_at: new Date().toISOString()
            };
            
            SCOLARIS_DATA.absences.push(nouvelleAbsence);
            sauvegarderDonnees();
            alert('Absence enregistr√©e avec succ√®s !');
            fermerModal();
            afficherCarnetComplet();
        }
        
        // ============================================
        // GESTION DES UTILISATEURS
        // ============================================
        
        function afficherGestionUtilisateurs() {
            currentView = 'utilisateurs';
            document.getElementById('contenuPrincipal').innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h1 style="color: var(--couleur-principale);">Gestion des utilisateurs</h1>
                    <button class="btn btn-primary" onclick="ouvrirModalNouvelUtilisateur()">
                        <i class="fas fa-user-plus"></i> Nouvel utilisateur
                    </button>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">Liste des utilisateurs (${SCOLARIS_DATA.utilisateurs.length})</div>
                        <button class="btn btn-secondary btn-small" onclick="exporterUtilisateurs()">
                            <i class="fas fa-file-export"></i> Exporter
                        </button>
                    </div>
                    <div class="table-content">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nom</th>
                                    <th>Pr√©nom</th>
                                    <th>R√¥le</th>
                                    <th>Identifiant</th>
                                    <th>Email</th>
                                    <th>Date cr√©ation</th>
                                    <th>Statut</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${SCOLARIS_DATA.utilisateurs.map(utilisateur => {
                                    const role = SCOLARIS_DATA.roles.find(r => r.id === utilisateur.role);
                                    return `
                                        <tr>
                                            <td>${utilisateur.id}</td>
                                            <td>${utilisateur.nom}</td>
                                            <td>${utilisateur.prenom}</td>
                                            <td>${role ? role.nom : utilisateur.role}</td>
                                            <td>${utilisateur.identifiant}</td>
                                            <td>${utilisateur.email || ''}</td>
                                            <td>${formatDate(utilisateur.date_creation)}</td>
                                            <td>${utilisateur.actif ? 
                                                '<span class="badge badge-success">Actif</span>' : 
                                                '<span class="badge badge-danger">Inactif</span>'}</td>
                                            <td>
                                                <div style="display: flex; gap: 5px;">
                                                    <button class="btn btn-secondary btn-small" onclick="modifierUtilisateur(${utilisateur.id})">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    ${utilisateur.id !== 1 ? `
                                                    <button class="btn btn-danger btn-small" onclick="supprimerUtilisateur(${utilisateur.id})">
                                                        <i class="fas fa-trash"></i>
                                                    </button>` : ''}
                                                </div>
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            setActiveMenu('utilisateurs');
        }
        
        function ouvrirModalNouvelUtilisateur() {
            const modalHtml = `
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">üë§ Nouvel utilisateur</div>
                        <button class="modal-close" onclick="fermerModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <form id="formNouvelUtilisateur">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nom *</label>
                                    <input type="text" class="form-control" id="nouveauNom" required>
                                </div>
                                <div class="form-group">
                                    <label>Pr√©nom *</label>
                                    <input type="text" class="form-control" id="nouveauPrenom" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>R√¥le *</label>
                                    <select class="form-control" id="nouveauRole" required>
                                        <option value="">S√©lectionner un r√¥le</option>
                                        ${SCOLARIS_DATA.roles.map(role => 
                                            `<option value="${role.id}">${role.nom}</option>`
                                        ).join('')}
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Identifiant *</label>
                                    <input type="text" class="form-control" id="nouveauIdentifiant" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Mot de passe *</label>
                                    <input type="password" class="form-control" id="nouveauPassword" 
                                           value="scolaris2025" required>
                                </div>
                                <div class="form-group">
                                    <label>Confirmer le mot de passe *</label>
                                    <input type="password" class="form-control" id="nouveauPasswordConfirm" 
                                           value="scolaris2025" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="email" class="form-control" id="nouveauEmail">
                                </div>
                                <div class="form-group">
                                    <label>T√©l√©phone</label>
                                    <input type="tel" class="form-control" id="nouveauTelephone">
                                </div>
                            </div>
                            
                            <div id="champsEnseignant" style="display: none;">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Mati√®res enseign√©es</label>
                                        <select class="form-control" id="nouveauMatieres" multiple style="height: 100px;">
                                            ${SCOLARIS_DATA.matieres.map(matiere => 
                                                `<option value="${matiere.id}">${matiere.nom}</option>`
                                            ).join('')}
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="fermerModal()">Annuler</button>
                        <button class="btn btn-primary" onclick="creerNouvelUtilisateur()">
                            <i class="fas fa-save"></i> Cr√©er l'utilisateur
                        </button>
                    </div>
                </div>
            `;
            
            ouvrirModal(modalHtml);
            
            // Afficher/masquer les champs sp√©cifiques selon le r√¥le
            document.getElementById('nouveauRole').addEventListener('change', function() {
                const champsEnseignant = document.getElementById('champsEnseignant');
                if (this.value === 'enseignant') {
                    champsEnseignant.style.display = 'block';
                } else {
                    champsEnseignant.style.display = 'none';
                }
            });
        }
        
        function creerNouvelUtilisateur() {
            const nom = document.getElementById('nouveauNom').value;
            const prenom = document.getElementById('nouveauPrenom').value;
            const role = document.getElementById('nouveauRole').value;
            const identifiant = document.getElementById('nouveauIdentifiant').value;
            const password = document.getElementById('nouveauPassword').value;
            const passwordConfirm = document.getElementById('nouveauPasswordConfirm').value;
            const email = document.getElementById('nouveauEmail').value;
            const telephone = document.getElementById('nouveauTelephone').value;
            
            // Validation
            if (!nom || !prenom || !role || !identifiant || !password) {
                alert('Veuillez remplir tous les champs obligatoires (*)');
                return;
            }
            
            if (password !== passwordConfirm) {
                alert('Les mots de passe ne correspondent pas');
                return;
            }
            
            // V√©rifier si l'identifiant existe d√©j√†
            if (SCOLARIS_DATA.utilisateurs.find(u => u.identifiant === identifiant)) {
                alert('Cet identifiant est d√©j√† utilis√©');
                return;
            }
            
            // Cr√©er le nouvel utilisateur
            const nouvelId = Math.max(...SCOLARIS_DATA.utilisateurs.map(u => u.id), 0) + 1;
            const nouvelUtilisateur = {
                id: nouvelId,
                nom: nom,
                prenom: prenom,
                role: role,
                identifiant: identifiant,
                password: password,
                email: email,
                telephone: telephone,
                date_creation: new Date().toISOString().split('T')[0],
                actif: true
            };
            
            // Ajouter les mati√®res pour les enseignants
            if (role === 'enseignant') {
                const matieresSelect = document.getElementById('nouveauMatieres');
                const matieresSelectionnees = Array.from(matieresSelect.selectedOptions).map(opt => parseInt(opt.value));
                nouvelUtilisateur.matieres = matieresSelectionnees;
                nouvelUtilisateur.classes = []; // Classes vides au d√©part
            }
            
            // Ajouter l'ID √©l√®ve pour les comptes √©l√®ves
            if (role === 'eleve') {
                // On cherche si un √©l√®ve existe avec ce nom/pr√©nom
                const eleveExistants = SCOLARIS_DATA.eleves.filter(e => 
                    e.nom.toLowerCase() === nom.toLowerCase() && 
                    e.prenom.toLowerCase() === prenom.toLowerCase()
                );
                if (eleveExistants.length > 0) {
                    nouvelUtilisateur.eleve_id = eleveExistants[0].id;
                }
            }
            
            SCOLARIS_DATA.utilisateurs.push(nouvelUtilisateur);
            sauvegarderDonnees();
            
            alert(`Utilisateur cr√©√© avec succ√®s !\n\nIdentifiant: ${identifiant}\nMot de passe: ${password}`);
            fermerModal();
            afficherGestionUtilisateurs();
        }
        
        function modifierUtilisateur(utilisateurId) {
            const utilisateur = SCOLARIS_DATA.utilisateurs.find(u => u.id === utilisateurId);
            if (!utilisateur) return;
            
            const modalHtml = `
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">‚úèÔ∏è Modifier l'utilisateur</div>
                        <button class="modal-close" onclick="fermerModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <form id="formModifierUtilisateur">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nom *</label>
                                    <input type="text" class="form-control" id="modifNom" value="${utilisateur.nom}" required>
                                </div>
                                <div class="form-group">
                                    <label>Pr√©nom *</label>
                                    <input type="text" class="form-control" id="modifPrenom" value="${utilisateur.prenom}" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>R√¥le *</label>
                                    <select class="form-control" id="modifRole" required>
                                        ${SCOLARIS_DATA.roles.map(role => 
                                            `<option value="${role.id}" ${utilisateur.role === role.id ? 'selected' : ''}>
                                                ${role.nom}
                                            </option>`
                                        ).join('')}
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Identifiant *</label>
                                    <input type="text" class="form-control" id="modifIdentifiant" 
                                           value="${utilisateur.identifiant}" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nouveau mot de passe</label>
                                    <input type="password" class="form-control" id="modifPassword" 
                                           placeholder="Laisser vide pour ne pas changer">
                                </div>
                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="email" class="form-control" id="modifEmail" 
                                           value="${utilisateur.email || ''}">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>T√©l√©phone</label>
                                    <input type="tel" class="form-control" id="modifTelephone" 
                                           value="${utilisateur.telephone || ''}">
                                </div>
                                <div class="form-group">
                                    <label>Statut</label>
                                    <select class="form-control" id="modifStatut">
                                        <option value="true" ${utilisateur.actif ? 'selected' : ''}>Actif</option>
                                        <option value="false" ${!utilisateur.actif ? 'selected' : ''}>Inactif</option>
                                    </select>
                                </div>
                            </div>
                            
                            ${utilisateur.role === 'enseignant' ? `
                            <div id="champsEnseignantModif">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Mati√®res enseign√©es</label>
                                        <select class="form-control" id="modifMatieres" multiple style="height: 100px;">
                                            ${SCOLARIS_DATA.matieres.map(matiere => 
                                                `<option value="${matiere.id}" 
                                                    ${utilisateur.matieres && utilisateur.matieres.includes(matiere.id) ? 'selected' : ''}>
                                                    ${matiere.nom}
                                                </option>`
                                            ).join('')}
                                        </select>
                                    </div>
                                </div>
                            </div>` : ''}
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="fermerModal()">Annuler</button>
                        <button class="btn btn-primary" onclick="sauvegarderModificationUtilisateur(${utilisateurId})">
                            <i class="fas fa-save"></i> Enregistrer
                        </button>
                    </div>
                </div>
            `;
            
            ouvrirModal(modalHtml);
        }
        
        function sauvegarderModificationUtilisateur(utilisateurId) {
            const utilisateurIndex = SCOLARIS_DATA.utilisateurs.findIndex(u => u.id === utilisateurId);
            if (utilisateurIndex === -1) return;
            
            const utilisateur = SCOLARIS_DATA.utilisateurs[utilisateurIndex];
            
            // Mettre √† jour les informations
            utilisateur.nom = document.getElementById('modifNom').value;
            utilisateur.prenom = document.getElementById('modifPrenom').value;
            utilisateur.role = document.getElementById('modifRole').value;
            utilisateur.identifiant = document.getElementById('modifIdentifiant').value;
            utilisateur.email = document.getElementById('modifEmail').value;
            utilisateur.telephone = document.getElementById('modifTelephone').value;
            utilisateur.actif = document.getElementById('modifStatut').value === 'true';
            
            // Mettre √† jour le mot de passe si fourni
            const nouveauPassword = document.getElementById('modifPassword').value;
            if (nouveauPassword) {
                utilisateur.password = nouveauPassword;
            }
            
            // Mettre √† jour les mati√®res pour les enseignants
            if (utilisateur.role === 'enseignant') {
                const matieresSelect = document.getElementById('modifMatieres');
                if (matieresSelect) {
                    const matieresSelectionnees = Array.from(matieresSelect.selectedOptions).map(opt => parseInt(opt.value));
                    utilisateur.matieres = matieresSelectionnees;
                }
            }
            
            sauvegarderDonnees();
            alert('Utilisateur modifi√© avec succ√®s !');
            fermerModal();
            afficherGestionUtilisateurs();
        }
        
        function supprimerUtilisateur(utilisateurId) {
            if (utilisateurId === 1) {
                alert('Impossible de supprimer l\'administrateur principal');
                return;
            }
            
            if (!confirm('√ätes-vous s√ªr de vouloir supprimer cet utilisateur ? Cette action est irr√©versible.')) {
                return;
            }
            
            SCOLARIS_DATA.utilisateurs = SCOLARIS_DATA.utilisateurs.filter(u => u.id !== utilisateurId);
            sauvegarderDonnees();
            alert('Utilisateur supprim√© avec succ√®s !');
            afficherGestionUtilisateurs();
        }
        
        // ============================================
        // GESTION DES √âL√àVES
        // ============================================
        
        function afficherGestionEleves() {
            currentView = 'eleves';
            document.getElementById('contenuPrincipal').innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h1 style="color: var(--couleur-principale);">Gestion des √©l√®ves</h1>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" onclick="ouvrirModalNouvelEleve()">
                            <i class="fas fa-user-plus"></i> Nouvel √©l√®ve
                        </button>
                        <button class="btn btn-secondary" onclick="importerEleves()">
                            <i class="fas fa-file-import"></i> Importer
                        </button>
                    </div>
                </div>
                
                <div class="form-row" style="margin-bottom: 20px;">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Rechercher un √©l√®ve..." 
                               onkeyup="rechercherEleves(this.value)">
                    </div>
                    <div class="form-group" style="width: 200px;">
                        <select class="form-control" onchange="filtrerElevesParClasse(this.value)">
                            <option value="">Toutes les classes</option>
                            ${SCOLARIS_DATA.classes.map(classe => 
                                `<option value="${classe.id}">${classe.nom}</option>`
                            ).join('')}
                        </select>
                    </div>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">√âl√®ves inscrits (${SCOLARIS_DATA.eleves.length})</div>
                        <button class="btn btn-secondary btn-small" onclick="exporterEleves()">
                            <i class="fas fa-file-export"></i> Exporter
                        </button>
                    </div>
                    <div class="table-content">
                        <table id="tableEleves">
                            <thead>
                                <tr>
                                    <th>Nom</th>
                                    <th>Pr√©nom</th>
                                    <th>Classe</th>
                                    <th>Date de naissance</th>
                                    <th>Responsable</th>
                                    <th>T√©l√©phone</th>
                                    <th>Statut</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${SCOLARIS_DATA.eleves.map(eleve => {
                                    const classe = SCOLARIS_DATA.classes.find(c => c.id === eleve.classe_id);
                                    return `
                                        <tr data-eleve-id="${eleve.id}">
                                            <td><strong>${eleve.nom}</strong></td>
                                            <td>${eleve.prenom}</td>
                                            <td>${classe ? classe.nom : 'Non affect√©'}</td>
                                            <td>${formatDate(eleve.date_naissance)}</td>
                                            <td>${eleve.responsable_1 || ''}</td>
                                            <td>${eleve.tel_responsable_1 || ''}</td>
                                            <td>
                                                ${eleve.statut === 'inscrit' ? 
                                                    '<span class="badge badge-success">Inscrit</span>' : 
                                                    eleve.statut === 'radie' ? 
                                                    '<span class="badge badge-danger">Radi√©</span>' : 
                                                    '<span class="badge badge-warning">Autre</span>'}
                                            </td>
                                            <td>
                                                <div style="display: flex; gap: 5px;">
                                                    <button class="btn btn-secondary btn-small" onclick="voirFicheEleve(${eleve.id})">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                    <button class="btn btn-secondary btn-small" onclick="modifierEleve(${eleve.id})">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button class="btn btn-danger btn-small" onclick="supprimerEleve(${eleve.id})">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                ${SCOLARIS_DATA.eleves.length === 0 ? `
                <div class="form-container" style="text-align: center; padding: 40px;">
                    <i class="fas fa-user-graduate" style="font-size: 3rem; color: #ddd; margin-bottom: 20px;"></i>
                    <h3 style="color: #666; margin-bottom: 15px;">Aucun √©l√®ve enregistr√©</h3>
                    <p style="color: #888; margin-bottom: 25px;">Commencez par inscrire vos premiers √©l√®ves.</p>
                    <button class="btn btn-primary" onclick="ouvrirModalNouvelEleve()">
                        <i class="fas fa-user-plus"></i> Inscrire le premier √©l√®ve
                    </button>
                </div>` : ''}
            `;
            setActiveMenu('eleves');
        }
        
        function ouvrirModalNouvelEleve() {
            const modalHtml = `
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header">
                        <div class="modal-title">üë§ Inscrire un nouvel √©l√®ve</div>
                        <button class="modal-close" onclick="fermerModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <form id="formNouvelEleve">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nom *</label>
                                    <input type="text" class="form-control" id="eleveNom" required>
                                </div>
                                <div class="form-group">
                                    <label>Pr√©nom *</label>
                                    <input type="text" class="form-control" id="elevePrenom" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Date de naissance *</label>
                                    <input type="date" class="form-control" id="eleveNaissance" required>
                                </div>
                                <div class="form-group">
                                    <label>Classe *</label>
                                    <select class="form-control" id="eleveClasse" required>
                                        <option value="">S√©lectionner une classe</option>
                                        ${SCOLARIS_DATA.classes.map(classe => 
                                            `<option value="${classe.id}">${classe.nom}</option>`
                                        ).join('')}
                                    </select>
                                </div>
                            </div>
                            
                            <h4 style="color: var(--couleur-principale); margin: 25px 0 15px 0;">Responsable l√©gal 1</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nom du responsable *</label>
                                    <input type="text" class="form-control" id="eleveResponsable1" required>
                                </div>
                                <div class="form-group">
                                    <label>T√©l√©phone *</label>
                                    <input type="tel" class="form-control" id="eleveTel1" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="email" class="form-control" id="eleveEmail1">
                                </div>
                                <div class="form-group">
                                    <label>Lien de parent√©</label>
                                    <select class="form-control" id="eleveParente1">
                                        <option value="M√®re">M√®re</option>
                                        <option value="P√®re">P√®re</option>
                                        <option value="Tuteur">Tuteur</option>
                                        <option value="Autre">Autre</option>
                                    </select>
                                </div>
                            </div>
                            
                            <h4 style="color: var(--couleur-principale); margin: 25px 0 15px 0;">Informations compl√©mentaires</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Adresse</label>
                                    <input type="text" class="form-control" id="eleveAdresse">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Code postal</label>
                                    <input type="text" class="form-control" id="eleveCP">
                                </div>
                                <div class="form-group">
                                    <label>Ville</label>
                                    <input type="text" class="form-control" id="eleveVille">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Informations m√©dicales</label>
                                    <textarea class="form-control" id="eleveMedical" rows="3" 
                                              placeholder="Allergies, traitements..."></textarea>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="fermerModal()">Annuler</button>
                        <button class="btn btn-primary" onclick="creerNouvelEleve()">
                            <i class="fas fa-save"></i> Inscrire l'√©l√®ve
                        </button>
                    </div>
                </div>
            `;
            ouvrirModal(modalHtml);
        }
        
        function creerNouvelEleve() {
            const nom = document.getElementById('eleveNom').value;
            const prenom = document.getElementById('elevePrenom').value;
            const naissance = document.getElementById('eleveNaissance').value;
            const classeId = document.getElementById('eleveClasse').value;
            const responsable1 = document.getElementById('eleveResponsable1').value;
            const tel1 = document.getElementById('eleveTel1').value;
            
            if (!nom || !prenom || !naissance || !classeId || !responsable1 || !tel1) {
                alert('Veuillez remplir tous les champs obligatoires (*)');
                return;
            }
            
            const classe = SCOLARIS_DATA.classes.find(c => c.id === classeId);
            if (!classe) {
                alert('Classe s√©lectionn√©e invalide');
                return;
            }
            
            const nouvelId = Math.max(...SCOLARIS_DATA.eleves.map(e => e.id), 0) + 1;
            const nouvelEleve = {
                id: nouvelId,
                nom: nom,
                prenom: prenom,
                classe: classe.nom,
                classe_id: classeId,
                date_naissance: naissance,
                responsable_1: responsable1,
                tel_responsable_1: tel1,
                email_responsable_1: document.getElementById('eleveEmail1').value,
                parente_responsable_1: document.getElementById('eleveParente1').value,
                responsable_2: document.getElementById('eleveResponsable2')?.value,
                tel_responsable_2: document.getElementById('eleveTel2')?.value,
                adresse: document.getElementById('eleveAdresse')?.value,
                code_postal: document.getElementById('eleveCP')?.value,
                ville: document.getElementById('eleveVille')?.value,
                informations_medicales: document.getElementById('eleveMedical')?.value,
                date_inscription: new Date().toISOString().split('T')[0],
                statut: 'inscrit'
            };
            
            SCOLARIS_DATA.eleves.push(nouvelEleve);
            sauvegarderDonnees();
            
            // Cr√©er automatiquement un compte √©l√®ve
            const nouvelUtilisateurId = Math.max(...SCOLARIS_DATA.utilisateurs.map(u => u.id), 0) + 1;
            const nouvelUtilisateur = {
                id: nouvelUtilisateurId,
                nom: nom,
                prenom: prenom,
                role: 'eleve',
                identifiant: \`\${prenom.toLowerCase()}.\${nom.toLowerCase().substring(0, 3)}\`,
                password: 'eleve123',
                email: \`\${prenom.toLowerCase()}.\${nom.toLowerCase()}@edu.\${SCOLARIS_DATA.system.etablissement.nom.toLowerCase().replace(/\\s+/g, '')}.fr\`,
                date_creation: new Date().toISOString().split('T')[0],
                actif: true,
                eleve_id: nouvelId
            };
            
            SCOLARIS_DATA.utilisateurs.push(nouvelUtilisateur);
            sauvegarderDonnees();
            
            alert(\`√âl√®ve inscrit avec succ√®s !\\n\\nUn compte a √©t√© cr√©√© automatiquement :\\nIdentifiant: \${nouvelUtilisateur.identifiant}\\nMot de passe: eleve123\`);
            fermerModal();
            afficherGestionEleves();
        }
        
        function voirFicheEleve(eleveId) {
            const eleve = SCOLARIS_DATA.eleves.find(e => e.id === eleveId);
            if (!eleve) return;
            
            const classe = SCOLARIS_DATA.classes.find(c => c.id === eleve.classe_id);
            const notesEleve = SCOLARIS_DATA.notes.filter(n => n.eleve_id === eleveId);
            const absencesEleve = SCOLARIS_DATA.absences.filter(a => a.eleve_id === eleveId);
            const observationsEleve = SCOLARIS_DATA.observations.filter(o => o.eleve_id === eleveId);
            const exclusionsEleve = SCOLARIS_DATA.exclusions.filter(e => e.eleve_id === eleveId);
            
            // Calculer la moyenne
            let moyenne = 0;
            if (notesEleve.length > 0) {
                const totalNotes = notesEleve.reduce((sum, note) => sum + (note.valeur * (note.coefficient || 1)), 0);
                const totalCoefficients = notesEleve.reduce((sum, note) => sum + (note.coefficient || 1), 0);
                moyenne = totalCoefficients > 0 ? totalNotes / totalCoefficients : 0;
            }
            
            const modalHtml = `
                <div class="modal-content" style="max-width: 900px;">
                    <div class="modal-header">
                        <div class="modal-title">üìÑ Fiche √©l√®ve : ${eleve.nom} ${eleve.prenom}</div>
                        <button class="modal-close" onclick="fermerModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <div style="display: flex; gap: 30px; margin-bottom: 25px;">
                            <div style="flex: 1;">
                                <h4 style="color: var(--couleur-principale); margin-bottom: 15px;">Identit√©</h4>
                                <p><strong>Nom :</strong> ${eleve.nom}</p>
                                <p><strong>Pr√©nom :</strong> ${eleve.prenom}</p>
                                <p><strong>Date de naissance :</strong> ${formatDate(eleve.date_naissance)}</p>
                                <p><strong>Classe :</strong> ${classe ? classe.nom : 'Non affect√©'}</p>
                                <p><strong>Date d'inscription :</strong> ${formatDate(eleve.date_inscription)}</p>
                                <p><strong>Statut :</strong> <span class="badge ${
                                    eleve.statut === 'inscrit' ? 'badge-success' : 
                                    eleve.statut === 'radie' ? 'badge-danger' : 'badge-warning'
                                }">${eleve.statut || 'Inscrit'}</span></p>
                            </div>
                            <div style="flex: 1;">
                                <h4 style="color: var(--couleur-principale); margin-bottom: 15px;">Responsables l√©gaux</h4>
                                <p><strong>Responsable 1 :</strong> ${eleve.responsable_1}</p>
                                <p><strong>T√©l√©phone :</strong> ${eleve.tel_responsable_1}</p>
                                <p><strong>Email :</strong> ${eleve.email_responsable_1 || 'Non renseign√©'}</p>
                                ${eleve.responsable_2 ? `<p><strong>Responsable 2 :</strong> ${eleve.responsable_2}</p>` : ''}
                                ${eleve.tel_responsable_2 ? `<p><strong>T√©l√©phone 2 :</strong> ${eleve.tel_responsable_2}</p>` : ''}
                            </div>
                        </div>
                        
                        ${eleve.informations_medicales ? `
                        <div style="background-color: #f8f9fa; padding: 15px; border-radius: 6px; margin-bottom: 20px;">
                            <h4 style="color: var(--couleur-principale); margin-bottom: 10px;">Informations m√©dicales</h4>
                            <p>${eleve.informations_medicales}</p>
                        </div>` : ''}
                        
                        <div style="display: flex; gap: 30px; margin-bottom: 20px;">
                            <div>
                                <h4 style="color: var(--couleur-principale); margin-bottom: 10px;">Scolarit√©</h4>
                                <p><strong>Moyenne g√©n√©rale :</strong> <span style="font-size: 1.2rem; font-weight: bold;">
                                    ${moyenne.toFixed(2)}/20
                                </span></p>
                                <p><strong>Notes enregistr√©es :</strong> ${notesEleve.length}</p>
                                <p><strong>Absences cette ann√©e :</strong> ${absencesEleve.length}</p>
                                <p><strong>Observations :</strong> ${observationsEleve.length}</p>
                                <p><strong>Sanctions :</strong> ${exclusionsEleve.length}</p>
                            </div>
                            <div>
                                <h4 style="color: var(--couleur-principale); margin-bottom: 10px;">Coordonn√©es</h4>
                                <p><strong>Adresse :</strong> ${eleve.adresse || 'Non renseign√©e'}</p>
                                <p><strong>Ville :</strong> ${eleve.ville || ''} ${eleve.code_postal || ''}</p>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <h4 style="color: var(--couleur-principale); margin-bottom: 15px;">Actions</h4>
                            <div style="display: flex; gap: 10px;">
                                <button class="btn btn-primary" onclick="genererFicheElevePDF(${eleveId})">
                                    <i class="fas fa-print"></i> Imprimer la fiche
                                </button>
                                <button class="btn btn-secondary" onclick="modifierEleve(${eleveId}); fermerModal()">
                                    <i class="fas fa-edit"></i> Modifier
                                </button>
                                <button class="btn btn-secondary" onclick="voirNotesEleve(${eleveId})">
                                    <i class="fas fa-graduation-cap"></i> Voir les notes
                                </button>
                                <button class="btn btn-warning" onclick="ouvrirModalNouvelleObservation(); fermerModal()">
                                    <i class="fas fa-comment-alt"></i> Ajouter observation
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="fermerModal()">Fermer</button>
                    </div>
                </div>
            `;
            ouvrirModal(modalHtml);
        }
        
        function modifierEleve(eleveId) {
            const eleve = SCOLARIS_DATA.eleves.find(e => e.id === eleveId);
            if (!eleve) return;
            
            const modalHtml = `
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header">
                        <div class="modal-title">‚úèÔ∏è Modifier l'√©l√®ve</div>
                        <button class="modal-close" onclick="fermerModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <form id="formModifierEleve">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nom *</label>
                                    <input type="text" class="form-control" id="modifEleveNom" 
                                           value="${eleve.nom}" required>
                                </div>
                                <div class="form-group">
                                    <label>Pr√©nom *</label>
                                    <input type="text" class="form-control" id="modifElevePrenom" 
                                           value="${eleve.prenom}" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Date de naissance *</label>
                                    <input type="date" class="form-control" id="modifEleveNaissance" 
                                           value="${eleve.date_naissance}" required>
                                </div>
                                <div class="form-group">
                                    <label>Classe *</label>
                                    <select class="form-control" id="modifEleveClasse" required>
                                        ${SCOLARIS_DATA.classes.map(classe => 
                                            `<option value="${classe.id}" ${eleve.classe_id === classe.id ? 'selected' : ''}>
                                                ${classe.nom}
                                            </option>`
                                        ).join('')}
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Statut</label>
                                    <select class="form-control" id="modifEleveStatut">
                                        <option value="inscrit" ${eleve.statut === 'inscrit' ? 'selected' : ''}>Inscrit</option>
                                        <option value="radie" ${eleve.statut === 'radie' ? 'selected' : ''}>Radi√©</option>
                                        <option value="exclu" ${eleve.statut === 'exclu' ? 'selected' : ''}>Exclu</option>
                                        <option value="demenage" ${eleve.statut === 'demenage' ? 'selected' : ''}>D√©m√©nag√©</option>
                                    </select>
                                </div>
                            </div>
                            
                            <h4 style="color: var(--couleur-principale); margin: 25px 0 15px 0;">Responsable l√©gal 1</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nom du responsable *</label>
                                    <input type="text" class="form-control" id="modifEleveResponsable1" 
                                           value="${eleve.responsable_1}" required>
                                </div>
                                <div class="form-group">
                                    <label>T√©l√©phone *</label>
                                    <input type="tel" class="form-control" id="modifEleveTel1" 
                                           value="${eleve.tel_responsable_1}" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="email" class="form-control" id="modifEleveEmail1" 
                                           value="${eleve.email_responsable_1 || ''}">
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="fermerModal()">Annuler</button>
                        <button class="btn btn-primary" onclick="sauvegarderModificationEleve(${eleveId})">
                            <i class="fas fa-save"></i> Enregistrer
                        </button>
                    </div>
                </div>
            `;
            ouvrirModal(modalHtml);
        }
        
        function sauvegarderModificationEleve(eleveId) {
            const eleveIndex = SCOLARIS_DATA.eleves.findIndex(e => e.id === eleveId);
            if (eleveIndex === -1) return;
            
            const eleve = SCOLARIS_DATA.eleves[eleveIndex];
            const nouvelleClasseId = document.getElementById('modifEleveClasse').value;
            const nouvelleClasse = SCOLARIS_DATA.classes.find(c => c.id === nouvelleClasseId);
            
            eleve.nom = document.getElementById('modifEleveNom').value;
            eleve.prenom = document.getElementById('modifElevePrenom').value;
            eleve.date_naissance = document.getElementById('modifEleveNaissance').value;
            eleve.classe_id = nouvelleClasseId;
            eleve.classe = nouvelleClasse ? nouvelleClasse.nom : eleve.classe;
            eleve.statut = document.getElementById('modifEleveStatut').value;
            eleve.responsable_1 = document.getElementById('modifEleveResponsable1').value;
            eleve.tel_responsable_1 = document.getElementById('modifEleveTel1').value;
            eleve.email_responsable_1 = document.getElementById('modifEleveEmail1').value;
            
            sauvegarderDonnees();
            alert('√âl√®ve modifi√© avec succ√®s !');
            fermerModal();
            afficherGestionEleves();
        }
        
        function supprimerEleve(eleveId) {
            if (!confirm('√ätes-vous s√ªr de vouloir supprimer cet √©l√®ve ? Cette action supprimera √©galement toutes ses notes et absences.')) {
                return;
            }
            
            // Supprimer l'√©l√®ve
            SCOLARIS_DATA.eleves = SCOLARIS_DATA.eleves.filter(e => e.id !== eleveId);
            
            // Supprimer les notes de l'√©l√®ve
            SCOLARIS_DATA.notes = SCOLARIS_DATA.notes.filter(n => n.eleve_id !== eleveId);
            
            // Supprimer les observations de l'√©l√®ve
            SCOLARIS_DATA.observations = SCOLARIS_DATA.observations.filter(o => o.eleve_id !== eleveId);
            
            // Supprimer les exclusions de l'√©l√®ve
            SCOLARIS_DATA.exclusions = SCOLARIS_DATA.exclusions.filter(e => e.eleve_id !== eleveId);
            
            // Supprimer les absences de l'√©l√®ve
            SCOLARIS_DATA.absences = SCOLARIS_DATA.absences.filter(a => a.eleve_id !== eleveId);
            
            // Supprimer les retards de l'√©l√®ve
            SCOLARIS_DATA.retards = SCOLARIS_DATA.retards.filter(r => r.eleve_id !== eleveId);
            
            // Supprimer le compte utilisateur associ√©
            SCOLARIS_DATA.utilisateurs = SCOLARIS_DATA.utilisateurs.filter(u => u.eleve_id !== eleveId);
            
            sauvegarderDonnees();
            alert('√âl√®ve supprim√© avec succ√®s !');
            afficherGestionEleves();
        }
        
        // ============================================
        // GESTION DES CLASSES
        // ============================================
        
        function afficherGestionClasses() {
            currentView = 'classes';
            document.getElementById('contenuPrincipal').innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h1 style="color: var(--couleur-principale);">Gestion des classes</h1>
                    <button class="btn btn-primary" onclick="ouvrirModalNouvelleClasse()">
                        <i class="fas fa-plus"></i> Nouvelle classe
                    </button>
                </div>
                
                <div class="cards-container" style="margin-bottom: 30px;">
                    <div class="card">
                        <div class="card-title">Classes actives</div>
                        <div class="card-value">${SCOLARIS_DATA.classes.length}</div>
                        <div class="card-subtitle">Total de l'√©tablissement</div>
                    </div>
                    <div class="card">
                        <div class="card-title">Effectif total</div>
                        <div class="card-value">${SCOLARIS_DATA.eleves.length}</div>
                        <div class="card-subtitle">√âl√®ves inscrits</div>
                    </div>
                    <div class="card">
                        <div class="card-title">Moyenne par classe</div>
                        <div class="card-value">${SCOLARIS_DATA.classes.length > 0 ? 
                            Math.round(SCOLARIS_DATA.eleves.length / SCOLARIS_DATA.classes.length) : 0}</div>
                        <div class="card-subtitle">√âl√®ves par classe</div>
                    </div>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">Liste des classes</div>
                        <button class="btn btn-secondary btn-small" onclick="exporterClasses()">
                            <i class="fas fa-file-export"></i> Exporter
                        </button>
                    </div>
                    <div class="table-content">
                        <table>
                            <thead>
                                <tr>
                                    <th>Classe</th>
                                    <th>Niveau</th>
                                    <th>Professeur principal</th>
                                    <th>Effectif</th>
                                    <th>Salle</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${SCOLARIS_DATA.classes.map(classe => {
                                    const effectif = SCOLARIS_DATA.eleves.filter(e => e.classe_id === classe.id).length;
                                    const profPrincipal = classe.prof_principal_id ? 
                                        SCOLARIS_DATA.utilisateurs.find(u => u.id === classe.prof_principal_id) : null;
                                    return `
                                        <tr>
                                            <td><strong>${classe.nom}</strong></td>
                                            <td>${classe.niveau}</td>
                                            <td>${profPrincipal ? profPrincipal.prenom + ' ' + profPrincipal.nom : 'Non attribu√©'}</td>
                                            <td>${effectif} / ${classe.effectif_max || 30}</td>
                                            <td>${classe.salle || ''}</td>
                                            <td>
                                                <div style="display: flex; gap: 5px;">
                                                    <button class="btn btn-secondary btn-small" onclick="voirDetailsClasse('${classe.id}')">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                    <button class="btn btn-secondary btn-small" onclick="modifierClasse('${classe.id}')">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button class="btn btn-danger btn-small" onclick="supprimerClasse('${classe.id}')">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                ${SCOLARIS_DATA.classes.length === 0 ? `
                <div class="form-container" style="text-align: center; padding: 40px;">
                    <i class="fas fa-users" style="font-size: 3rem; color: #ddd; margin-bottom: 20px;"></i>
                    <h3 style="color: #666; margin-bottom: 15px;">Aucune classe cr√©√©e</h3>
                    <p style="color: #888; margin-bottom: 25px;">Commencez par cr√©er vos premi√®res classes.</p>
                    <button class="btn btn-primary" onclick="ouvrirModalNouvelleClasse()">
                        <i class="fas fa-plus"></i> Cr√©er la premi√®re classe
                    </button>
                </div>` : ''}
            `;
            setActiveMenu('classes');
        }
        
        function ouvrirModalNouvelleClasse() {
            const modalHtml = `
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">üè´ Nouvelle classe</div>
                        <button class="modal-close" onclick="fermerModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <form id="formNouvelleClasse">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nom de la classe *</label>
                                    <input type="text" class="form-control" id="classeNom" 
                                           placeholder="Ex: 6√®me A" required>
                                </div>
                                <div class="form-group">
                                    <label>Niveau *</label>
                                    <select class="form-control" id="classeNiveau" required>
                                        <option value="">S√©lectionner</option>
                                        <option value="6√®me">6√®me</option>
                                        <option value="5√®me">5√®me</option>
                                        <option value="4√®me">4√®me</option>
                                        <option value="3√®me">3√®me</option>
                                        <option value="2nde">2nde</option>
                                        <option value="1√®re">1√®re</option>
                                        <option value="Terminale">Terminale</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Professeur principal</label>
                                    <select class="form-control" id="classeProfPrincipal">
                                        <option value="">Non attribu√©</option>
                                        ${SCOLARIS_DATA.utilisateurs
                                            .filter(u => u.role === 'enseignant' && u.actif)
                                            .map(prof => 
                                                `<option value="${prof.id}">${prof.prenom} ${prof.nom}</option>`
                                            ).join('')}
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Effectif maximum</label>
                                    <input type="number" class="form-control" id="classeEffectifMax" 
                                           value="30" min="1" max="35">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Salle attribu√©e</label>
                                    <input type="text" class="form-control" id="classeSalle" 
                                           placeholder="Ex: Salle 201">
                                </div>
                                <div class="form-group">
                                    <label>Heure de rentr√©e</label>
                                    <input type="time" class="form-control" id="classeHeureRentree" 
                                           value="08:30">
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="fermerModal()">Annuler</button>
                        <button class="btn btn-primary" onclick="creerNouvelleClasse()">
                            <i class="fas fa-save"></i> Cr√©er la classe
                        </button>
                    </div>
                </div>
            `;
            ouvrirModal(modalHtml);
        }
        
        function creerNouvelleClasse() {
            const nom = document.getElementById('classeNom').value;
            const niveau = document.getElementById('classeNiveau').value;
            const profId = document.getElementById('classeProfPrincipal').value;
            const effectifMax = parseInt(document.getElementById('classeEffectifMax').value);
            const salle = document.getElementById('classeSalle').value;
            const heureRentree = document.getElementById('classeHeureRentree').value;
            
            if (!nom || !niveau) {
                alert('Veuillez remplir tous les champs obligatoires (*)');
                return;
            }
            
            // V√©rifier si la classe existe d√©j√†
            if (SCOLARIS_DATA.classes.find(c => c.nom === nom)) {
                alert('Une classe avec ce nom existe d√©j√†');
                return;
            }
            
            const id = nom.replace(/\s+/g, '');
            const profPrincipal = profId ? 
                SCOLARIS_DATA.utilisateurs.find(u => u.id === parseInt(profId)) : null;
            
            const nouvelleClasse = {
                id: id,
                nom: nom,
                niveau: niveau,
                prof_principal_id: profId ? parseInt(profId) : null,
                prof_principal: profPrincipal ? profPrincipal.prenom + ' ' + profPrincipal.nom : 'Non attribu√©',
                effectif_max: effectifMax,
                salle: salle,
                heure_rentree: heureRentree,
                created_at: new Date().toISOString().split('T')[0]
            };
            
            SCOLARIS_DATA.classes.push(nouvelleClasse);
            sauvegarderDonnees();
            alert('Classe cr√©√©e avec succ√®s !');
            fermerModal();
            afficherGestionClasses();
        }
        
        function voirDetailsClasse(classeId) {
            const classe = SCOLARIS_DATA.classes.find(c => c.id === classeId);
            if (!classe) return;
            
            const elevesClasse = SCOLARIS_DATA.eleves.filter(e => e.classe_id === classeId);
            const profPrincipal = classe.prof_principal_id ? 
                SCOLARIS_DATA.utilisateurs.find(u => u.id === classe.prof_principal_id) : null;
            
            const modalHtml = `
                <div class="modal-content" style="max-width: 900px;">
                    <div class="modal-header">
                        <div class="modal-title">üìä D√©tails de la classe : ${classe.nom}</div>
                        <button class="modal-close" onclick="fermerModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <div style="display: flex; gap: 30px; margin-bottom: 25px;">
                            <div style="flex: 1;">
                                <h4 style="color: var(--couleur-principale); margin-bottom: 15px;">Informations</h4>
                                <p><strong>Niveau :</strong> ${classe.niveau}</p>
                                <p><strong>Professeur principal :</strong> ${classe.prof_principal}</p>
                                <p><strong>Salle :</strong> ${classe.salle || 'Non attribu√©e'}</p>
                                <p><strong>Heure de rentr√©e :</strong> ${classe.heure_rentree || '08:30'}</p>
                                <p><strong>Effectif :</strong> ${elevesClasse.length} / ${classe.effectif_max || 30} √©l√®ves</p>
                            </div>
                            <div style="flex: 1;">
                                <h4 style="color: var(--couleur-principale); margin-bottom: 15px;">Statistiques</h4>
                                <p><strong>Date de cr√©ation :</strong> ${formatDate(classe.created_at)}</p>
                            </div>
                        </div>
                        
                        <h4 style="color: var(--couleur-principale); margin-bottom: 15px;">
                            Liste des √©l√®ves (${elevesClasse.length})
                        </h4>
                        <div class="table-content" style="max-height: 300px; overflow-y: auto; margin-bottom: 20px;">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Nom</th>
                                        <th>Pr√©nom</th>
                                        <th>Date de naissance</th>
                                        <th>Responsable</th>
                                        <th>T√©l√©phone</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${elevesClasse.map(eleve => `
                                        <tr>
                                            <td>${eleve.nom}</td>
                                            <td>${eleve.prenom}</td>
                                            <td>${formatDate(eleve.date_naissance)}</td>
                                            <td>${eleve.responsable_1}</td>
                                            <td>${eleve.tel_responsable_1}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <h4 style="color: var(--couleur-principale); margin-bottom: 15px;">Actions</h4>
                            <div style="display: flex; gap: 10px;">
                                <button class="btn btn-primary" onclick="genererListeClasse('${classeId}')">
                                    <i class="fas fa-print"></i> Imprimer la liste
                                </button>
                                <button class="btn btn-secondary" onclick="modifierClasse('${classeId}'); fermerModal()">
                                    <i class="fas fa-edit"></i> Modifier la classe
                                </button>
                                <button class="btn btn-secondary" onclick="affecterElevesClasse('${classeId}')">
                                    <i class="fas fa-user-plus"></i> Affecter des √©l√®ves
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="fermerModal()">Fermer</button>
                    </div>
                </div>
            `;
            ouvrirModal(modalHtml);
        }
        
        function modifierClasse(classeId) {
            const classe = SCOLARIS_DATA.classes.find(c => c.id === classeId);
            if (!classe) return;
            
            const modalHtml = `
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">‚úèÔ∏è Modifier la classe : ${classe.nom}</div>
                        <button class="modal-close" onclick="fermerModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <form id="formModifierClasse">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nom de la classe *</label>
                                    <input type="text" class="form-control" id="modifClasseNom" 
                                           value="${classe.nom}" required>
                                </div>
                                <div class="form-group">
                                    <label>Niveau *</label>
                                    <select class="form-control" id="modifClasseNiveau" required>
                                        <option value="6√®me" ${classe.niveau === '6√®me' ? 'selected' : ''}>6√®me</option>
                                        <option value="5√®me" ${classe.niveau === '5√®me' ? 'selected' : ''}>5√®me</option>
                                        <option value="4√®me" ${classe.niveau === '4√®me' ? 'selected' : ''}>4√®me</option>
                                        <option value="3√®me" ${classe.niveau === '3√®me' ? 'selected' : ''}>3√®me</option>
                                        <option value="2nde" ${classe.niveau === '2nde' ? 'selected' : ''}>2nde</option>
                                        <option value="1√®re" ${classe.niveau === '1√®re' ? 'selected' : ''}>1√®re</option>
                                        <option value="Terminale" ${classe.niveau === 'Terminale' ? 'selected' : ''}>Terminale</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Professeur principal</label>
                                    <select class="form-control" id="modifClasseProfPrincipal">
                                        <option value="">Non attribu√©</option>
                                        ${SCOLARIS_DATA.utilisateurs
                                            .filter(u => u.role === 'enseignant' && u.actif)
                                            .map(prof => 
                                                `<option value="${prof.id}" ${classe.prof_principal_id === prof.id ? 'selected' : ''}>
                                                    ${prof.prenom} ${prof.nom}
                                                </option>`
                                            ).join('')}
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Effectif maximum</label>
                                    <input type="number" class="form-control" id="modifClasseEffectifMax"
                                           value="${classe.effectif_max || 30}" min="1" max="35">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Salle attribu√©e</label>
                                    <input type="text" class="form-control" id="modifClasseSalle" 
                                           value="${classe.salle || ''}">
                                </div>
                                <div class="form-group">
                                    <label>Heure de rentr√©e</label>
                                    <input type="time" class="form-control" id="modifClasseHeureRentree"
                                           value="${classe.heure_rentree || '08:30'}">
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="fermerModal()">Annuler</button>
                        <button class="btn btn-primary" onclick="sauvegarderModificationClasse('${classeId}')">
                            <i class="fas fa-save"></i> Enregistrer
                        </button>
                    </div>
                </div>
            `;
            ouvrirModal(modalHtml);
        }
        
        function sauvegarderModificationClasse(classeId) {
            const classeIndex = SCOLARIS_DATA.classes.findIndex(c => c.id === classeId);
            if (classeIndex === -1) return;
            
            const classe = SCOLARIS_DATA.classes[classeIndex];
            const ancienNom = classe.nom;
            const nouveauNom = document.getElementById('modifClasseNom').value;
            
            classe.nom = nouveauNom;
            classe.niveau = document.getElementById('modifClasseNiveau').value;
            classe.effectif_max = parseInt(document.getElementById('modifClasseEffectifMax').value);
            classe.salle = document.getElementById('modifClasseSalle').value;
            classe.heure_rentree = document.getElementById('modifClasseHeureRentree').value;
            
            const profId = document.getElementById('modifClasseProfPrincipal').value;
            classe.prof_principal_id = profId ? parseInt(profId) : null;
            
            if (profId) {
                const prof = SCOLARIS_DATA.utilisateurs.find(u => u.id === parseInt(profId));
                classe.prof_principal = prof ? prof.prenom + ' ' + prof.nom : 'Non attribu√©';
            } else {
                classe.prof_principal = 'Non attribu√©';
            }
            
            // Mettre √† jour le nom de la classe dans les √©l√®ves
            SCOLARIS_DATA.eleves.forEach(eleve => {
                if (eleve.classe_id === classeId) {
                    eleve.classe = nouveauNom;
                }
            });
            
            sauvegarderDonnees();
            alert('Classe modifi√©e avec succ√®s !');
            fermerModal();
            afficherGestionClasses();
        }
        
        function supprimerClasse(classeId) {
            if (!confirm('√ätes-vous s√ªr de vouloir supprimer cette classe ? Cette action est irr√©versible.')) {
                return;
            }
            
            // V√©rifier si la classe contient des √©l√®ves
            const elevesDansClasse = SCOLARIS_DATA.eleves.filter(e => e.classe_id === classeId);
            if (elevesDansClasse.length > 0) {
                if (!confirm(\`Cette classe contient \${elevesDansClasse.length} √©l√®ve(s). Voulez-vous vraiment la supprimer ? Les √©l√®ves seront √©galement supprim√©s.\`)) {
                    return;
                }
                
                // Supprimer les √©l√®ves de cette classe
                SCOLARIS_DATA.eleves = SCOLARIS_DATA.eleves.filter(e => e.classe_id !== classeId);
                
                // Supprimer les comptes utilisateurs associ√©s
                SCOLARIS_DATA.utilisateurs = SCOLARIS_DATA.utilisateurs.filter(u => 
                    !u.eleve_id || !elevesDansClasse.find(e => e.id === u.eleve_id)
                );
            }
            
            // Supprimer la classe
            SCOLARIS_DATA.classes = SCOLARIS_DATA.classes.filter(c => c.id !== classeId);
            sauvegarderDonnees();
            alert('Classe supprim√©e avec succ√®s !');
            afficherGestionClasses();
        }
        
        // ============================================
        // GESTION DES MATI√àRES
        // ============================================
        
        function afficherGestionMatieres() {
            currentView = 'matieres';
            document.getElementById('contenuPrincipal').innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h1 style="color: var(--couleur-principale);">Gestion des mati√®res</h1>
                    <button class="btn btn-primary" onclick="ouvrirModalNouvelleMatiere()">
                        <i class="fas fa-plus"></i> Nouvelle mati√®re
                    </button>
                </div>
                
                <div class="cards-container" style="margin-bottom: 30px;">
                    <div class="card">
                        <div class="card-title">Mati√®res enseign√©es</div>
                        <div class="card-value">${SCOLARIS_DATA.matieres.length}</div>
                        <div class="card-subtitle">Total de l'√©tablissement</div>
                    </div>
                    <div class="card">
                        <div class="card-title">Coefficient moyen</div>
                        <div class="card-value">${(SCOLARIS_DATA.matieres.reduce((sum, m) => sum + (m.coefficient || 1), 0) / SCOLARIS_DATA.matieres.length).toFixed(1)}</div>
                        <div class="card-subtitle">Moyenne par mati√®re</div>
                    </div>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">Liste des mati√®res</div>
                        <button class="btn btn-secondary btn-small" onclick="exporterMatieres()">
                            <i class="fas fa-file-export"></i> Exporter
                        </button>
                    </div>
                    <div class="table-content">
                        <table>
                            <thead>
                                <tr>
                                    <th>Mati√®re</th>
                                    <th>Coefficient</th>
                                    <th>Couleur</th>
                                    <th>Enseignants</th>
                                    <th>Heures/semaine</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${SCOLARIS_DATA.matieres.map(matiere => {
                                    const enseignants = SCOLARIS_DATA.utilisateurs
                                        .filter(u => u.role === 'enseignant' && u.matieres && u.matieres.includes(matiere.id))
                                        .map(u => u.prenom + ' ' + u.nom);
                                    return `
                                        <tr>
                                            <td><strong>${matiere.nom}</strong></td>
                                            <td>${matiere.coefficient || 1}</td>
                                            <td>
                                                <div style="display: flex; align-items: center; gap: 10px;">
                                                    <div style="width: 20px; height: 20px; background-color: ${matiere.couleur || '#3498DB'}; border-radius: 4px;"></div>
                                                    ${matiere.couleur || '#3498DB'}
                                                </div>
                                            </td>
                                            <td>${enseignants.length > 0 ? enseignants.join(', ') : 'Non attribu√©'}</td>
                                            <td>${matiere.heures_semaine || 4}h</td>
                                            <td>
                                                <div style="display: flex; gap: 5px;">
                                                    <button class="btn btn-secondary btn-small" onclick="modifierMatiere(${matiere.id})">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    ${matiere.id > 10 ? `
                                                    <button class="btn btn-danger btn-small" onclick="supprimerMatiere(${matiere.id})">
                                                        <i class="fas fa-trash"></i>
                                                    </button>` : ''}
                                                </div>
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            setActiveMenu('matieres');
        }
        
        function ouvrirModalNouvelleMatiere() {
            const modalHtml = `
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">üìö Nouvelle mati√®re</div>
                        <button class="modal-close" onclick="fermerModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <form id="formNouvelleMatiere">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nom de la mati√®re *</label>
                                    <input type="text" class="form-control" id="matiereNom" required>
                                </div>
                                <div class="form-group">
                                    <label>Coefficient *</label>
                                    <select class="form-control" id="matiereCoefficient" required>
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3" selected>3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Couleur *</label>
                                    <input type="color" class="form-control" id="matiereCouleur" 
                                           value="#3498DB" required style="height: 40px;">
                                </div>
                                <div class="form-group">
                                    <label>Heures par semaine</label>
                                    <input type="number" class="form-control" id="matiereHeures" 
                                           value="4" min="1" max="10">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Description</label>
                                    <textarea class="form-control" id="matiereDescription" rows="3"></textarea>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="fermerModal()">Annuler</button>
                        <button class="btn btn-primary" onclick="creerNouvelleMatiere()">
                            <i class="fas fa-save"></i> Cr√©er la mati√®re
                        </button>
                    </div>
                </div>
            `;
            ouvrirModal(modalHtml);
        }
        
        function creerNouvelleMatiere() {
            const nom = document.getElementById('matiereNom').value;
            const coefficient = parseInt(document.getElementById('matiereCoefficient').value);
            const couleur = document.getElementById('matiereCouleur').value;
            const heures = parseInt(document.getElementById('matiereHeures').value);
            const description = document.getElementById('matiereDescription').value;
            
            if (!nom) {
                alert('Veuillez remplir le nom de la mati√®re');
                return;
            }
            
            // V√©rifier si la mati√®re existe d√©j√†
            if (SCOLARIS_DATA.matieres.find(m => m.nom.toLowerCase() === nom.toLowerCase())) {
                alert('Une mati√®re avec ce nom existe d√©j√†');
                return;
            }
            
            const nouvelId = Math.max(...SCOLARIS_DATA.matieres.map(m => m.id), 0) + 1;
            const nouvelleMatiere = {
                id: nouvelId,
                nom: nom,
                coefficient: coefficient,
                couleur: couleur,
                heures_semaine: heures,
                description: description,
                created_at: new Date().toISOString().split('T')[0]
            };
            
            SCOLARIS_DATA.matieres.push(nouvelleMatiere);
            sauvegarderDonnees();
            alert('Mati√®re cr√©√©e avec succ√®s !');
            fermerModal();
            afficherGestionMatieres();
        }
        
        function modifierMatiere(matiereId) {
            const matiere = SCOLARIS_DATA.matieres.find(m => m.id === matiereId);
            if (!matiere) return;
            
            const modalHtml = `
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">‚úèÔ∏è Modifier la mati√®re : ${matiere.nom}</div>
                        <button class="modal-close" onclick="fermerModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <form id="formModifierMatiere">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nom de la mati√®re *</label>
                                    <input type="text" class="form-control" id="modifMatiereNom" 
                                           value="${matiere.nom}" required>
                                </div>
                                <div class="form-group">
                                    <label>Coefficient *</label>
                                    <select class="form-control" id="modifMatiereCoefficient" required>
                                        <option value="1" ${matiere.coefficient === 1 ? 'selected' : ''}>1</option>
                                        <option value="2" ${matiere.coefficient === 2 ? 'selected' : ''}>2</option>
                                        <option value="3" ${matiere.coefficient === 3 ? 'selected' : ''}>3</option>
                                        <option value="4" ${matiere.coefficient === 4 ? 'selected' : ''}>4</option>
                                        <option value="5" ${matiere.coefficient === 5 ? 'selected' : ''}>5</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Couleur *</label>
                                    <input type="color" class="form-control" id="modifMatiereCouleur"
                                           value="${matiere.couleur || '#3498DB'}" required style="height: 40px;">
                                </div>
                                <div class="form-group">
                                    <label>Heures par semaine</label>
                                    <input type="number" class="form-control" id="modifMatiereHeures"
                                           value="${matiere.heures_semaine || 4}" min="1" max="10">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Description</label>
                                    <textarea class="form-control" id="modifMatiereDescription" rows="3">${matiere.description || ''}</textarea>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="fermerModal()">Annuler</button>
                        <button class="btn btn-primary" onclick="sauvegarderModificationMatiere(${matiereId})">
                            <i class="fas fa-save"></i> Enregistrer
                        </button>
                    </div>
                </div>
            `;
            ouvrirModal(modalHtml);
        }
        
        function sauvegarderModificationMatiere(matiereId) {
            const matiereIndex = SCOLARIS_DATA.matieres.findIndex(m => m.id === matiereId);
            if (matiereIndex === -1) return;
            
            const matiere = SCOLARIS_DATA.matieres[matiereIndex];
            
            matiere.nom = document.getElementById('modifMatiereNom').value;
            matiere.coefficient = parseInt(document.getElementById('modifMatiereCoefficient').value);
            matiere.couleur = document.getElementById('modifMatiereCouleur').value;
            matiere.heures_semaine = parseInt(document.getElementById('modifMatiereHeures').value);
            matiere.description = document.getElementById('modifMatiereDescription').value;
            
            sauvegarderDonnees();
            alert('Mati√®re modifi√©e avec succ√®s !');
            fermerModal();
            afficherGestionMatieres();
        }
        
        function supprimerMatiere(matiereId) {
            if (matiereId <= 10) {
                alert('Les mati√®res de base ne peuvent pas √™tre supprim√©es');
                return;
            }
            
            if (!confirm('√ätes-vous s√ªr de vouloir supprimer cette mati√®re ?')) {
                return;
            }
            
            SCOLARIS_DATA.matieres = SCOLARIS_DATA.matieres.filter(m => m.id !== matiereId);
            sauvegarderDonnees();
            alert('Mati√®re supprim√©e avec succ√®s !');
            afficherGestionMatieres();
        }
        
        // ============================================
        // GESTION DES COURS
        // ============================================
        
        function afficherGestionCours() {
            currentView = 'cours';
            document.getElementById('contenuPrincipal').innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h1 style="color: var(--couleur-principale);">Gestion des cours</h1>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" onclick="ouvrirModalNouveauCours()">
                            <i class="fas fa-plus"></i> Nouveau cours
                        </button>
                        <button class="btn btn-secondary" onclick="genererEmploiDuTemps()">
                            <i class="fas fa-calendar-plus"></i> G√©n√©rer emploi du temps
                        </button>
                    </div>
                </div>
                
                <div class="cards-container" style="margin-bottom: 30px;">
                    <div class="card">
                        <div class="card-title">Cours programm√©s</div>
                        <div class="card-value">${SCOLARIS_DATA.cours.length}</div>
                        <div class="card-subtitle">Total cette semaine</div>
                    </div>
                    <div class="card">
                        <div class="card-title">Cours avec devoirs</div>
                        <div class="card-value">${SCOLARIS_DATA.cours.filter(c => c.devoir).length}</div>
                        <div class="card-subtitle">Devoirs √† donner</div>
                    </div>
                </div>
                
                <div class="tabs">
                    <div class="tab active" onclick="changerOngletCours('liste')">Liste des cours</div>
                    <div class="tab" onclick="changerOngletCours('semaine')">Semaine en cours</div>
                    <div class="tab" onclick="changerOngletCours('devoirs')">Devoirs √† donner</div>
                </div>
                
                <div id="contenuCours">
                    ${genererContenuListeCours()}
                </div>
            `;
            setActiveMenu('cours');
        }
        
        function genererContenuListeCours() {
            return `
                <div class="form-container">
                    <h3 class="form-title">Tous les cours</h3>
                    <div class="table-container">
                        <div class="table-content">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Heure</th>
                                        <th>Mati√®re</th>
                                        <th>Classe</th>
                                        <th>Enseignant</th>
                                        <th>Salle</th>
                                        <th>Devoir</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${SCOLARIS_DATA.cours.map(cours => {
                                        const matiere = SCOLARIS_DATA.matieres.find(m => m.id === cours.matiere_id);
                                        const classe = SCOLARIS_DATA.classes.find(c => c.id === cours.classe_id);
                                        const enseignant = SCOLARIS_DATA.utilisateurs.find(u => u.id === cours.enseignant_id);
                                        return `
                                            <tr>
                                                <td>${formatDate(cours.date)}</td>
                                                <td>${formatHeure(cours.heure_debut)} - ${formatHeure(cours.heure_fin)}</td>
                                                <td>${matiere ? matiere.nom : 'Inconnue'}</td>
                                                <td>${classe ? classe.nom : 'Inconnue'}</td>
                                                <td>${enseignant ? enseignant.prenom + ' ' + enseignant.nom : 'Inconnu'}</td>
                                                <td>${cours.salle || 'Non sp√©cifi√©'}</td>
                                                <td>${cours.devoir ? 
                                                    '<span class="badge badge-success">Oui</span>' : 
                                                    '<span class="badge badge-secondary">Non</span>'}</td>
                                                <td>
                                                    <div style="display: flex; gap: 5px;">
                                                        <button class="btn btn-secondary btn-small" onclick="voirDetailsCours(${cours.id})">
                                                            <i class="fas fa-eye"></i>
                                                        </button>
                                                        <button class="btn btn-secondary btn-small" onclick="modifierCours(${cours.id})">
                                                            <i class="fas fa-edit"></i>
                                                        </button>
                                                        <button class="btn btn-danger btn-small" onclick="supprimerCours(${cours.id})">
                                                            <i class="fas fa-trash"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        `;
                                    }).join('')}
                                    ${SCOLARIS_DATA.cours.length === 0 ? `
                                    <tr>
                                        <td colspan="8" style="text-align: center; padding: 30px; color: #666;">
                                            <i class="fas fa-calendar-alt" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                                            Aucun cours programm√©.
                                        </td>
                                    </tr>` : ''}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function ouvrirModalNouveauCours() {
            const modalHtml = `
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">üìÖ Nouveau cours</div>
                        <button class="modal-close" onclick="fermerModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <form id="formNouveauCours">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Date *</label>
                                    <input type="date" class="form-control" id="coursDate" 
                                           value="${new Date().toISOString().split('T')[0]}" required>
                                </div>
                                <div class="form-group">
                                    <label>Heure d√©but *</label>
                                    <input type="time" class="form-control" id="coursHeureDebut" 
                                           value="08:30" required>
                                </div>
                                <div class="form-group">
                                    <label>Heure fin *</label>
                                    <input type="time" class="form-control" id="coursHeureFin" 
                                           value="09:30" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Mati√®re *</label>
                                    <select class="form-control" id="coursMatiere" required>
                                        <option value="">S√©lectionner une mati√®re</option>
                                        ${SCOLARIS_DATA.matieres.map(matiere => 
                                            `<option value="${matiere.id}">${matiere.nom}</option>`
                                        ).join('')}
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Classe *</label>
                                    <select class="form-control" id="coursClasse" required>
                                        <option value="">S√©lectionner une classe</option>
                                        ${SCOLARIS_DATA.classes.map(classe => 
                                            `<option value="${classe.id}">${classe.nom}</option>`
                                        ).join('')}
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Enseignant *</label>
                                    <select class="form-control" id="coursEnseignant" required>
                                        <option value="">S√©lectionner un enseignant</option>
                                        ${SCOLARIS_DATA.utilisateurs
                                            .filter(u => u.role === 'enseignant' && u.actif)
                                            .map(enseignant => 
                                                `<option value="${enseignant.id}">${enseignant.prenom} ${enseignant.nom}</option>`
                                            ).join('')}
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Salle</label>
                                    <input type="text" class="form-control" id="coursSalle" 
                                           placeholder="Ex: Salle 201">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group" style="flex: 2;">
                                    <label>Sujet du cours</label>
                                    <input type="text" class="form-control" id="coursSujet" 
                                           placeholder="Ex: Les fonctions en math√©matiques">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="coursDevoir"> 
                                        Donner un devoir pour ce cours
                                    </label>
                                </div>
                            </div>
                            
                            <div id="champsDevoir" style="display: none;">
                                <div class="form-row">
                                    <div class="form-group" style="flex: 2;">
                                        <label>Description du devoir</label>
                                        <textarea class="form-control" id="devoirDescription" rows="3"
                                                  placeholder="D√©crivez le devoir √† faire..."></textarea>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Date de rendu</label>
                                        <input type="date" class="form-control" id="devoirDateRendu">
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="fermerModal()">Annuler</button>
                        <button class="btn btn-primary" onclick="creerNouveauCours()">
                            <i class="fas fa-save"></i> Cr√©er le cours
                        </button>
                    </div>
                </div>
            `;
            
            ouvrirModal(modalHtml);
            
            // Afficher/masquer les champs devoir
            document.getElementById('coursDevoir').addEventListener('change', function() {
                const champsDevoir = document.getElementById('champsDevoir');
                champsDevoir.style.display = this.checked ? 'block' : 'none';
            });
        }
        
        function creerNouveauCours() {
            const date = document.getElementById('coursDate').value;
            const heureDebut = document.getElementById('coursHeureDebut').value;
            const heureFin = document.getElementById('coursHeureFin').value;
            const matiereId = document.getElementById('coursMatiere').value;
            const classeId = document.getElementById('coursClasse').value;
            const enseignantId = document.getElementById('coursEnseignant').value;
            const salle = document.getElementById('coursSalle').value;
            const sujet = document.getElementById('coursSujet').value;
            const hasDevoir = document.getElementById('coursDevoir').checked;
            
            if (!date || !heureDebut || !heureFin || !matiereId || !classeId || !enseignantId) {
                alert('Veuillez remplir tous les champs obligatoires (*)');
                return;
            }
            
            const nouvelId = Math.max(...SCOLARIS_DATA.cours.map(c => c.id), 0) + 1;
            const nouveauCours = {
                id: nouvelId,
                date: date,
                heure_debut: heureDebut,
                heure_fin: heureFin,
                matiere_id: parseInt(matiereId),
                classe_id: classeId,
                enseignant_id: parseInt(enseignantId),
                salle: salle,
                sujet: sujet,
                devoir: hasDevoir,
                created_at: new Date().toISOString()
            };
            
            if (hasDevoir) {
                nouveauCours.devoir_description = document.getElementById('devoirDescription').value;
                nouveauCours.devoir_date_rendu = document.getElementById('devoirDateRendu').value;
                
                // Cr√©er aussi un devoir dans la liste des devoirs
                const nouveauDevoirId = Math.max(...SCOLARIS_DATA.devoirs.map(d => d.id), 0) + 1;
                const matiere = SCOLARIS_DATA.matieres.find(m => m.id === parseInt(matiereId));
                const classe = SCOLARIS_DATA.classes.find(c => c.id === classeId);
                
                const nouveauDevoir = {
                    id: nouveauDevoirId,
                    cours_id: nouvelId,
                    matiere_id: parseInt(matiereId),
                    classe_id: classeId,
                    enseignant_id: parseInt(enseignantId),
                    description: document.getElementById('devoirDescription').value,
                    date_rendu: document.getElementById('devoirDateRendu').value,
                    date_creation: new Date().toISOString().split('T')[0],
                    statut: '√† faire'
                };
                
                SCOLARIS_DATA.devoirs.push(nouveauDevoir);
            }
            
            SCOLARIS_DATA.cours.push(nouveauCours);
            sauvegarderDonnees();
            alert('Cours cr√©√© avec succ√®s !');
            fermerModal();
            afficherGestionCours();
        }
        
        function voirDetailsCours(coursId) {
            const cours = SCOLARIS_DATA.cours.find(c => c.id === coursId);
            if (!cours) return;
            
            const matiere = SCOLARIS_DATA.matieres.find(m => m.id === cours.matiere_id);
            const classe = SCOLARIS_DATA.classes.find(c => c.id === cours.classe_id);
            const enseignant = SCOLARIS_DATA.utilisateurs.find(u => u.id === cours.enseignant_id);
            
            const modalHtml = `
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">üìñ D√©tails du cours</div>
                        <button class="modal-close" onclick="fermerModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <div style="display: flex; gap: 30px; margin-bottom: 25px;">
                            <div style="flex: 1;">
                                <h4 style="color: var(--couleur-principale); margin-bottom: 15px;">Informations</h4>
                                <p><strong>Date :</strong> ${formatDate(cours.date)}</p>
                                <p><strong>Heure :</strong> ${formatHeure(cours.heure_debut)} - ${formatHeure(cours.heure_fin)}</p>
                                <p><strong>Mati√®re :</strong> ${matiere ? matiere.nom : 'Inconnue'}</p>
                                <p><strong>Classe :</strong> ${classe ? classe.nom : 'Inconnue'}</p>
                                <p><strong>Enseignant :</strong> ${enseignant ? enseignant.prenom + ' ' + enseignant.nom : 'Inconnu'}</p>
                                <p><strong>Salle :</strong> ${cours.salle || 'Non sp√©cifi√©'}</p>
                            </div>
                        </div>
                        
                        ${cours.sujet ? `
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: var(--couleur-principale); margin-bottom: 10px;">Sujet du cours</h4>
                            <p>${cours.sujet}</p>
                        </div>` : ''}
                        
                        ${cours.devoir ? `
                        <div style="background-color: #f8f9fa; padding: 15px; border-radius: 6px; margin-bottom: 20px;">
                            <h4 style="color: var(--couleur-principale); margin-bottom: 10px;">üìù Devoir √† faire</h4>
                            <p>${cours.devoir_description || 'Pas de description'}</p>
                            ${cours.devoir_date_rendu ? `
                            <p style="margin-top: 10px;">
                                <strong>√Ä rendre pour le :</strong> ${formatDate(cours.devoir_date_rendu)}
                            </p>` : ''}
                        </div>` : ''}
                        
                        ${utilisateurCourant.role === 'enseignant' ? `
                        <div style="margin-top: 20px;">
                            <h4 style="color: var(--couleur-principale); margin-bottom: 15px;">Actions pour l'enseignant</h4>
                            <div style="display: flex; gap: 10px;">
                                <button class="btn btn-primary" onclick="ajouterContenuCours(${coursId})">
                                    <i class="fas fa-edit"></i> Ajouter du contenu
                                </button>
                                ${!cours.devoir ? `
                                <button class="btn btn-warning" onclick="ajouterDevoirCours(${coursId})">
                                    <i class="fas fa-tasks"></i> Donner un devoir
                                </button>` : ''}
                                <button class="btn btn-secondary" onclick="modifierCours(${coursId}); fermerModal()">
                                    <i class="fas fa-edit"></i> Modifier le cours
                                </button>
                            </div>
                        </div>` : ''}
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="fermerModal()">Fermer</button>
                    </div>
                </div>
            `;
            ouvrirModal(modalHtml);
        }
        
        function ajouterContenuCours(coursId) {
            const cours = SCOLARIS_DATA.cours.find(c => c.id === coursId);
            if (!cours) return;
            
            const modalHtml = `
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">üìù Ajouter du contenu au cours</div>
                        <button class="modal-close" onclick="fermerModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <form id="formContenuCours">
                            <div class="form-row">
                                <div class="form-group" style="flex: 2;">
                                    <label>Titre du contenu *</label>
                                    <input type="text" class="form-control" id="contenuTitre" 
                                           placeholder="Ex: Les fonctions affines" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group" style="flex: 2;">
                                    <label>Contenu d√©taill√© *</label>
                                    <textarea class="form-control" id="contenuDetail" rows="10" required
                                              placeholder="D√©crivez ce qui a √©t√© fait pendant le cours, les points importants, les exercices r√©alis√©s..."></textarea>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group" style="flex: 2;">
                                    <label>Documents √† t√©l√©charger (liens ou noms)</label>
                                    <textarea class="form-control" id="contenuDocuments" rows="3"
                                              placeholder="Liste des documents distribu√©s ou √† t√©l√©charger..."></textarea>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="fermerModal()">Annuler</button>
                        <button class="btn btn-primary" onclick="sauvegarderContenuCours(${coursId})">
                            <i class="fas fa-save"></i> Enregistrer le contenu
                        </button>
                    </div>
                </div>
            `;
            ouvrirModal(modalHtml);
        }
        
        function sauvegarderContenuCours(coursId) {
            const coursIndex = SCOLARIS_DATA.cours.findIndex(c => c.id === coursId);
            if (coursIndex === -1) return;
            
            const titre = document.getElementById('contenuTitre').value;
            const detail = document.getElementById('contenuDetail').value;
            const documents = document.getElementById('contenuDocuments').value;
            
            if (!titre || !detail) {
                alert('Veuillez remplir tous les champs obligatoires');
                return;
            }
            
            SCOLARIS_DATA.cours[coursIndex].contenu = {
                titre: titre,
                detail: detail,
                documents: documents.split('\n').filter(d => d.trim()),
                date_ajout: new Date().toISOString(),
                ajoute_par: utilisateurCourant.id
            };
            
            sauvegarderDonnees();
            alert('Contenu du cours enregistr√© avec succ√®s ! Les √©l√®ves pourront le consulter.');
            fermerModal();
        }
        
        function ajouterDevoirCours(coursId) {
            const cours = SCOLARIS_DATA.cours.find(c => c.id === coursId);
            if (!cours) return;
            
            const modalHtml = `
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">üìù Donner un devoir</div>
                        <button class="modal-close" onclick="fermerModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <form id="formDevoirCours">
                            <div class="form-row">
                                <div class="form-group" style="flex: 2;">
                                    <label>Description du devoir *</label>
                                    <textarea class="form-control" id="devoirDesc" rows="5" required
                                              placeholder="D√©crivez pr√©cis√©ment le devoir √† faire..."></textarea>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Date de rendu *</label>
                                    <input type="date" class="form-control" id="devoirRenduDate" required
                                           value="${new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]}">
                                </div>
                                <div class="form-group">
                                    <label>Type de devoir</label>
                                    <select class="form-control" id="devoirType">
                                        <option value="exercices">Exercices</option>
                                        <option value="recherche">Recherche</option>
                                        <option value="projet">Projet</option>
                                        <option value="lecture">Lecture</option>
                                        <option value="autre">Autre</option>
                                    </select>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="fermerModal()">Annuler</button>
                        <button class="btn btn-primary" onclick="sauvegarderDevoirCours(${coursId})">
                            <i class="fas fa-save"></i> Donner le devoir
                        </button>
                    </div>
                </div>
            `;
            ouvrirModal(modalHtml);
        }
        
        function sauvegarderDevoirCours(coursId) {
            const coursIndex = SCOLARIS_DATA.cours.findIndex(c => c.id === coursId);
            if (coursIndex === -1) return;
            
            const description = document.getElementById('devoirDesc').value;
            const dateRendu = document.getElementById('devoirRenduDate').value;
            const type = document.getElementById('devoirType').value;
            
            if (!description || !dateRendu) {
                alert('Veuillez remplir tous les champs obligatoires');
                return;
            }
            
            // Mettre √† jour le cours
            SCOLARIS_DATA.cours[coursIndex].devoir = true;
            SCOLARIS_DATA.cours[coursIndex].devoir_description = description;
            SCOLARIS_DATA.cours[coursIndex].devoir_date_rendu = dateRendu;
            SCOLARIS_DATA.cours[coursIndex].devoir_type = type;
            
            // Cr√©er un devoir dans la liste des devoirs
            const cours = SCOLARIS_DATA.cours[coursIndex];
            const nouveauDevoirId = Math.max(...SCOLARIS_DATA.devoirs.map(d => d.id), 0) + 1;
            
            const nouveauDevoir = {
                id: nouveauDevoirId,
                cours_id: coursId,
                matiere_id: cours.matiere_id,
                classe_id: cours.classe_id,
                enseignant_id: cours.enseignant_id,
                description: description,
                date_rendu: dateRendu,
                type: type,
                date_creation: new Date().toISOString().split('T')[0],
                statut: '√† faire'
            };
            
            SCOLARIS_DATA.devoirs.push(nouveauDevoir);
            sauvegarderDonnees();
            
            alert('Devoir donn√© avec succ√®s ! Les √©l√®ves seront notifi√©s.');
            fermerModal();
        }
        
        // ============================================
        // EMPLOI DU TEMPS
        // ============================================
        
        function afficherEmploiDuTemps() {
            currentView = 'emploi_temps';
            
            // D√©terminer les cours de la semaine en cours
            const aujourdhui = new Date();
            const debutSemaine = new Date(aujourdhui);
            debutSemaine.setDate(aujourdhui.getDate() - aujourdhui.getDay() + 1); // Lundi
            
            const joursSemaine = ['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi'];
            const creneaux = ['08:30-09:30', '09:30-10:30', '10:45-11:45', '11:45-12:45', '13:45-14:45', '14:45-15:45', '15:45-16:45'];
            
            let emploiHtml = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h1 style="color: var(--couleur-principale);">Emploi du temps</h1>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" onclick="genererEmploiDuTemps()">
                            <i class="fas fa-calendar-plus"></i> G√©n√©rer automatiquement
                        </button>
                        <button class="btn btn-secondary" onclick="exporterEmploiDuTemps()">
                            <i class="fas fa-file-export"></i> Exporter
                        </button>
                    </div>
                </div>
                
                <div class="form-row" style="margin-bottom: 20px;">
                    <div class="form-group">
                        <select class="form-control" onchange="changerClasseEmploiTemps(this.value)">
                            <option value="">Toutes les classes</option>
                            ${SCOLARIS_DATA.classes.map(classe => 
                                `<option value="${classe.id}">${classe.nom}</option>`
                            ).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <select class="form-control" onchange="changerEnseignantEmploiTemps(this.value)">
                            <option value="">Tous les enseignants</option>
                            ${SCOLARIS_DATA.utilisateurs
                                .filter(u => u.role === 'enseignant' && u.actif)
                                .map(enseignant => 
                                    `<option value="${enseignant.id}">${enseignant.prenom} ${enseignant.nom}</option>`
                                ).join('')}
                        </select>
                    </div>
                </div>
                
                <div class="emploi-container">
                    <div class="emploi-jour">Heures</div>
            `;
            
            // Ajouter les jours
            joursSemaine.forEach(jour => {
                emploiHtml += `<div class="emploi-jour">${jour}</div>`;
            });
            
            // Ajouter les cr√©neaux
            creneaux.forEach((creneau, index) => {
                emploiHtml += `<div class="emploi-creneau">${creneau}</div>`;
                
                joursSemaine.forEach((jour, jourIndex) => {
                    // Pour simplifier, on va chercher les cours qui correspondent √† ce jour et cr√©neau
                    // En r√©alit√©, il faudrait faire correspondre avec les dates r√©elles
                    const coursDansCreneau = SCOLARIS_DATA.cours.filter(c => {
                        // Cette logique est simplifi√©e pour l'exemple
                        return true; // √Ä adapter avec une vraie logique de correspondance
                    }).slice(0, 2); // Limiter √† 2 cours par cr√©neau pour l'exemple
                    
                    emploiHtml += `<div class="emploi-cell" onclick="ouvrirModalCoursCreneau(${index}, ${jourIndex})">`;
                    
                    coursDansCreneau.forEach(cours => {
                        const matiere = SCOLARIS_DATA.matieres.find(m => m.id === cours.matiere_id);
                        if (matiere) {
                            emploiHtml += `
                                <div class="cours-item" style="border-left-color: ${matiere.couleur || '#3498DB'};"
                                     onclick="event.stopPropagation(); voirDetailsCours(${cours.id})">
                                    <div style="font-weight: bold; font-size: 0.9rem;">${matiere.nom.substring(0, 15)}</div>
                                    <div style="font-size: 0.8rem; color: #666;">${cours.salle || ''}</div>
                                </div>
                            `;
                        }
                    });
                    
                    emploiHtml += `</div>`;
                });
            });
            
            emploiHtml += `
                </div>
                
                <div style="margin-top: 30px;">
                    <h3 style="color: var(--couleur-principale); margin-bottom: 15px;">L√©gende</h3>
                    <div style="display: flex; flex-wrap: wrap; gap: 15px;">
                        ${SCOLARIS_DATA.matieres.slice(0, 5).map(matiere => `
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div style="width: 20px; height: 20px; background-color: ${matiere.couleur || '#3498DB'}; border-radius: 4px;"></div>
                                <span>${matiere.nom}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            document.getElementById('contenuPrincipal').innerHTML = emploiHtml;
            setActiveMenu('emploi_temps');
        }
        
        function ouvrirModalCoursCreneau(creneauIndex, jourIndex) {
            const jours = ['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi'];
            const creneaux = ['08:30-09:30', '09:30-10:30', '10:45-11:45', '11:45-12:45', '13:45-14:45', '14:45-15:45', '15:45-16:45'];
            
            const modalHtml = `
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">‚ûï Ajouter un cours</div>
                        <button class="modal-close" onclick="fermerModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <p><strong>Jour :</strong> ${jours[jourIndex]}</p>
                        <p><strong>Cr√©neau :</strong> $ {creneaux[creneauIndex]}</p>
