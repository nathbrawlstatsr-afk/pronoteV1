<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCOLARIS - Tableau de bord</title>
    <style>
        :root {
            --couleur-principale: #2C3E50;
            --couleur-secondaire: #3498DB;
            --couleur-accent: #E74C3C;
            --couleur-success: #27AE60;
            --couleur-warning: #F39C12;
            --couleur-fond: #F8F9FA;
            --couleur-bordure: #E1E5E9;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
        }
        
        body {
            background-color: var(--couleur-fond);
            color: #333;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }
        
        /* Header */
        .header-principal {
            background-color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 0 20px;
            z-index: 100;
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--couleur-bordure);
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--couleur-principale);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--couleur-secondaire);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        /* Menu */
        .menu-horizontal {
            background-color: white;
            border-bottom: 1px solid var(--couleur-bordure);
            overflow-x: auto;
        }
        
        .menu-items {
            display: flex;
            list-style: none;
            min-width: max-content;
        }
        
        .menu-item {
            padding: 15px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            color: #555;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }
        
        .menu-item:hover {
            background-color: #f8f9fa;
            color: var(--couleur-principale);
        }
        
        .menu-item.active {
            border-bottom-color: var(--couleur-secondaire);
            color: var(--couleur-secondaire);
            background-color: #f0f7ff;
        }
        
        /* Contenu */
        .contenu-principal {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
        }
        
        /* Styles communs */
        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
        }
        
        .btn-primary {
            background-color: var(--couleur-secondaire);
            color: white;
        }
        
        .btn-secondary {
            background-color: white;
            color: var(--couleur-principale);
            border: 1px solid var(--couleur-bordure);
        }
        
        .btn-success {
            background-color: var(--couleur-success);
            color: white;
        }
        
        .btn-danger {
            background-color: var(--couleur-accent);
            color: white;
        }
        
        .btn-small {
            padding: 5px 10px;
            font-size: 0.85rem;
        }
        
        /* Cards */
        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border-top: 4px solid var(--couleur-secondaire);
        }
        
        .card-title {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
        }
        
        .card-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--couleur-principale);
            margin-bottom: 5px;
        }
        
        /* Tableaux */
        .table-container {
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }
        
        .table-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--couleur-bordure);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .table-title {
            font-size: 1.1rem;
            color: var(--couleur-principale);
            font-weight: 600;
        }
        
        .table-content {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background-color: #F8F9FA;
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: var(--couleur-principale);
            border-bottom: 1px solid var(--couleur-bordure);
        }
        
        td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--couleur-bordure);
        }
        
        tr:hover {
            background-color: #f9f9f9;
        }
        
        /* Badges */
        .badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
        }
        
        .badge-success { background-color: #D5EDDA; color: #155724; }
        .badge-warning { background-color: #FFF3CD; color: #856404; }
        .badge-danger { background-color: #F8D7DA; color: #721C24; }
        
        /* Formulaires */
        .form-container {
            background-color: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }
        
        .form-title {
            font-size: 1.2rem;
            color: var(--couleur-principale);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--couleur-bordure);
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            flex: 1;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--couleur-principale);
        }
        
        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--couleur-bordure);
            border-radius: 4px;
            font-size: 0.95rem;
        }
        
        /* Onglets */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--couleur-bordure);
            margin-bottom: 20px;
            overflow-x: auto;
        }
        
        .tab {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            color: #666;
            white-space: nowrap;
        }
        
        .tab.active {
            border-bottom-color: var(--couleur-secondaire);
            color: var(--couleur-secondaire);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 8px;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalFadeIn 0.3s;
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--couleur-bordure);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 1.2rem;
            color: var(--couleur-principale);
            font-weight: 600;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 20px;
            border-top: 1px solid var(--couleur-bordure);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        /* Mention l√©gale */
        .mention-legale {
            background-color: #FFF3CD;
            border: 1px solid #FFEAA7;
            padding: 15px;
            border-radius: 6px;
            margin-top: 30px;
            font-size: 0.9rem;
            color: #856404;
            display: flex;
            align-items: center;
            gap: 10px;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header class="header-principal">
        <div class="header-top">
            <div class="logo-container">
                <div class="logo">SCOLARIS</div>
                <div class="etablissement-info" id="etablissementInfo"></div>
            </div>
            
            <div class="user-info">
                <div class="user-details">
                    <div class="user-name" id="userName"></div>
                    <div class="user-role" id="userRole"></div>
                </div>
                <div class="user-avatar" id="userAvatar"></div>
                <button class="btn btn-secondary btn-small" onclick="deconnexion()">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
        
        <nav class="menu-horizontal">
            <ul class="menu-items" id="menuItems"></ul>
        </nav>
    </header>
    
    <main class="contenu-principal" id="contenuPrincipal"></main>
    
    <div id="modalGenerique" class="modal"></div>

    <script>
        // ============================================
        // VARIABLES GLOBALES
        // ============================================
        
        let SCOLARIS_DATA = null;
        let utilisateurCourant = null;
        let currentTab = {};
        
        // ============================================
        // INITIALISATION
        // ============================================
        
        document.addEventListener('DOMContentLoaded', function() {
            // V√©rifier la connexion
            if (!localStorage.getItem('SCOLARIS_DATA') || !localStorage.getItem('SCOLARIS_USER')) {
                window.location.href = 'index.html';
                return;
            }
            
            // Charger les donn√©es
            SCOLARIS_DATA = JSON.parse(localStorage.getItem('SCOLARIS_DATA'));
            utilisateurCourant = JSON.parse(localStorage.getItem('SCOLARIS_USER'));
            
            // Initialiser les donn√©es si n√©cessaire
            initialiserDonneesParDefaut();
            
            // Afficher les informations
            afficherInformationsEtablissement();
            afficherInformationsUtilisateur();
            genererMenu();
            
            // Afficher le tableau de bord par d√©faut
            afficherTableauDeBord();
            
            // Gestion du modal
            document.getElementById('modalGenerique').addEventListener('click', function(e) {
                if (e.target === this) {
                    fermerModal();
                }
            });
        });
        
        function initialiserDonneesParDefaut() {
            let doitSauvegarder = false;
            
            // Initialiser les mati√®res si vide
            if (!SCOLARIS_DATA.matieres || SCOLARIS_DATA.matieres.length === 0) {
                SCOLARIS_DATA.matieres = [
                    { id: 1, nom: "Fran√ßais", coefficient: 3, couleur: "#4A6FA5" },
                    { id: 2, nom: "Math√©matiques", coefficient: 3, couleur: "#D96459" },
                    { id: 3, nom: "Histoire-G√©ographie", coefficient: 2, couleur: "#388659" },
                    { id: 4, nom: "Sciences de la Vie et de la Terre", coefficient: 2, couleur: "#8E6C88" },
                    { id: 5, nom: "Langue Vivante A (Anglais)", coefficient: 2, couleur: "#3498DB" },
                    { id: 6, nom: "Physique-Chimie", coefficient: 2, couleur: "#F39C12" },
                    { id: 7, nom: "Technologie", coefficient: 1, couleur: "#8E44AD" },
                    { id: 8, nom: "√âducation Musicale", coefficient: 1, couleur: "#16A085" },
                    { id: 9, nom: "Arts Plastiques", coefficient: 1, couleur: "#D35400" },
                    { id: 10, nom: "√âducation Physique et Sportive", coefficient: 1, couleur: "#C0392B" }
                ];
                doitSauvegarder = true;
            }
            
            // Initialiser les classes si vide
            if (!SCOLARIS_DATA.classes || SCOLARIS_DATA.classes.length === 0) {
                SCOLARIS_DATA.classes = [];
                doitSauvegarder = true;
            }
            
            // Initialiser les autres tableaux si n√©cessaire
            if (!SCOLARIS_DATA.eleves) SCOLARIS_DATA.eleves = [];
            if (!SCOLARIS_DATA.notes) SCOLARIS_DATA.notes = [];
            if (!SCOLARIS_DATA.absences) SCOLARIS_DATA.absences = [];
            if (!SCOLARIS_DATA.retards) SCOLARIS_DATA.retards = [];
            if (!SCOLARIS_DATA.devoirs) SCOLARIS_DATA.devoirs = [];
            if (!SCOLARIS_DATA.emploi_du_temps) SCOLARIS_DATA.emploi_du_temps = [];
            if (!SCOLARIS_DATA.messages) SCOLARIS_DATA.messages = [];
            if (!SCOLARIS_DATA.documents) SCOLARIS_DATA.documents = [];
            
            if (doitSauvegarder) {
                sauvegarderDonnees();
            }
        }
        
        // ============================================
        // FONCTIONS UTILITAIRES
        // ============================================
        
        function sauvegarderDonnees() {
            localStorage.setItem('SCOLARIS_DATA', JSON.stringify(SCOLARIS_DATA));
        }
        
        function formatDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            return date.toLocaleDateString('fr-FR');
        }
        
        function ouvrirModal(html) {
            document.getElementById('modalGenerique').innerHTML = html;
            document.getElementById('modalGenerique').style.display = 'flex';
        }
        
        function fermerModal() {
            document.getElementById('modalGenerique').style.display = 'none';
        }
        
        function setActiveMenu(menuId) {
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.menu === menuId) {
                    item.classList.add('active');
                }
            });
        }
        
        function deconnexion() {
            if (confirm('√ätes-vous s√ªr de vouloir vous d√©connecter ?')) {
                localStorage.removeItem('SCOLARIS_USER');
                window.location.href = 'index.html';
            }
        }
        
        function afficherInformationsEtablissement() {
            const etablissement = SCOLARIS_DATA.system.etablissement;
            document.getElementById('etablissementInfo').innerHTML = `
                <div>${etablissement.nom}</div>
                <div style="font-size: 0.8rem; color: #666;">${etablissement.annee_scolaire}</div>
            `;
        }
        
        function afficherInformationsUtilisateur() {
            document.getElementById('userName').textContent = `${utilisateurCourant.prenom} ${utilisateurCourant.nom}`;
            document.getElementById('userRole').textContent = 
                SCOLARIS_DATA.roles.find(r => r.id === utilisateurCourant.role)?.nom || utilisateurCourant.role;
            document.getElementById('userAvatar').textContent = 
                utilisateurCourant.prenom.charAt(0) + utilisateurCourant.nom.charAt(0);
        }
        
        function genererMenu() {
            let menuHtml = '';
            const role = utilisateurCourant.role;
            
            if (role === 'admin_systeme' || role === 'proviseur') {
                menuHtml = `
                    <li class="menu-item active" data-menu="dashboard" onclick="afficherTableauDeBord()">
                        <i class="fas fa-tachometer-alt"></i> Tableau de bord
                    </li>
                    <li class="menu-item" data-menu="utilisateurs" onclick="afficherGestionUtilisateurs()">
                        <i class="fas fa-users-cog"></i> Utilisateurs
                    </li>
                    <li class="menu-item" data-menu="eleves" onclick="afficherGestionEleves()">
                        <i class="fas fa-user-graduate"></i> √âl√®ves
                    </li>
                    <li class="menu-item" data-menu="enseignants" onclick="afficherGestionEnseignants()">
                        <i class="fas fa-chalkboard-teacher"></i> Enseignants
                    </li>
                    <li class="menu-item" data-menu="classes" onclick="afficherGestionClasses()">
                        <i class="fas fa-users"></i> Classes
                    </li>
                    <li class="menu-item" data-menu="matieres" onclick="afficherGestionMatieres()">
                        <i class="fas fa-book"></i> Mati√®res
                    </li>
                    <li class="menu-item" data-menu="notes" onclick="afficherGestionNotes()">
                        <i class="fas fa-graduation-cap"></i> Notes
                    </li>
                    <li class="menu-item" data-menu="absences" onclick="afficherGestionAbsences()">
                        <i class="fas fa-user-clock"></i> Absences
                    </li>
                    <li class="menu-item" data-menu="emploi_temps" onclick="afficherEmploiDuTemps()">
                        <i class="fas fa-calendar-alt"></i> Emploi du temps
                    </li>
                    <li class="menu-item" data-menu="parametres" onclick="afficherParametres()">
                        <i class="fas fa-cog"></i> Param√®tres
                    </li>
                `;
            } else if (role === 'enseignant') {
                menuHtml = `
                    <li class="menu-item active" data-menu="dashboard" onclick="afficherTableauDeBord()">
                        <i class="fas fa-tachometer-alt"></i> Tableau de bord
                    </li>
                    <li class="menu-item" data-menu="mes_classes" onclick="afficherMesClasses()">
                        <i class="fas fa-chalkboard-teacher"></i> Mes classes
                    </li>
                    <li class="menu-item" data-menu="notes" onclick="afficherGestionNotes()">
                        <i class="fas fa-graduation-cap"></i> Notes
                    </li>
                    <li class="menu-item" data-menu="emploi_temps" onclick="afficherEmploiDuTemps()">
                        <i class="fas fa-calendar-alt"></i> Emploi du temps
                    </li>
                    <li class="menu-item" data-menu="devoirs" onclick="afficherGestionDevoirs()">
                        <i class="fas fa-tasks"></i> Devoirs
                    </li>
                `;
            } else if (role === 'eleve') {
                menuHtml = `
                    <li class="menu-item active" data-menu="dashboard" onclick="afficherTableauDeBordEleve()">
                        <i class="fas fa-tachometer-alt"></i> Tableau de bord
                    </li>
                    <li class="menu-item" data-menu="mes_notes" onclick="afficherMesNotes()">
                        <i class="fas fa-graduation-cap"></i> Mes notes
                    </li>
                    <li class="menu-item" data-menu="emploi_temps" onclick="afficherEmploiDuTempsEleve()">
                        <i class="fas fa-calendar-alt"></i> Emploi du temps
                    </li>
                    <li class="menu-item" data-menu="devoirs" onclick="afficherMesDevoirs()">
                        <i class="fas fa-tasks"></i> Mes devoirs
                    </li>
                `;
            }
            
            document.getElementById('menuItems').innerHTML = menuHtml;
        }
        
        // ============================================
        // TABLEAU DE BORD
        // ============================================
        
        function afficherTableauDeBord() {
            const totalEleves = SCOLARIS_DATA.eleves.length;
            const totalClasses = SCOLARIS_DATA.classes.length;
            const totalEnseignants = SCOLARIS_DATA.utilisateurs.filter(u => u.role === 'enseignant' && u.actif).length;
            const absencesAujourdhui = SCOLARIS_DATA.absences.filter(a => a.date === new Date().toISOString().split('T')[0]).length;
            
            document.getElementById('contenuPrincipal').innerHTML = `
                <h1 style="margin-bottom: 25px; color: var(--couleur-principale);">Tableau de bord</h1>
                
                <div class="cards-container">
                    <div class="card">
                        <div class="card-title">
                            <i class="fas fa-user-graduate"></i> √âl√®ves inscrits
                        </div>
                        <div class="card-value">${totalEleves}</div>
                        <div class="card-subtitle">Total de l'√©tablissement</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-title">
                            <i class="fas fa-users"></i> Classes
                        </div>
                        <div class="card-value">${totalClasses}</div>
                        <div class="card-subtitle">Classes actives</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-title">
                            <i class="fas fa-chalkboard-teacher"></i> Enseignants
                        </div>
                        <div class="card-value">${totalEnseignants}</div>
                        <div class="card-subtitle">Personnel enseignant</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-title">
                            <i class="fas fa-user-clock"></i> Absences aujourd'hui
                        </div>
                        <div class="card-value">${absencesAujourdhui}</div>
                        <div class="card-subtitle">√âl√®ves absents</div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group" style="flex: 2;">
                        <div class="table-container">
                            <div class="table-header">
                                <div class="table-title">Derni√®res activit√©s</div>
                            </div>
                            <div class="table-content">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Type</th>
                                            <th>Description</th>
                                            <th>Utilisateur</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>${new Date().toLocaleDateString('fr-FR')}</td>
                                            <td><span class="badge badge-success">Connexion</span></td>
                                            <td>Vous √™tes connect√©(e)</td>
                                            <td>${utilisateurCourant.prenom} ${utilisateurCourant.nom}</td>
                                        </tr>
                                        ${totalEleves === 0 ? `
                                        <tr>
                                            <td>Aujourd'hui</td>
                                            <td><span class="badge badge-warning">Action</span></td>
                                            <td>Ajoutez vos premiers √©l√®ves</td>
                                            <td>Syst√®me</td>
                                        </tr>
                                        ` : ''}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group" style="flex: 1;">
                        <div class="table-container">
                            <div class="table-header">
                                <div class="table-title">Actions rapides</div>
                            </div>
                            <div class="table-content" style="padding: 15px;">
                                <div style="display: flex; flex-direction: column; gap: 10px;">
                                    ${(utilisateurCourant.role === 'admin_systeme' || utilisateurCourant.role === 'proviseur') ? `
                                    <button class="btn btn-primary" onclick="afficherGestionUtilisateurs()">
                                        <i class="fas fa-user-plus"></i> Ajouter un utilisateur
                                    </button>
                                    <button class="btn btn-primary" onclick="afficherGestionEleves()">
                                        <i class="fas fa-user-graduate"></i> Inscrire un √©l√®ve
                                    </button>
                                    <button class="btn btn-primary" onclick="afficherGestionEnseignants()">
                                        <i class="fas fa-chalkboard-teacher"></i> Ajouter un enseignant
                                    </button>
                                    ` : ''}
                                    <button class="btn btn-secondary" onclick="afficherParametres()">
                                        <i class="fas fa-cog"></i> Param√®tres
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mention-legale">
                    <i class="fas fa-exclamation-circle"></i>
                    Cette plateforme est une simulation fictive √† usage p√©dagogique.
                </div>
            `;
            
            setActiveMenu('dashboard');
        }
        
        // ============================================
        // GESTION DES UTILISATEURS (COMPL√àTE)
        // ============================================
        
        function afficherGestionUtilisateurs() {
            document.getElementById('contenuPrincipal').innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h1 style="color: var(--couleur-principale);">Gestion des utilisateurs</h1>
                    <button class="btn btn-primary" onclick="ouvrirModalNouvelUtilisateur()">
                        <i class="fas fa-user-plus"></i> Nouvel utilisateur
                    </button>
                </div>
                
                <div class="tabs">
                    <div class="tab active" onclick="changerOngletUtilisateurs('liste')">Tous les utilisateurs</div>
                    <div class="tab" onclick="changerOngletUtilisateurs('enseignants')">Enseignants</div>
                    <div class="tab" onclick="changerOngletUtilisateurs('eleves')">√âl√®ves</div>
                    <div class="tab" onclick="changerOngletUtilisateurs('parents')">Parents</div>
                </div>
                
                <div id="contenuUtilisateurs">
                    <!-- Contenu des onglets -->
                </div>
            `;
            
            setActiveMenu('utilisateurs');
            afficherListeUtilisateurs();
        }
        
        function afficherListeUtilisateurs() {
            let html = `
                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">Utilisateurs du syst√®me (${SCOLARIS_DATA.utilisateurs.length})</div>
                        <button class="btn btn-secondary btn-small" onclick="exporterUtilisateurs()">
                            <i class="fas fa-file-export"></i> Exporter
                        </button>
                    </div>
                    <div class="table-content">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nom</th>
                                    <th>Pr√©nom</th>
                                    <th>R√¥le</th>
                                    <th>Identifiant</th>
                                    <th>Email</th>
                                    <th>Date cr√©ation</th>
                                    <th>Statut</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${SCOLARIS_DATA.utilisateurs.map(utilisateur => {
                                    const role = SCOLARIS_DATA.roles.find(r => r.id === utilisateur.role);
                                    return `
                                        <tr>
                                            <td>${utilisateur.id}</td>
                                            <td>${utilisateur.nom}</td>
                                            <td>${utilisateur.prenom}</td>
                                            <td>${role ? role.nom : utilisateur.role}</td>
                                            <td>${utilisateur.identifiant}</td>
                                            <td>${utilisateur.email || ''}</td>
                                            <td>${formatDate(utilisateur.date_creation)}</td>
                                            <td>${utilisateur.actif ? '<span class="badge badge-success">Actif</span>' : '<span class="badge badge-danger">Inactif</span>'}</td>
                                            <td>
                                                <div style="display: flex; gap: 5px;">
                                                    <button class="btn btn-secondary btn-small" onclick="modifierUtilisateur(${utilisateur.id})">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    ${utilisateur.id !== 1 ? `
                                                    <button class="btn btn-danger btn-small" onclick="supprimerUtilisateur(${utilisateur.id})">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                    ` : ''}
                                                </div>
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            document.getElementById('contenuUtilisateurs').innerHTML = html;
        }
        
        function ouvrirModalNouvelUtilisateur() {
            const modalHtml = `
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">üë§ Ajouter un nouvel utilisateur</div>
                        <button class="modal-close" onclick="fermerModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <form id="formNouvelUtilisateur">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nom *</label>
                                    <input type="text" class="form-control" id="nouveauNom" required>
                                </div>
                                <div class="form-group">
                                    <label>Pr√©nom *</label>
                                    <input type="text" class="form-control" id="nouveauPrenom" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>R√¥le *</label>
                                    <select class="form-control" id="nouveauRole" required>
                                        <option value="">S√©lectionner un r√¥le</option>
                                        ${SCOLARIS_DATA.roles.map(role => `
                                            <option value="${role.id}">${role.nom}</option>
                                        `).join('')}
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Identifiant *</label>
                                    <input type="text" class="form-control" id="nouveauIdentifiant" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Mot de passe *</label>
                                    <input type="password" class="form-control" id="nouveauPassword" value="scolaris2025" required>
                                </div>
                                <div class="form-group">
                                    <label>Confirmer le mot de passe *</label>
                                    <input type="password" class="form-control" id="nouveauPasswordConfirm" value="scolaris2025" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="email" class="form-control" id="nouveauEmail">
                                </div>
                                <div class="form-group">
                                    <label>T√©l√©phone</label>
                                    <input type="tel" class="form-control" id="nouveauTelephone">
                                </div>
                            </div>
                            
                            <div id="champsEnseignant" style="display: none;">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Mati√®res enseign√©es</label>
                                        <select class="form-control" id="nouveauMati√®res" multiple style="height: 100px;">
                                            ${SCOLARIS_DATA.matieres.map(matiere => `
                                                <option value="${matiere.id}">${matiere.nom}</option>
                                            `).join('')}
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="fermerModal()">Annuler</button>
                        <button class="btn btn-primary" onclick="creerNouvelUtilisateur()">
                            <i class="fas fa-save"></i> Cr√©er l'utilisateur
                        </button>
                    </div>
                </div>
            `;
            
            ouvrirModal(modalHtml);
            
            // Afficher/masquer les champs sp√©cifiques selon le r√¥le
            document.getElementById('nouveauRole').addEventListener('change', function() {
                const champsEnseignant = document.getElementById('champsEnseignant');
                if (this.value === 'enseignant') {
                    champsEnseignant.style.display = 'block';
                } else {
                    champsEnseignant.style.display = 'none';
                }
            });
        }
        
        function creerNouvelUtilisateur() {
            const nom = document.getElementById('nouveauNom').value;
            const prenom = document.getElementById('nouveauPrenom').value;
            const role = document.getElementById('nouveauRole').value;
            const identifiant = document.getElementById('nouveauIdentifiant').value;
            const password = document.getElementById('nouveauPassword').value;
            const passwordConfirm = document.getElementById('nouveauPasswordConfirm').value;
            const email = document.getElementById('nouveauEmail').value;
            const telephone = document.getElementById('nouveauTelephone').value;
            
            // Validation
            if (!nom || !prenom || !role || !identifiant || !password) {
                alert('Veuillez remplir tous les champs obligatoires (*)');
                return;
            }
            
            if (password !== passwordConfirm) {
                alert('Les mots de passe ne correspondent pas');
                return;
            }
            
            // V√©rifier si l'identifiant existe d√©j√†
            if (SCOLARIS_DATA.utilisateurs.find(u => u.identifiant === identifiant)) {
                alert('Cet identifiant est d√©j√† utilis√©');
                return;
            }
            
            // Cr√©er le nouvel utilisateur
            const nouvelId = Math.max(...SCOLARIS_DATA.utilisateurs.map(u => u.id), 0) + 1;
            const nouvelUtilisateur = {
                id: nouvelId,
                nom: nom,
                prenom: prenom,
                role: role,
                identifiant: identifiant,
                password: password,
                email: email,
                telephone: telephone,
                date_creation: new Date().toISOString().split('T')[0],
                actif: true
            };
            
            // Ajouter les mati√®res pour les enseignants
            if (role === 'enseignant') {
                const matieresSelect = document.getElementById('nouveauMati√®res');
                const matieresSelectionnees = Array.from(matieresSelect.selectedOptions).map(opt => parseInt(opt.value));
                nouvelUtilisateur.matieres = matieresSelectionnees;
                nouvelUtilisateur.classes = []; // Classes vides au d√©part
            }
            
            // Ajouter l'ID √©l√®ve pour les comptes √©l√®ves
            if (role === 'eleve') {
                // On cherche si un √©l√®ve existe avec ce nom/pr√©nom
                const eleveExistants = SCOLARIS_DATA.eleves.filter(e => 
                    e.nom.toLowerCase() === nom.toLowerCase() && 
                    e.prenom.toLowerCase() === prenom.toLowerCase()
                );
                
                if (eleveExistants.length > 0) {
                    nouvelUtilisateur.eleve_id = eleveExistants[0].id;
                }
            }
            
            SCOLARIS_DATA.utilisateurs.push(nouvelUtilisateur);
            sauvegarderDonnees();
            
            alert(`Utilisateur cr√©√© avec succ√®s !\n\nIdentifiant: ${identifiant}\nMot de passe: ${password}`);
            fermerModal();
            afficherGestionUtilisateurs();
        }
        
        function modifierUtilisateur(utilisateurId) {
            const utilisateur = SCOLARIS_DATA.utilisateurs.find(u => u.id === utilisateurId);
            if (!utilisateur) return;
            
            const modalHtml = `
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">‚úèÔ∏è Modifier l'utilisateur</div>
                        <button class="modal-close" onclick="fermerModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <form id="formModifierUtilisateur">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nom *</label>
                                    <input type="text" class="form-control" id="modifNom" value="${utilisateur.nom}" required>
                                </div>
                                <div class="form-group">
                                    <label>Pr√©nom *</label>
                                    <input type="text" class="form-control" id="modifPrenom" value="${utilisateur.prenom}" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>R√¥le *</label>
                                    <select class="form-control" id="modifRole" required>
                                        ${SCOLARIS_DATA.roles.map(role => `
                                            <option value="${role.id}" ${utilisateur.role === role.id ? 'selected' : ''}>${role.nom}</option>
                                        `).join('')}
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Identifiant *</label>
                                    <input type="text" class="form-control" id="modifIdentifiant" value="${utilisateur.identifiant}" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nouveau mot de passe</label>
                                    <input type="password" class="form-control" id="modifPassword" placeholder="Laisser vide pour ne pas changer">
                                </div>
                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="email" class="form-control" id="modifEmail" value="${utilisateur.email || ''}">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>T√©l√©phone</label>
                                    <input type="tel" class="form-control" id="modifTelephone" value="${utilisateur.telephone || ''}">
                                </div>
                                <div class="form-group">
                                    <label>Statut</label>
                                    <select class="form-control" id="modifStatut">
                                        <option value="true" ${utilisateur.actif ? 'selected' : ''}>Actif</option>
                                        <option value="false" ${!utilisateur.actif ? 'selected' : ''}>Inactif</option>
                                    </select>
                                </div>
                            </div>
                            
                            ${utilisateur.role === 'enseignant' ? `
                            <div id="champsEnseignantModif">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Mati√®res enseign√©es</label>
                                        <select class="form-control" id="modifMatieres" multiple style="height: 100px;">
                                            ${SCOLARIS_DATA.matieres.map(matiere => `
                                                <option value="${matiere.id}" ${utilisateur.matieres && utilisateur.matieres.includes(matiere.id) ? 'selected' : ''}>
                                                    ${matiere.nom}
                                                </option>
                                            `).join('')}
                                        </select>
                                    </div>
                                </div>
                            </div>
                            ` : ''}
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="fermerModal()">Annuler</button>
                        <button class="btn btn-primary" onclick="sauvegarderModificationUtilisateur(${utilisateurId})">
                            <i class="fas fa-save"></i> Enregistrer
                        </button>
                    </div>
                </div>
            `;
            
            ouvrirModal(modalHtml);
        }
        
        function sauvegarderModificationUtilisateur(utilisateurId) {
            const utilisateurIndex = SCOLARIS_DATA.utilisateurs.findIndex(u => u.id === utilisateurId);
            if (utilisateurIndex === -1) return;
            
            const utilisateur = SCOLARIS_DATA.utilisateurs[utilisateurIndex];
            
            // Mettre √† jour les informations
            utilisateur.nom = document.getElementById('modifNom').value;
            utilisateur.prenom = document.getElementById('modifPrenom').value;
            utilisateur.role = document.getElementById('modifRole').value;
            utilisateur.identifiant = document.getElementById('modifIdentifiant').value;
            utilisateur.email = document.getElementById('modifEmail').value;
            utilisateur.telephone = document.getElementById('modifTelephone').value;
            utilisateur.actif = document.getElementById('modifStatut').value === 'true';
            
            // Mettre √† jour le mot de passe si fourni
            const nouveauPassword = document.getElementById('modifPassword').value;
            if (nouveauPassword) {
                utilisateur.password = nouveauPassword;
            }
            
            // Mettre √† jour les mati√®res pour les enseignants
            if (utilisateur.role === 'enseignant') {
                const matieresSelect = document.getElementById('modifMatieres');
                if (matieresSelect) {
                    const matieresSelectionnees = Array.from(matieresSelect.selectedOptions).map(opt => parseInt(opt.value));
                    utilisateur.matieres = matieresSelectionnees;
                }
            }
            
            sauvegarderDonnees();
            alert('Utilisateur modifi√© avec succ√®s !');
            fermerModal();
            afficherGestionUtilisateurs();
        }
        
        function supprimerUtilisateur(utilisateurId) {
            if (utilisateurId === 1) {
                alert('Impossible de supprimer l\'administrateur principal');
                return;
            }
            
            if (!confirm('√ätes-vous s√ªr de vouloir supprimer cet utilisateur ? Cette action est irr√©versible.')) {
                return;
            }
            
            SCOLARIS_DATA.utilisateurs = SCOLARIS_DATA.utilisateurs.filter(u => u.id !== utilisateurId);
            sauvegarderDonnees();
            alert('Utilisateur supprim√© avec succ√®s !');
            afficherGestionUtilisateurs();
        }
        
        // ============================================
        // GESTION DES ENSEIGNANTS (COMPL√àTE)
        // ============================================
        
        function afficherGestionEnseignants() {
            const enseignants = SCOLARIS_DATA.utilisateurs.filter(u => u.role === 'enseignant' && u.actif);
            
            document.getElementById('contenuPrincipal').innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h1 style="color: var(--couleur-principale);">Gestion des enseignants</h1>
                    <button class="btn btn-primary" onclick="ouvrirModalNouvelEnseignant()">
                        <i class="fas fa-user-plus"></i> Nouvel enseignant
                    </button>
                </div>
                
                <div class="cards-container" style="margin-bottom: 30px;">
                    <div class="card">
                        <div class="card-title">Enseignants actifs</div>
                        <div class="card-value">${enseignants.length}</div>
                        <div class="card-subtitle">Personnel enseignant</div>
                    </div>
                    <div class="card">
                        <div class="card-title">Mati√®res couvertes</div>
                        <div class="card-value">${new Set(enseignants.flatMap(e => e.matieres || [])).size}</div>
                        <div class="card-subtitle">Mati√®res diff√©rentes</div>
                    </div>
                    <div class="card">
                        <div class="card-title">Services</div>
                        <div class="card-value">18h</div>
                        <div class="card-subtitle">Moyenne hebdomadaire</div>
                    </div>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">Liste des enseignants</div>
                        <button class="btn btn-secondary btn-small" onclick="exporterEnseignants()">
                            <i class="fas fa-file-export"></i> Exporter
                        </button>
                    </div>
                    <div class="table-content">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nom</th>
                                    <th>Pr√©nom</th>
                                    <th>Mati√®res</th>
                                    <th>Classes</th>
                                    <th>Email</th>
                                    <th>T√©l√©phone</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${enseignants.map(enseignant => {
                                    const matieres = (enseignant.matieres || []).map(mId => 
                                        SCOLARIS_DATA.matieres.find(m => m.id === mId)?.nom
                                    ).filter(Boolean).join(', ');
                                    
                                    const classesEnseignantes = SCOLARIS_DATA.classes.filter(c => 
                                        c.prof_principal_id === enseignant.id
                                    ).map(c => c.nom).join(', ');
                                    
                                    return `
                                        <tr>
                                            <td><strong>${enseignant.nom}</strong></td>
                                            <td>${enseignant.prenom}</td>
                                            <td>${matieres || 'Non attribu√©'}</td>
                                            <td>${classesEnseignantes || 'Non attribu√©'}</td>
                                            <td>${enseignant.email || ''}</td>
                                            <td>${enseignant.telephone || ''}</td>
                                            <td>
                                                <div style="display: flex; gap: 5px;">
                                                    <button class="btn btn-secondary btn-small" onclick="affecterClassesEnseignant(${enseignant.id})">
                                                        <i class="fas fa-chalkboard"></i>
                                                    </button>
                                                    <button class="btn btn-secondary btn-small" onclick="modifierUtilisateur(${enseignant.id})">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button class="btn btn-danger btn-small" onclick="supprimerUtilisateur(${enseignant.id})">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                ${enseignants.length === 0 ? `
                <div class="form-container" style="text-align: center; padding: 40px;">
                    <i class="fas fa-chalkboard-teacher" style="font-size: 3rem; color: #ddd; margin-bottom: 20px;"></i>
                    <h3 style="color: #666; margin-bottom: 15px;">Aucun enseignant enregistr√©</h3>
                    <p style="color: #888; margin-bottom: 25px;">Commencez par ajouter vos premiers enseignants.</p>
                    <button class="btn btn-primary" onclick="ouvrirModalNouvelEnseignant()">
                        <i class="fas fa-user-plus"></i> Ajouter le premier enseignant
                    </button>
                </div>
                ` : ''}
            `;
            
            setActiveMenu('enseignants');
        }
        
        function ouvrirModalNouvelEnseignant() {
            const modalHtml = `
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">üë®‚Äçüè´ Ajouter un nouvel enseignant</div>
                        <button class="modal-close" onclick="fermerModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <form id="formNouvelEnseignant">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nom *</label>
                                    <input type="text" class="form-control" id="enseignantNom" required>
                                </div>
                                <div class="form-group">
                                    <label>Pr√©nom *</label>
                                    <input type="text" class="form-control" id="enseignantPrenom" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Identifiant *</label>
                                    <input type="text" class="form-control" id="enseignantIdentifiant" required>
                                </div>
                                <div class="form-group">
                                    <label>Mot de passe *</label>
                                    <input type="password" class="form-control" id="enseignantPassword" value="enseignant123" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="email" class="form-control" id="enseignantEmail">
                                </div>
                                <div class="form-group">
                                    <label>T√©l√©phone</label>
                                    <input type="tel" class="form-control" id="enseignantTelephone">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Mati√®res enseign√©es *</label>
                                    <select class="form-control" id="enseignantMatieres" multiple style="height: 120px;" required>
                                        ${SCOLARIS_DATA.matieres.map(matiere => `
                                            <option value="${matiere.id}">${matiere.nom}</option>
                                        `).join('')}
                                    </select>
                                    <small style="color: #666;">Maintenez Ctrl pour s√©lectionner plusieurs mati√®res</small>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Date de recrutement</label>
                                    <input type="date" class="form-control" id="enseignantRecrutement" 
                                           value="${new Date().toISOString().split('T')[0]}">
                                </div>
                                <div class="form-group">
                                    <label>Statut</label>
                                    <select class="form-control" id="enseignantStatut">
                                        <option value="titulaire">Titulaire</option>
                                        <option value="contractuel">Contractuel</option>
                                        <option value="stagiaire">Stagiaire</option>
                                    </select>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="fermerModal()">Annuler</button>
                        <button class="btn btn-primary" onclick="creerNouvelEnseignant()">
                            <i class="fas fa-save"></i> Cr√©er l'enseignant
                        </button>
                    </div>
                </div>
            `;
            
            ouvrirModal(modalHtml);
        }
        
        function creerNouvelEnseignant() {
            const nom = document.getElementById('enseignantNom').value;
            const prenom = document.getElementById('enseignantPrenom').value;
            const identifiant = document.getElementById('enseignantIdentifiant').value;
            const password = document.getElementById('enseignantPassword').value;
            const email = document.getElementById('enseignantEmail').value;
            const telephone = document.getElementById('enseignantTelephone').value;
            const matieresSelect = document.getElementById('enseignantMatieres');
            const recrutement = document.getElementById('enseignantRecrutement').value;
            const statut = document.getElementById('enseignantStatut').value;
            
            // Validation
            if (!nom || !prenom || !identifiant || !password) {
                alert('Veuillez remplir tous les champs obligatoires (*)');
                return;
            }
            
            const matieresSelectionnees = Array.from(matieresSelect.selectedOptions).map(opt => parseInt(opt.value));
            if (matieresSelectionnees.length === 0) {
                alert('Veuillez s√©lectionner au moins une mati√®re');
                return;
            }
            
            // V√©rifier si l'identifiant existe d√©j√†
            if (SCOLARIS_DATA.utilisateurs.find(u => u.identifiant === identifiant)) {
                alert('Cet identifiant est d√©j√† utilis√©');
                return;
            }
            
            // Cr√©er le nouvel enseignant
            const nouvelId = Math.max(...SCOLARIS_DATA.utilisateurs.map(u => u.id), 0) + 1;
            const nouvelEnseignant = {
                id: nouvelId,
                nom: nom,
                prenom: prenom,
                role: 'enseignant',
                identifiant: identifiant,
                password: password,
                email: email,
                telephone: telephone,
                date_creation: new Date().toISOString().split('T')[0],
                actif: true,
                matieres: matieresSelectionnees,
                classes: [],
                date_recrutement: recrutement,
                statut: statut,
                service: 18 // heures par semaine par d√©faut
            };
            
            SCOLARIS_DATA.utilisateurs.push(nouvelEnseignant);
            sauvegarderDonnees();
            
            alert(`Enseignant cr√©√© avec succ√®s !\n\nIdentifiant: ${identifiant}\nMot de passe: ${password}`);
            fermerModal();
            afficherGestionEnseignants();
        }
        
        function affecterClassesEnseignant(enseignantId) {
            const enseignant = SCOLARIS_DATA.utilisateurs.find(u => u.id === enseignantId);
            if (!enseignant) return;
            
            const modalHtml = `
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">üè´ Affecter des classes √† ${enseignant.prenom} ${enseignant.nom}</div>
                        <button class="modal-close" onclick="fermerModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <div style="margin-bottom: 20px;">
                            <p><strong>Enseignant :</strong> ${enseignant.prenom} ${enseignant.nom}</p>
                            <p><strong>Mati√®res :</strong> ${(enseignant.matieres || []).map(mId => 
                                SCOLARIS_DATA.matieres.find(m => m.id === mId)?.nom
                            ).filter(Boolean).join(', ')}</p>
                        </div>
                        
                        <h4 style="color: var(--couleur-principale); margin-bottom: 15px;">Classes disponibles</h4>
                        <div class="table-content" style="max-height: 300px; overflow-y: auto;">
                            <table>
                                <thead>
                                    <tr>
                                        <th style="width: 50px;">Affecter</th>
                                        <th>Classe</th>
                                        <th>Niveau</th>
                                        <th>Effectif</th>
                                        <th>Professeur principal</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${SCOLARIS_DATA.classes.map(classe => {
                                        const estProfesseurPrincipal = classe.prof_principal_id === enseignantId;
                                        const estAffecte = enseignant.classes && enseignant.classes.includes(classe.id);
                                        
                                        return `
                                            <tr>
                                                <td style="text-align: center;">
                                                    <input type="checkbox" id="classe_${classe.id}" 
                                                           ${estAffecte || estProfesseurPrincipal ? 'checked' : ''}
                                                           ${estProfesseurPrincipal ? 'disabled' : ''}>
                                                </td>
                                                <td>${classe.nom}</td>
                                                <td>${classe.niveau}</td>
                                                <td>${SCOLARIS_DATA.eleves.filter(e => e.classe_id === classe.id).length} √©l√®ves</td>
                                                <td>${classe.prof_principal || 'Non attribu√©'}</td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                        
                        ${SCOLARIS_DATA.classes.length === 0 ? `
                        <div style="text-align: center; padding: 30px; color: #666;">
                            <i class="fas fa-users" style="font-size: 2rem; margin-bottom: 10px;"></i>
                            <p>Aucune classe disponible. Cr√©ez d'abord des classes.</p>
                        </div>
                        ` : ''}
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="fermerModal()">Annuler</button>
                        <button class="btn btn-primary" onclick="sauvegarderAffectationClasses(${enseignantId})">
                            <i class="fas fa-save"></i> Enregistrer les affectations
                        </button>
                    </div>
                </div>
            `;
            
            ouvrirModal(modalHtml);
        }
        
        function sauvegarderAffectationClasses(enseignantId) {
            const enseignantIndex = SCOLARIS_DATA.utilisateurs.findIndex(u => u.id === enseignantId);
            if (enseignantIndex === -1) return;
            
            const classesAffectees = [];
            SCOLARIS_DATA.classes.forEach(classe => {
                const checkbox = document.getElementById(`classe_${classe.id}`);
                if (checkbox && checkbox.checked && !checkbox.disabled) {
                    classesAffectees.push(classe.id);
                }
            });
            
            SCOLARIS_DATA.utilisateurs[enseignantIndex].classes = classesAffectees;
            sauvegarderDonnees();
            
            alert('Affectation des classes enregistr√©e avec succ√®s !');
            fermerModal();
            afficherGestionEnseignants();
        }
        
        // ============================================
        // GESTION DES √âL√àVES (COMPL√àTE)
        // ============================================
        
        function afficherGestionEleves() {
            document.getElementById('contenuPrincipal').innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h1 style="color: var(--couleur-principale);">Gestion des √©l√®ves</h1>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" onclick="ouvrirModalNouvelEleve()">
                            <i class="fas fa-user-plus"></i> Nouvel √©l√®ve
                        </button>
                        <button class="btn btn-secondary" onclick="importerEleves()">
                            <i class="fas fa-file-import"></i> Importer
                        </button>
                    </div>
                </div>
                
                <div class="form-row" style="margin-bottom: 20px;">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Rechercher un √©l√®ve..." 
                               onkeyup="rechercherEleves(this.value)">
                    </div>
                    <div class="form-group" style="width: 200px;">
                        <select class="form-control" onchange="filtrerElevesParClasse(this.value)">
                            <option value="">Toutes les classes</option>
                            ${SCOLARIS_DATA.classes.map(classe => `
                                <option value="${classe.id}">${classe.nom}</option>
                            `).join('')}
                        </select>
                    </div>
                    <div class="form-group" style="width: 150px;">
                        <select class="form-control" onchange="filtrerElevesParNiveau(this.value)">
                            <option value="">Tous niveaux</option>
                            <option value="6√®me">6√®me</option>
                            <option value="5√®me">5√®me</option>
                            <option value="4√®me">4√®me</option>
                            <option value="3√®me">3√®me</option>
                        </select>
                    </div>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">√âl√®ves inscrits (${SCOLARIS_DATA.eleves.length})</div>
                        <button class="btn btn-secondary btn-small" onclick="exporterEleves()">
                            <i class="fas fa-file-export"></i> Exporter
                        </button>
                    </div>
                    <div class="table-content">
                        <table id="tableEleves">
                            <thead>
                                <tr>
                                    <th>Nom</th>
                                    <th>Pr√©nom</th>
                                    <th>Classe</th>
                                    <th>Date de naissance</th>
                                    <th>Responsable</th>
                                    <th>T√©l√©phone</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${SCOLARIS_DATA.eleves.map(eleve => {
                                    const classe = SCOLARIS_DATA.classes.find(c => c.id === eleve.classe_id);
                                    return `
                                        <tr data-eleve-id="${eleve.id}">
                                            <td><strong>${eleve.nom}</strong></td>
                                            <td>${eleve.prenom}</td>
                                            <td>${classe ? classe.nom : 'Non affect√©'}</td>
                                            <td>${formatDate(eleve.date_naissance)}</td>
                                            <td>${eleve.responsable_1 || ''}</td>
                                            <td>${eleve.tel_responsable_1 || ''}</td>
                                            <td>
                                                <div style="display: flex; gap: 5px;">
                                                    <button class="btn btn-secondary btn-small" onclick="voirFicheEleve(${eleve.id})">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                    <button class="btn btn-secondary btn-small" onclick="modifierEleve(${eleve.id})">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button class="btn btn-danger btn-small" onclick="supprimerEleve(${eleve.id})">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                ${SCOLARIS_DATA.eleves.length === 0 ? `
                <div class="form-container" style="text-align: center; padding: 40px;">
                    <i class="fas fa-user-graduate" style="font-size: 3rem; color: #ddd; margin-bottom: 20px;"></i>
                    <h3 style="color: #666; margin-bottom: 15px;">Aucun √©l√®ve enregistr√©</h3>
                    <p style="color: #888; margin-bottom: 25px;">Commencez par inscrire vos premiers √©l√®ves.</p>
                    <button class="btn btn-primary" onclick="ouvrirModalNouvelEleve()">
                        <i class="fas fa-user-plus"></i> Inscrire le premier √©l√®ve
                    </button>
                </div>
                ` : ''}
            `;
            
            setActiveMenu('eleves');
        }
        
        function ouvrirModalNouvelEleve() {
            const modalHtml = `
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header">
                        <div class="modal-title">üë§ Inscrire un nouvel √©l√®ve</div>
                        <button class="modal-close" onclick="fermerModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <form id="formNouvelEleve">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nom *</label>
                                    <input type="text" class="form-control" id="eleveNom" required>
                                </div>
                                <div class="form-group">
                                    <label>Pr√©nom *</label>
                                    <input type="text" class="form-control" id="elevePrenom" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Date de naissance *</label>
                                    <input type="date" class="form-control" id="eleveNaissance" required>
                                </div>
                                <div class="form-group">
                                    <label>Classe *</label>
                                    <select class="form-control" id="eleveClasse" required>
                                        <option value="">S√©lectionner une classe</option>
                                        ${SCOLARIS_DATA.classes.map(classe => `
                                            <option value="${classe.id}">${classe.nom}</option>
                                        `).join('')}
                                    </select>
                                </div>
                            </div>
                            
                            <h4 style="color: var(--couleur-principale); margin: 25px 0 15px 0;">Responsable l√©gal 1</h4>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nom du responsable *</label>
                                    <input type="text" class="form-control" id="eleveResponsable1" required>
                                </div>
                                <div class="form-group">
                                    <label>T√©l√©phone *</label>
                                    <input type="tel" class="form-control" id="eleveTel1" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="email" class="form-control" id="eleveEmail1">
                                </div>
                                <div class="form-group">
                                    <label>Lien de parent√©</label>
                                    <select class="form-control" id="eleveParente1">
                                        <option value="M√®re">M√®re</option>
                                        <option value="P√®re">P√®re</option>
                                        <option value="Tuteur">Tuteur</option>
                                        <option value="Autre">Autre</option>
                                    </select>
                                </div>
                            </div>
                            
                            <h4 style="color: var(--couleur-principale); margin: 25px 0 15px 0;">Responsable l√©gal 2 (optionnel)</h4>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nom du responsable</label>
                                    <input type="text" class="form-control" id="eleveResponsable2">
                                </div>
                                <div class="form-group">
                                    <label>T√©l√©phone</label>
                                    <input type="tel" class="form-control" id="eleveTel2">
                                </div>
                            </div>
                            
                            <h4 style="color: var(--couleur-principale); margin: 25px 0 15px 0;">Informations compl√©mentaires</h4>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Adresse</label>
                                    <input type="text" class="form-control" id="eleveAdresse">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Code postal</label>
                                    <input type="text" class="form-control" id="eleveCP">
                                </div>
                                <div class="form-group">
                                    <label>Ville</label>
                                    <input type="text" class="form-control" id="eleveVille">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Informations m√©dicales</label>
                                    <textarea class="form-control" id="eleveMedical" rows="3" placeholder="Allergies, traitements..."></textarea>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="fermerModal()">Annuler</button>
                        <button class="btn btn-primary" onclick="creerNouvelEleve()">
                            <i class="fas fa-save"></i> Inscrire l'√©l√®ve
                        </button>
                    </div>
                </div>
            `;
            
            ouvrirModal(modalHtml);
        }
        
        function creerNouvelEleve() {
            const nom = document.getElementById('eleveNom').value;
            const prenom = document.getElementById('elevePrenom').value;
            const naissance = document.getElementById('eleveNaissance').value;
            const classeId = document.getElementById('eleveClasse').value;
            const responsable1 = document.getElementById('eleveResponsable1').value;
            const tel1 = document.getElementById('eleveTel1').value;
            
            if (!nom || !prenom || !naissance || !classeId || !responsable1 || !tel1) {
                alert('Veuillez remplir tous les champs obligatoires (*)');
                return;
            }
            
            const classe = SCOLARIS_DATA.classes.find(c => c.id === classeId);
            if (!classe) {
                alert('Classe s√©lectionn√©e invalide');
                return;
            }
            
            const nouvelId = Math.max(...SCOLARIS_DATA.eleves.map(e => e.id), 0) + 1;
            const nouvelEleve = {
                id: nouvelId,
                nom: nom,
                prenom: prenom,
                classe: classe.nom,
                classe_id: classeId,
                date_naissance: naissance,
                responsable_1: responsable1,
                tel_responsable_1: tel1,
                email_responsable_1: document.getElementById('eleveEmail1').value,
                parente_responsable_1: document.getElementById('eleveParente1').value,
                responsable_2: document.getElementById('eleveResponsable2').value,
                tel_responsable_2: document.getElementById('eleveTel2').value,
                adresse: document.getElementById('eleveAdresse').value,
                code_postal: document.getElementById('eleveCP').value,
                ville: document.getElementById('eleveVille').value,
                informations_medicales: document.getElementById('eleveMedical').value,
                date_inscription: new Date().toISOString().split('T')[0],
                statut: 'inscrit'
            };
            
            SCOLARIS_DATA.eleves.push(nouvelEleve);
            sauvegarderDonnees();
            
            // Cr√©er automatiquement un compte √©l√®ve
            const nouvelUtilisateurId = Math.max(...SCOLARIS_DATA.utilisateurs.map(u => u.id), 0) + 1;
            const nouvelUtilisateur = {
                id: nouvelUtilisateurId,
                nom: nom,
                prenom: prenom,
                role: 'eleve',
                identifiant: `${prenom.toLowerCase()}.${nom.toLowerCase().substring(0, 3)}`,
                password: 'eleve123',
                email: `${prenom.toLowerCase()}.${nom.toLowerCase()}@edu.${SCOLARIS_DATA.system.etablissement.nom.toLowerCase().replace(/\s+/g, '')}.fr`,
                date_creation: new Date().toISOString().split('T')[0],
                actif: true,
                eleve_id: nouvelId
            };
            
            SCOLARIS_DATA.utilisateurs.push(nouvelUtilisateur);
            sauvegarderDonnees();
            
            alert(`√âl√®ve inscrit avec succ√®s !\n\nUn compte a √©t√© cr√©√© automatiquement :\nIdentifiant: ${nouvelUtilisateur.identifiant}\nMot de passe: eleve123`);
            fermerModal();
            afficherGestionEleves();
        }
        
        function voirFicheEleve(eleveId) {
            const eleve = SCOLARIS_DATA.eleves.find(e => e.id === eleveId);
            if (!eleve) return;
            
            const classe = SCOLARIS_DATA.classes.find(c => c.id === eleve.classe_id);
            const notesEleve = SCOLARIS_DATA.notes.filter(n => n.eleve_id === eleveId);
            const absencesEleve = SCOLARIS_DATA.absences.filter(a => a.eleve_id === eleveId);
            
            const modalHtml = `
                <div class="modal-content" style="max-width: 900px;">
                    <div class="modal-header">
                        <div class="modal-title">üìÑ Fiche √©l√®ve : ${eleve.nom} ${eleve.prenom}</div>
                        <button class="modal-close" onclick="fermerModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <div style="display: flex; gap: 30px; margin-bottom: 25px;">
                            <div style="flex: 1;">
                                <h4 style="color: var(--couleur-principale); margin-bottom: 15px;">Identit√©</h4>
                                <p><strong>Nom :</strong> ${eleve.nom}</p>
                                <p><strong>Pr√©nom :</strong> ${eleve.prenom}</p>
                                <p><strong>Date de naissance :</strong> ${formatDate(eleve.date_naissance)}</p>
                                <p><strong>Classe :</strong> ${classe ? classe.nom : 'Non affect√©'}</p>
                                <p><strong>Date d'inscription :</strong> ${formatDate(eleve.date_inscription)}</p>
                            </div>
                            <div style="flex: 1;">
                                <h4 style="color: var(--couleur-principale); margin-bottom: 15px;">Responsables l√©gaux</h4>
                                <p><strong>Responsable 1 :</strong> ${eleve.responsable_1}</p>
                                <p><strong>T√©l√©phone :</strong> ${eleve.tel_responsable_1}</p>
                                <p><strong>Email :</strong> ${eleve.email_responsable_1 || 'Non renseign√©'}</p>
                                ${eleve.responsable_2 ? `<p><strong>Responsable 2 :</strong> ${eleve.responsable_2}</p>` : ''}
                                ${eleve.tel_responsable_2 ? `<p><strong>T√©l√©phone 2 :</strong> ${eleve.tel_responsable_2}</p>` : ''}
                            </div>
                        </div>
                        
                        ${eleve.informations_medicales ? `
                        <div style="background-color: #f8f9fa; padding: 15px; border-radius: 6px; margin-bottom: 20px;">
                            <h4 style="color: var(--couleur-principale); margin-bottom: 10px;">Informations m√©dicales</h4>
                            <p>${eleve.informations_medicales}</p>
                        </div>
                        ` : ''}
                        
                        <div style="display: flex; gap: 30px; margin-bottom: 20px;">
                            <div>
                                <h4 style="color: var(--couleur-principale); margin-bottom: 10px;">Scolarit√©</h4>
                                <p><strong>Notes enregistr√©es :</strong> ${notesEleve.length}</p>
                                <p><strong>Absences cette ann√©e :</strong> ${absencesEleve.length}</p>
                                <p><strong>Statut :</strong> ${eleve.statut || 'Inscrit'}</p>
                            </div>
                            <div>
                                <h4 style="color: var(--couleur-principale); margin-bottom: 10px;">Coordonn√©es</h4>
                                <p><strong>Adresse :</strong> ${eleve.adresse || 'Non renseign√©e'}</p>
                                <p><strong>Ville :</strong> ${eleve.ville || ''} ${eleve.code_postal || ''}</p>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <h4 style="color: var(--couleur-principale); margin-bottom: 15px;">Actions</h4>
                            <div style="display: flex; gap: 10px;">
                                <button class="btn btn-primary" onclick="genererFicheElevePDF(${eleveId})">
                                    <i class="fas fa-print"></i> Imprimer la fiche
                                </button>
                                <button class="btn btn-secondary" onclick="modifierEleve(${eleveId})">
                                    <i class="fas fa-edit"></i> Modifier
                                </button>
                                <button class="btn btn-secondary" onclick="voirNotesEleve(${eleveId})">
                                    <i class="fas fa-graduation-cap"></i> Voir les notes
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="fermerModal()">Fermer</button>
                    </div>
                </div>
            `;
            
            ouvrirModal(modalHtml);
        }
        
        function modifierEleve(eleveId) {
            const eleve = SCOLARIS_DATA.eleves.find(e => e.id === eleveId);
            if (!eleve) return;
            
            const modalHtml = `
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header">
                        <div class="modal-title">‚úèÔ∏è Modifier l'√©l√®ve</div>
                        <button class="modal-close" onclick="fermerModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <form id="formModifierEleve">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nom *</label>
                                    <input type="text" class="form-control" id="modifEleveNom" value="${eleve.nom}" required>
                                </div>
                                <div class="form-group">
                                    <label>Pr√©nom *</label>
                                    <input type="text" class="form-control" id="modifElevePrenom" value="${eleve.prenom}" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Date de naissance *</label>
                                    <input type="date" class="form-control" id="modifEleveNaissance" value="${eleve.date_naissance}" required>
                                </div>
                                <div class="form-group">
                                    <label>Classe *</label>
                                    <select class="form-control" id="modifEleveClasse" required>
                                        ${SCOLARIS_DATA.classes.map(classe => `
                                            <option value="${classe.id}" ${eleve.classe_id === classe.id ? 'selected' : ''}>
                                                ${classe.nom}
                                            </option>
                                        `).join('')}
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Statut</label>
                                    <select class="form-control" id="modifEleveStatut">
                                        <option value="inscrit" ${eleve.statut === 'inscrit' ? 'selected' : ''}>Inscrit</option>
                                        <option value="radie" ${eleve.statut === 'radie' ? 'selected' : ''}>Radi√©</option>
                                        <option value="exclu" ${eleve.statut === 'exclu' ? 'selected' : ''}>Exclu</option>
                                        <option value="demenage" ${eleve.statut === 'demenage' ? 'selected' : ''}>D√©m√©nag√©</option>
                                    </select>
                                </div>
                            </div>
                            
                            <h4 style="color: var(--couleur-principale); margin: 25px 0 15px 0;">Responsable l√©gal 1</h4>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nom du responsable *</label>
                                    <input type="text" class="form-control" id="modifEleveResponsable1" value="${eleve.responsable_1}" required>
                                </div>
                                <div class="form-group">
                                    <label>T√©l√©phone *</label>
                                    <input type="tel" class="form-control" id="modifEleveTel1" value="${eleve.tel_responsable_1}" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="email" class="form-control" id="modifEleveEmail1" value="${eleve.email_responsable_1 || ''}">
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="fermerModal()">Annuler</button>
                        <button class="btn btn-primary" onclick="sauvegarderModificationEleve(${eleveId})">
                            <i class="fas fa-save"></i> Enregistrer
                        </button>
                    </div>
                </div>
            `;
            
            ouvrirModal(modalHtml);
        }
        
        function sauvegarderModificationEleve(eleveId) {
            const eleveIndex = SCOLARIS_DATA.eleves.findIndex(e => e.id === eleveId);
            if (eleveIndex === -1) return;
            
            const eleve = SCOLARIS_DATA.eleves[eleveIndex];
            const nouvelleClasseId = document.getElementById('modifEleveClasse').value;
            const nouvelleClasse = SCOLARIS_DATA.classes.find(c => c.id === nouvelleClasseId);
            
            eleve.nom = document.getElementById('modifEleveNom').value;
            eleve.prenom = document.getElementById('modifElevePrenom').value;
            eleve.date_naissance = document.getElementById('modifEleveNaissance').value;
            eleve.classe_id = nouvelleClasseId;
            eleve.classe = nouvelleClasse ? nouvelleClasse.nom : eleve.classe;
            eleve.statut = document.getElementById('modifEleveStatut').value;
            eleve.responsable_1 = document.getElementById('modifEleveResponsable1').value;
            eleve.tel_responsable_1 = document.getElementById('modifEleveTel1').value;
            eleve.email_responsable_1 = document.getElementById('modifEleveEmail1').value;
            
            sauvegarderDonnees();
            alert('√âl√®ve modifi√© avec succ√®s !');
            fermerModal();
            afficherGestionEleves();
        }
        
        function supprimerEleve(eleveId) {
            if (!confirm('√ätes-vous s√ªr de vouloir supprimer cet √©l√®ve ? Cette action supprimera √©galement toutes ses notes et absences.')) {
                return;
            }
            
            // Supprimer l'√©l√®ve
            SCOLARIS_DATA.eleves = SCOLARIS_DATA.eleves.filter(e => e.id !== eleveId);
            
            // Supprimer les notes de l'√©l√®ve
            SCOLARIS_DATA.notes = SCOLARIS_DATA.notes.filter(n => n.eleve_id !== eleveId);
            
            // Supprimer les absences de l'√©l√®ve
            SCOLARIS_DATA.absences = SCOLARIS_DATA.absences.filter(a => a.eleve_id !== eleveId);
            
            // Supprimer le compte utilisateur associ√©
            SCOLARIS_DATA.utilisateurs = SCOLARIS_DATA.utilisateurs.filter(u => u.eleve_id !== eleveId);
            
            sauvegarderDonnees();
            alert('√âl√®ve supprim√© avec succ√®s !');
            afficherGestionEleves();
        }
        
        // ============================================
        // GESTION DES CLASSES (COMPL√àTE)
        // ============================================
        
        function afficherGestionClasses() {
            document.getElementById('contenuPrincipal').innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h1 style="color: var(--couleur-principale);">Gestion des classes</h1>
                    <button class="btn btn-primary" onclick="ouvrirModalNouvelleClasse()">
                        <i class="fas fa-plus"></i> Nouvelle classe
                    </button>
                </div>
                
                <div class="cards-container" style="margin-bottom: 30px;">
                    <div class="card">
                        <div class="card-title">Classes actives</div>
                        <div class="card-value">${SCOLARIS_DATA.classes.length}</div>
                        <div class="card-subtitle">Total de l'√©tablissement</div>
                    </div>
                    <div class="card">
                        <div class="card-title">Effectif total</div>
                        <div class="card-value">${SCOLARIS_DATA.eleves.length}</div>
                        <div class="card-subtitle">√âl√®ves inscrits</div>
                    </div>
                    <div class="card">
                        <div class="card-title">Moyenne par classe</div>
                        <div class="card-value">${SCOLARIS_DATA.classes.length > 0 ? Math.round(SCOLARIS_DATA.eleves.length / SCOLARIS_DATA.classes.length) : 0}</div>
                        <div class="card-subtitle">√âl√®ves par classe</div>
                    </div>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">Liste des classes</div>
                        <button class="btn btn-secondary btn-small" onclick="exporterClasses()">
                            <i class="fas fa-file-export"></i> Exporter
                        </button>
                    </div>
                    <div class="table-content">
                        <table>
                            <thead>
                                <tr>
                                    <th>Classe</th>
                                    <th>Niveau</th>
                                    <th>Professeur principal</th>
                                    <th>Effectif</th>
                                    <th>Salle</th>
                                    <th>Moyenne g√©n√©rale</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${SCOLARIS_DATA.classes.map(classe => {
                                    const effectif = SCOLARIS_DATA.eleves.filter(e => e.classe_id === classe.id).length;
                                    const profPrincipal = classe.prof_principal_id ? 
                                        SCOLARIS_DATA.utilisateurs.find(u => u.id === classe.prof_principal_id) : null;
                                    
                                    return `
                                        <tr>
                                            <td><strong>${classe.nom}</strong></td>
                                            <td>${classe.niveau}</td>
                                            <td>${profPrincipal ? profPrincipal.prenom + ' ' + profPrincipal.nom : 'Non attribu√©'}</td>
                                            <td>${effectif} / ${classe.effectif_max || 30}</td>
                                            <td>${classe.salle || ''}</td>
                                            <td>12.8/20</td>
                                            <td>
                                                <div style="display: flex; gap: 5px;">
                                                    <button class="btn btn-secondary btn-small" onclick="voirDetailsClasse('${classe.id}')">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                    <button class="btn btn-secondary btn-small" onclick="modifierClasse('${classe.id}')">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button class="btn btn-danger btn-small" onclick="supprimerClasse('${classe.id}')">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                ${SCOLARIS_DATA.classes.length === 0 ? `
                <div class="form-container" style="text-align: center; padding: 40px;">
                    <i class="fas fa-users" style="font-size: 3rem; color: #ddd; margin-bottom: 20px;"></i>
                    <h3 style="color: #666; margin-bottom: 15px;">Aucune classe cr√©√©e</h3>
                    <p style="color: #888; margin-bottom: 25px;">Commencez par cr√©er vos premi√®res classes.</p>
                    <button class="btn btn-primary" onclick="ouvrirModalNouvelleClasse()">
                        <i class="fas fa-plus"></i> Cr√©er la premi√®re classe
                    </button>
                </div>
                ` : ''}
            `;
            
            setActiveMenu('classes');
        }
        
        function ouvrirModalNouvelleClasse() {
            const modalHtml = `
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">üè´ Cr√©er une nouvelle classe</div>
                        <button class="modal-close" onclick="fermerModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <form id="formNouvelleClasse">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nom de la classe *</label>
                                    <input type="text" class="form-control" id="classeNom" placeholder="Ex: 6√®me A" required>
                                </div>
                                <div class="form-group">
                                    <label>Niveau *</label>
                                    <select class="form-control" id="classeNiveau" required>
                                        <option value="">S√©lectionner</option>
                                        <option value="6√®me">6√®me</option>
                                        <option value="5√®me">5√®me</option>
                                        <option value="4√®me">4√®me</option>
                                        <option value="3√®me">3√®me</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Professeur principal</label>
                                    <select class="form-control" id="classeProfPrincipal">
                                        <option value="">Non attribu√©</option>
                                        ${SCOLARIS_DATA.utilisateurs
                                            .filter(u => u.role === 'enseignant' && u.actif)
                                            .map(prof => `<option value="${prof.id}">${prof.prenom} ${prof.nom}</option>`)
                                            .join('')}
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Effectif maximum</label>
                                    <input type="number" class="form-control" id="classeEffectifMax" value="30" min="1" max="35">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Salle attribu√©e</label>
                                    <input type="text" class="form-control" id="classeSalle" placeholder="Ex: Salle 201">
                                </div>
                                <div class="form-group">
                                    <label>Heure de rentr√©e</label>
                                    <input type="time" class="form-control" id="classeHeureRentree" value="08:30">
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="fermerModal()">Annuler</button>
                        <button class="btn btn-primary" onclick="creerNouvelleClasse()">
                            <i class="fas fa-save"></i> Cr√©er la classe
                        </button>
                    </div>
                </div>
            `;
            
            ouvrirModal(modalHtml);
        }
        
        function creerNouvelleClasse() {
            const nom = document.getElementById('classeNom').value;
            const niveau = document.getElementById('classeNiveau').value;
            const profId = document.getElementById('classeProfPrincipal').value;
            const effectifMax = parseInt(document.getElementById('classeEffectifMax').value);
            const salle = document.getElementById('classeSalle').value;
            const heureRentree = document.getElementById('classeHeureRentree').value;
            
            if (!nom || !niveau) {
                alert('Veuillez remplir tous les champs obligatoires (*)');
                return;
            }
            
            // V√©rifier si la classe existe d√©j√†
            if (SCOLARIS_DATA.classes.find(c => c.nom === nom)) {
                alert('Une classe avec ce nom existe d√©j√†');
                return;
            }
            
            const id = nom.replace(/\s+/g, '');
            const profPrincipal = profId ? 
                SCOLARIS_DATA.utilisateurs.find(u => u.id === parseInt(profId)) : null;
            
            const nouvelleClasse = {
                id: id,
                nom: nom,
                niveau: niveau,
                prof_principal_id: profId ? parseInt(profId) : null,
                prof_principal: profPrincipal ? profPrincipal.prenom + ' ' + profPrincipal.nom : 'Non attribu√©',
                effectif_max: effectifMax,
                salle: salle,
                heure_rentree: heureRentree,
                created_at: new Date().toISOString().split('T')[0]
            };
            
            SCOLARIS_DATA.classes.push(nouvelleClasse);
            sauvegarderDonnees();
            
            alert('Classe cr√©√©e avec succ√®s !');
            fermerModal();
            afficherGestionClasses();
        }
        
        function voirDetailsClasse(classeId) {
            const classe = SCOLARIS_DATA.classes.find(c => c.id === classeId);
            if (!classe) return;
            
            const elevesClasse = SCOLARIS_DATA.eleves.filter(e => e.classe_id === classeId);
            const profPrincipal = classe.prof_principal_id ? 
                SCOLARIS_DATA.utilisateurs.find(u => u.id === classe.prof_principal_id) : null;
            
            const modalHtml = `
                <div class="modal-content" style="max-width: 900px;">
                    <div class="modal-header">
                        <div class="modal-title">üìä D√©tails de la classe : ${classe.nom}</div>
                        <button class="modal-close" onclick="fermerModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <div style="display: flex; gap: 30px; margin-bottom: 25px;">
                            <div style="flex: 1;">
                                <h4 style="color: var(--couleur-principale); margin-bottom: 15px;">Informations</h4>
                                <p><strong>Niveau :</strong> ${classe.niveau}</p>
                                <p><strong>Professeur principal :</strong> ${classe.prof_principal}</p>
                                <p><strong>Salle :</strong> ${classe.salle || 'Non attribu√©e'}</p>
                                <p><strong>Heure de rentr√©e :</strong> ${classe.heure_rentree || '08:30'}</p>
                                <p><strong>Effectif :</strong> ${elevesClasse.length} / ${classe.effectif_max || 30} √©l√®ves</p>
                            </div>
                            <div style="flex: 1;">
                                <h4 style="color: var(--couleur-principale); margin-bottom: 15px;">Statistiques</h4>
                                <p><strong>Moyenne g√©n√©rale :</strong> 12.8/20</p>
                                <p><strong>Taux d'absent√©isme :</strong> 2.1%</p>
                                <p><strong>Retards ce mois :</strong> 8</p>
                                <p><strong>Date de cr√©ation :</strong> ${formatDate(classe.created_at)}</p>
                            </div>
                        </div>
                        
                        <h4 style="color: var(--couleur-principale); margin-bottom: 15px;">Liste des √©l√®ves (${elevesClasse.length})</h4>
                        <div class="table-content" style="max-height: 300px; overflow-y: auto; margin-bottom: 20px;">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Nom</th>
                                        <th>Pr√©nom</th>
                                        <th>Date de naissance</th>
                                        <th>Responsable</th>
                                        <th>T√©l√©phone</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${elevesClasse.map(eleve => `
                                        <tr>
                                            <td>${eleve.nom}</td>
                                            <td>${eleve.prenom}</td>
                                            <td>${formatDate(eleve.date_naissance)}</td>
                                            <td>${eleve.responsable_1}</td>
                                            <td>${eleve.tel_responsable_1}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <h4 style="color: var(--couleur-principale); margin-bottom: 15px;">Actions</h4>
                            <div style="display: flex; gap: 10px;">
                                <button class="btn btn-primary" onclick="genererListeClasse('${classeId}')">
                                    <i class="fas fa-print"></i> Imprimer la liste
                                </button>
                                <button class="btn btn-secondary" onclick="modifierClasse('${classeId}')">
                                    <i class="fas fa-edit"></i> Modifier la classe
                                </button>
                                <button class="btn btn-secondary" onclick="affecterElevesClasse('${classeId}')">
                                    <i class="fas fa-user-plus"></i> Affecter des √©l√®ves
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="fermerModal()">Fermer</button>
                    </div>
                </div>
            `;
            
            ouvrirModal(modalHtml);
        }
        
        function modifierClasse(classeId) {
            const classe = SCOLARIS_DATA.classes.find(c => c.id === classeId);
            if (!classe) return;
            
            const modalHtml = `
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">‚úèÔ∏è Modifier la classe : ${classe.nom}</div>
                        <button class="modal-close" onclick="fermerModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <form id="formModifierClasse">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nom de la classe *</label>
                                    <input type="text" class="form-control" id="modifClasseNom" value="${classe.nom}" required>
                                </div>
                                <div class="form-group">
                                    <label>Niveau *</label>
                                    <select class="form-control" id="modifClasseNiveau" required>
                                        <option value="6√®me" ${classe.niveau === '6√®me' ? 'selected' : ''}>6√®me</option>
                                        <option value="5√®me" ${classe.niveau === '5√®me' ? 'selected' : ''}>5√®me</option>
                                        <option value="4√®me" ${classe.niveau === '4√®me' ? 'selected' : ''}>4√®me</option>
                                        <option value="3√®me" ${classe.niveau === '3√®me' ? 'selected' : ''}>3√®me</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Professeur principal</label>
                                    <select class="form-control" id="modifClasseProfPrincipal">
                                        <option value="">Non attribu√©</option>
                                        ${SCOLARIS_DATA.utilisateurs
                                            .filter(u => u.role === 'enseignant' && u.actif)
                                            .map(prof => `<option value="${prof.id}" ${classe.prof_principal_id === prof.id ? 'selected' : ''}>
                                                ${prof.prenom} ${prof.nom}
                                            </option>`).join('')}
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Effectif maximum</label>
                                    <input type="number" class="form-control" id="modifClasseEffectifMax" 
                                           value="${classe.effectif_max || 30}" min="1" max="35">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Salle attribu√©e</label>
                                    <input type="text" class="form-control" id="modifClasseSalle" value="${classe.salle || ''}">
                                </div>
                                <div class="form-group">
                                    <label>Heure de rentr√©e</label>
                                    <input type="time" class="form-control" id="modifClasseHeureRentree" 
                                           value="${classe.heure_rentree || '08:30'}">
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="fermerModal()">Annuler</button>
                        <button class="btn btn-primary" onclick="sauvegarderModificationClasse('${classeId}')">
                            <i class="fas fa-save"></i> Enregistrer
                        </button>
                    </div>
                </div>
            `;
            
            ouvrirModal(modalHtml);
        }
        
        function sauvegarderModificationClasse(classeId) {
            const classeIndex = SCOLARIS_DATA.classes.findIndex(c => c.id === classeId);
            if (classeIndex === -1) return;
            
            const classe = SCOLARIS_DATA.classes[classeIndex];
            const ancienNom = classe.nom;
            const nouveauNom = document.getElementById('modifClasseNom').value;
            
            classe.nom = nouveauNom;
            classe.niveau = document.getElementById('modifClasseNiveau').value;
            classe.effectif_max = parseInt(document.getElementById('modifClasseEffectifMax').value);
            classe.salle = document.getElementById('modifClasseSalle').value;
            classe.heure_rentree = document.getElementById('modifClasseHeureRentree').value;
            
            const profId = document.getElementById('modifClasseProfPrincipal').value;
            classe.prof_principal_id = profId ? parseInt(profId) : null;
            
            if (profId) {
                const prof = SCOLARIS_DATA.utilisateurs.find(u => u.id === parseInt(profId));
                classe.prof_principal = prof ? prof.prenom + ' ' + prof.nom : 'Non attribu√©';
            } else {
                classe.prof_principal = 'Non attribu√©';
            }
            
            // Mettre √† jour le nom de la classe dans les √©l√®ves
            SCOLARIS_DATA.eleves.forEach(eleve => {
                if (eleve.classe_id === classeId) {
                    eleve.classe = nouveauNom;
                }
            });
            
            sauvegarderDonnees();
            alert('Classe modifi√©e avec succ√®s !');
            fermerModal();
            afficherGestionClasses();
        }
        
        function supprimerClasse(classeId) {
            if (!confirm('√ätes-vous s√ªr de vouloir supprimer cette classe ? Cette action est irr√©versible.')) {
                return;
            }
            
            // V√©rifier si la classe contient des √©l√®ves
            const elevesDansClasse = SCOLARIS_DATA.eleves.filter(e => e.classe_id === classeId);
            
            if (elevesDansClasse.length > 0) {
                if (!confirm(`Cette classe contient ${elevesDansClasse.length} √©l√®ve(s). Voulez-vous vraiment la supprimer ? Les √©l√®ves seront √©galement supprim√©s.`)) {
                    return;
                }
                
                // Supprimer les √©l√®ves de cette classe
                SCOLARIS_DATA.eleves = SCOLARIS_DATA.eleves.filter(e => e.classe_id !== classeId);
                
                // Supprimer les comptes utilisateurs associ√©s
                SCOLARIS_DATA.utilisateurs = SCOLARIS_DATA.utilisateurs.filter(u => 
                    !u.eleve_id || !elevesDansClasse.find(e => e.id === u.eleve_id)
                );
            }
            
            // Supprimer la classe
            SCOLARIS_DATA.classes = SCOLARIS_DATA.classes.filter(c => c.id !== classeId);
            sauvegarderDonnees();
            
            alert('Classe supprim√©e avec succ√®s !');
            afficherGestionClasses();
        }
        
        // ============================================
        // GESTION DES MATI√àRES (COMPL√àTE)
        // ============================================
        
        function afficherGestionMatieres() {
            document.getElementById('contenuPrincipal').innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h1 style="color: var(--couleur-principale);">Gestion des mati√®res</h1>
                    <button class="btn btn-primary" onclick="ouvrirModalNouvelleMatiere()">
                        <i class="fas fa-plus"></i> Nouvelle mati√®re
                    </button>
                </div>
                
                <div class="cards-container" style="margin-bottom: 30px;">
                    <div class="card">
                        <div class="card-title">Mati√®res enseign√©es</div>
                        <div class="card-value">${SCOLARIS_DATA.matieres.length}</div>
                        <div class="card-subtitle">Total de l'√©tablissement</div>
                    </div>
                    <div class="card">
                        <div class="card-title">Coefficient moyen</div>
                        <div class="card-value">${(SCOLARIS_DATA.matieres.reduce((sum, m) => sum + (m.coefficient || 1), 0) / SCOLARIS_DATA.matieres.length).toFixed(1)}</div>
                        <div class="card-subtitle">Moyenne par mati√®re</div>
                    </div>
                    <div class="card">
                        <div class="card-title">Enseignants par mati√®re</div>
                        <div class="card-value">${SCOLARIS_DATA.utilisateurs.filter(u => u.role === 'enseignant').length}</div>
                        <div class="card-subtitle">Personnel enseignant</div>
                    </div>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">Liste des mati√®res</div>
                        <button class="btn btn-secondary btn-small" onclick="exporterMatieres()">
                            <i class="fas fa-file-export"></i> Exporter
                        </button>
                    </div>
                    <div class="table-content">
                        <table>
                            <thead>
                                <tr>
                                    <th>Mati√®re</th>
                                    <th>Coefficient</th>
                                    <th>Couleur</th>
                                    <th>Enseignants</th>
                                    <th>Heures/semaine</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${SCOLARIS_DATA.matieres.map(matiere => {
                                    const enseignants = SCOLARIS_DATA.utilisateurs
                                        .filter(u => u.role === 'enseignant' && u.matieres && u.matieres.includes(matiere.id))
                                        .map(u => u.prenom + ' ' + u.nom);
                                    
                                    return `
                                        <tr>
                                            <td><strong>${matiere.nom}</strong></td>
                                            <td>${matiere.coefficient || 1}</td>
                                            <td>
                                                <div style="display: flex; align-items: center; gap: 10px;">
                                                    <div style="width: 20px; height: 20px; background-color: ${matiere.couleur || '#3498DB'}; border-radius: 4px;"></div>
                                                    ${matiere.couleur || '#3498DB'}
                                                </div>
                                            </td>
                                            <td>${enseignants.length > 0 ? enseignants.join(', ') : 'Non attribu√©'}</td>
                                            <td>${matiere.heures_semaine || 4}h</td>
                                            <td>
                                                <div style="display: flex; gap: 5px;">
                                                    <button class="btn btn-secondary btn-small" onclick="modifierMatiere(${matiere.id})">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    ${matiere.id > 10 ? `
                                                    <button class="btn btn-danger btn-small" onclick="supprimerMatiere(${matiere.id})">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                    ` : ''}
                                                </div>
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            setActiveMenu('matieres');
        }
        
        function ouvrirModalNouvelleMatiere() {
            const modalHtml = `
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">üìö Ajouter une nouvelle mati√®re</div>
                        <button class="modal-close" onclick="fermerModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <form id="formNouvelleMatiere">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nom de la mati√®re *</label>
                                    <input type="text" class="form-control" id="matiereNom" required>
                                </div>
                                <div class="form-group">
                                    <label>Coefficient *</label>
                                    <select class="form-control" id="matiereCoefficient" required>
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3" selected>3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Couleur *</label>
                                    <input type="color" class="form-control" id="matiereCouleur" value="#3498DB" required style="height: 40px;">
                                </div>
                                <div class="form-group">
                                    <label>Heures par semaine</label>
                                    <input type="number" class="form-control" id="matiereHeures" value="4" min="1" max="10">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Niveaux concern√©s</label>
                                    <div style="display: flex; gap: 15px; margin-top: 8px;">
                                        <label><input type="checkbox" value="6√®me" checked> 6√®me</label>
                                        <label><input type="checkbox" value="5√®me" checked> 5√®me</label>
                                        <label><input type="checkbox" value="4√®me" checked> 4√®me</label>
                                        <label><input type="checkbox" value="3√®me" checked> 3√®me</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Description</label>
                                    <textarea class="form-control" id="matiereDescription" rows="3"></textarea>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="fermerModal()">Annuler</button>
                        <button class="btn btn-primary" onclick="creerNouvelleMatiere()">
                            <i class="fas fa-save"></i> Cr√©er la mati√®re
                        </button>
                    </div>
                </div>
            `;
            
            ouvrirModal(modalHtml);
        }
        
        function creerNouvelleMatiere() {
            const nom = document.getElementById('matiereNom').value;
            const coefficient = parseInt(document.getElementById('matiereCoefficient').value);
            const couleur = document.getElementById('matiereCouleur').value;
            const heures = parseInt(document.getElementById('matiereHeures').value);
            const description = document.getElementById('matiereDescription').value;
            
            if (!nom) {
                alert('Veuillez remplir le nom de la mati√®re');
                return;
            }
            
            // V√©rifier si la mati√®re existe d√©j√†
            if (SCOLARIS_DATA.matieres.find(m => m.nom.toLowerCase() === nom.toLowerCase())) {
                alert('Une mati√®re avec ce nom existe d√©j√†');
                return;
            }
            
            const nouvelId = Math.max(...SCOLARIS_DATA.matieres.map(m => m.id), 0) + 1;
            const nouvelleMatiere = {
                id: nouvelId,
                nom: nom,
                coefficient: coefficient,
                couleur: couleur,
                heures_semaine: heures,
                description: description,
                created_at: new Date().toISOString().split('T')[0]
            };
            
            SCOLARIS_DATA.matieres.push(nouvelleMatiere);
            sauvegarderDonnees();
            
            alert('Mati√®re cr√©√©e avec succ√®s !');
            fermerModal();
            afficherGestionMatieres();
        }
        
        function modifierMatiere(matiereId) {
            const matiere = SCOLARIS_DATA.matieres.find(m => m.id === matiereId);
            if (!matiere) return;
            
            const modalHtml = `
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">‚úèÔ∏è Modifier la mati√®re : ${matiere.nom}</div>
                        <button class="modal-close" onclick="fermerModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <form id="formModifierMatiere">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nom de la mati√®re *</label>
                                    <input type="text" class="form-control" id="modifMatiereNom" value="${matiere.nom}" required>
                                </div>
                                <div class="form-group">
                                    <label>Coefficient *</label>
                                    <select class="form-control" id="modifMatiereCoefficient" required>
                                        <option value="1" ${matiere.coefficient === 1 ? 'selected' : ''}>1</option>
                                        <option value="2" ${matiere.coefficient === 2 ? 'selected' : ''}>2</option>
                                        <option value="3" ${matiere.coefficient === 3 ? 'selected' : ''}>3</option>
                                        <option value="4" ${matiere.coefficient === 4 ? 'selected' : ''}>4</option>
                                        <option value="5" ${matiere.coefficient === 5 ? 'selected' : ''}>5</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Couleur *</label>
                                    <input type="color" class="form-control" id="modifMatiereCouleur" 
                                           value="${matiere.couleur || '#3498DB'}" required style="height: 40px;">
                                </div>
                                <div class="form-group">
                                    <label>Heures par semaine</label>
                                    <input type="number" class="form-control" id="modifMatiereHeures" 
                                           value="${matiere.heures_semaine || 4}" min="1" max="10">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Description</label>
                                    <textarea class="form-control" id="modifMatiereDescription" rows="3">${matiere.description || ''}</textarea>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="fermerModal()">Annuler</button>
                        <button class="btn btn-primary" onclick="sauvegarderModificationMatiere(${matiereId})">
                            <i class="fas fa-save"></i> Enregistrer
                        </button>
                    </div>
                </div>
            `;
            
            ouvrirModal(modalHtml);
        }
        
        function sauvegarderModificationMatiere(matiereId) {
            const matiereIndex = SCOLARIS_DATA.matieres.findIndex(m => m.id === matiereId);
            if (matiereIndex === -1) return;
            
            const matiere = SCOLARIS_DATA.matieres[matiereIndex];
            
            matiere.nom = document.getElementById('modifMatiereNom').value;
            matiere.coefficient = parseInt(document.getElementById('modifMatiereCoefficient').value);
            matiere.couleur = document.getElementById('modifMatiereCouleur').value;
            matiere.heures_semaine = parseInt(document.getElementById('modifMatiereHeures').value);
            matiere.description = document.getElementById('modifMatiereDescription').value;
            
            sauvegarderDonnees();
            alert('Mati√®re modifi√©e avec succ√®s !');
            fermerModal();
            afficherGestionMatieres();
        }
        
        function supprimerMatiere(matiereId) {
            if (matiereId <= 10) {
                alert('Les mati√®res de base ne peuvent pas √™tre supprim√©es');
                return;
            }
            
            if (!confirm('√ätes-vous s√ªr de vouloir supprimer cette mati√®re ?')) {
                return;
            }
            
            SCOLARIS_DATA.matieres = SCOLARIS_DATA.matieres.filter(m => m.id !== matiereId);
            sauvegarderDonnees();
            
            alert('Mati√®re supprim√©e avec succ√®s !');
            afficherGestionMatieres();
        }
        
        // ============================================
        // PARAM√àTRES (COMPL√àTE)
        // ============================================
        
        function afficherParametres() {
            const config = SCOLARIS_DATA.system.config || {};
            const etablissement = SCOLARIS_DATA.system.etablissement;
            
            document.getElementById('contenuPrincipal').innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h1 style="color: var(--couleur-principale);">Param√®tres du syst√®me</h1>
                    <button class="btn btn-primary" onclick="sauvegarderParametres()">
                        <i class="fas fa-save"></i> Enregistrer tous les param√®tres
                    </button>
                </div>
                
                <div class="tabs">
                    <div class="tab active" onclick="changerOngletParametres('etablissement')">√âtablissement</div>
                    <div class="tab" onclick="changerOngletParametres('systeme')">Syst√®me</div>
                    <div class="tab" onclick="changerOngletParametres('securite')">S√©curit√©</div>
                    <div class="tab" onclick="changerOngletParametres('sauvegarde')">Sauvegarde</div>
                    <div class="tab" onclick="changerOngletParametres('import')">Import/Export</div>
                </div>
                
                <div id="contenuParametres">
                    <div class="form-container">
                        <h3 class="form-title">Informations de l'√©tablissement</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Nom de l'√©tablissement *</label>
                                <input type="text" class="form-control" id="paramEtablissementNom" 
                                       value="${etablissement.nom}" required>
                            </div>
                            <div class="form-group">
                                <label>Type d'√©tablissement *</label>
                                <select class="form-control" id="paramEtablissementType" required>
                                    <option value="Coll√®ge public" ${etablissement.type === 'Coll√®ge public' ? 'selected' : ''}>Coll√®ge public</option>
                                    <option value="Coll√®ge priv√©" ${etablissement.type === 'Coll√®ge priv√©' ? 'selected' : ''}>Coll√®ge priv√©</option>
                                    <option value="Lyc√©e g√©n√©ral" ${etablissement.type === 'Lyc√©e g√©n√©ral' ? 'selected' : ''}>Lyc√©e g√©n√©ral</option>
                                    <option value="Lyc√©e professionnel" ${etablissement.type === 'Lyc√©e professionnel' ? 'selected' : ''}>Lyc√©e professionnel</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Adresse *</label>
                                <input type="text" class="form-control" id="paramEtablissementAdresse" 
                                       value="${etablissement.adresse}" required>
                            </div>
                            <div class="form-group">
                                <label>Ville *</label>
                                <input type="text" class="form-control" id="paramEtablissementVille" 
                                       value="${etablissement.ville}" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>T√©l√©phone</label>
                                <input type="text" class="form-control" id="paramEtablissementTelephone" 
                                       value="${etablissement.telephone || ''}">
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" class="form-control" id="paramEtablissementEmail" 
                                       value="${etablissement.email || ''}">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Ann√©e scolaire *</label>
                                <input type="text" class="form-control" id="paramEtablissementAnnee" 
                                       value="${etablissement.annee_scolaire}" required>
                            </div>
                            <div class="form-group">
                                <label>Directeur</label>
                                <input type="text" class="form-control" id="paramEtablissementDirecteur" 
                                       value="${etablissement.directeur || ''}">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-container">
                        <h3 class="form-title">Configuration du syst√®me</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Th√®me de l'interface</label>
                                <select class="form-control" id="paramTheme">
                                    <option value="default" ${config.theme === 'default' ? 'selected' : ''}>Par d√©faut (Bleu)</option>
                                    <option value="dark" ${config.theme === 'dark' ? 'selected' : ''}>Sombre</option>
                                    <option value="green" ${config.theme === 'green' ? 'selected' : ''}>Vert</option>
                                    <option value="red" ${config.theme === 'red' ? 'selected' : ''}>Rouge</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Langue</label>
                                <select class="form-control" id="paramLangue">
                                    <option value="fr" selected>Fran√ßais</option>
                                    <option value="en">English</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Format des dates</label>
                                <select class="form-control" id="paramFormatDate">
                                    <option value="fr" selected>JJ/MM/AAAA</option>
                                    <option value="en">AAAA-MM-JJ</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Fuseau horaire</label>
                                <select class="form-control" id="paramFuseauHoraire">
                                    <option value="Europe/Paris" selected>Europe/Paris</option>
                                    <option value="UTC">UTC</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="paramNotifications" ${config.notifications ? 'checked' : ''}>
                                    Activer les notifications
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="paramExportAuto" ${config.export_auto ? 'checked' : ''}>
                                    Export automatique des donn√©es
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-container">
                        <h3 class="form-title">S√©curit√©</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Dur√©e de session (minutes)</label>
                                <input type="number" class="form-control" id="paramDureeSession" 
                                       value="${config.duree_session || 30}" min="5" max="240">
                            </div>
                            <div class="form-group">
                                <label>Complexit√© des mots de passe</label>
                                <select class="form-control" id="paramComplexitePassword">
                                    <option value="faible" ${config.complexite_password === 'faible' ? 'selected' : ''}>Faible (6 caract√®res)</option>
                                    <option value="moyenne" ${config.complexite_password === 'moyenne' || !config.complexite_password ? 'selected' : ''}>Moyenne (8 caract√®res, majuscule, chiffre)</option>
                                    <option value="forte" ${config.complexite_password === 'forte' ? 'selected' : ''}>Forte (12 caract√®res, complexe)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="paramForceChangementPassword" ${config.force_changement_password ? 'checked' : ''}>
                                    Forcer le changement de mot de passe au premier login
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="paramConnexionDouble" ${config.connexion_double ? 'checked' : ''}>
                                    Double authentification pour les administrateurs
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-container">
                        <h3 class="form-title">Sauvegarde et maintenance</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Fr√©quence de sauvegarde automatique</label>
                                <select class="form-control" id="paramFrequenceSauvegarde">
                                    <option value="journaliere" ${config.frequence_sauvegarde === 'journaliere' ? 'selected' : ''}>Quotidienne</option>
                                    <option value="hebdomadaire" ${config.frequence_sauvegarde === 'hebdomadaire' || !config.frequence_sauvegarde ? 'selected' : ''}>Hebdomadaire</option>
                                    <option value="mensuelle" ${config.frequence_sauvegarde === 'mensuelle' ? 'selected' : ''}>Mensuelle</option>
                                    <option value="aucune" ${config.frequence_sauvegarde === 'aucune' ? 'selected' : ''}>Aucune</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Conserver les donn√©es pendant</label>
                                <select class="form-control" id="paramConservationDonnees">
                                    <option value="1" ${config.conservation_donnees === '1' ? 'selected' : ''}>1 an</option>
                                    <option value="3" ${config.conservation_donnees === '3' || !config.conservation_donnees ? 'selected' : ''}>3 ans</option>
                                    <option value="5" ${config.conservation_donnees === '5' ? 'selected' : ''}>5 ans</option>
                                    <option value="indefinie" ${config.conservation_donnees === 'indefinie' ? 'selected' : ''}>Ind√©finiment</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <button class="btn btn-primary" onclick="sauvegarderDonneesLocal()">
                                <i class="fas fa-download"></i> Sauvegarder maintenant
                            </button>
                            <button class="btn btn-secondary" onclick="restaurerSauvegarde()" style="margin-left: 10px;">
                                <i class="fas fa-upload"></i> Restaurer une sauvegarde
                            </button>
                            <button class="btn btn-danger" onclick="reinitialiserDonnees()" style="margin-left: 10px;">
                                <i class="fas fa-trash"></i> R√©initialiser les donn√©es
                            </button>
                        </div>
                        
                        <div style="margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 6px;">
                            <h4 style="color: var(--couleur-principale); margin-bottom: 10px;">
                                <i class="fas fa-info-circle"></i> Informations syst√®me
                            </h4>
                            <p><strong>Version :</strong> ${SCOLARIS_DATA.system.version}</p>
                            <p><strong>Derni√®re sauvegarde :</strong> ${config.derniere_sauvegarde ? formatDate(config.derniere_sauvegarde) : 'Jamais'}</p>
                            <p><strong>Taille des donn√©es :</strong> ${Math.round(JSON.stringify(SCOLARIS_DATA).length / 1024)} Ko</p>
                            <p><strong>Utilisateurs actifs :</strong> ${SCOLARIS_DATA.utilisateurs.filter(u => u.actif).length}</p>
                        </div>
                    </div>
                </div>
                
                <div class="mention-legale">
                    <i class="fas fa-exclamation-circle"></i>
                    Les modifications sont sauvegard√©es automatiquement dans votre navigateur.
                </div>
            `;
            
            setActiveMenu('parametres');
        }
        
        function sauvegarderParametres() {
            // Mettre √† jour les informations de l'√©tablissement
            SCOLARIS_DATA.system.etablissement.nom = document.getElementById('paramEtablissementNom').value;
            SCOLARIS_DATA.system.etablissement.type = document.getElementById('paramEtablissementType').value;
            SCOLARIS_DATA.system.etablissement.adresse = document.getElementById('paramEtablissementAdresse').value;
            SCOLARIS_DATA.system.etablissement.ville = document.getElementById('paramEtablissementVille').value;
            SCOLARIS_DATA.system.etablissement.telephone = document.getElementById('paramEtablissementTelephone').value;
            SCOLARIS_DATA.system.etablissement.email = document.getElementById('paramEtablissementEmail').value;
            SCOLARIS_DATA.system.etablissement.annee_scolaire = document.getElementById('paramEtablissementAnnee').value;
            SCOLARIS_DATA.system.etablissement.directeur = document.getElementById('paramEtablissementDirecteur').value;
            
            // Mettre √† jour la configuration
            SCOLARIS_DATA.system.config = {
                theme: document.getElementById('paramTheme').value,
                notifications: document.getElementById('paramNotifications').checked,
                export_auto: document.getElementById('paramExportAuto').checked,
                duree_session: parseInt(document.getElementById('paramDureeSession').value),
                complexite_password: document.getElementById('paramComplexitePassword').value,
                force_changement_password: document.getElementById('paramForceChangementPassword').checked,
                connexion_double: document.getElementById('paramConnexionDouble').checked,
                frequence_sauvegarde: document.getElementById('paramFrequenceSauvegarde').value,
                conservation_donnees: document.getElementById('paramConservationDonnees').value,
                derniere_sauvegarde: new Date().toISOString().split('T')[0]
            };
            
            sauvegarderDonnees();
            alert('Param√®tres enregistr√©s avec succ√®s !');
            
            // Mettre √† jour l'affichage de l'√©tablissement
            afficherInformationsEtablissement();
        }
        
        function sauvegarderDonneesLocal() {
            const dataStr = JSON.stringify(SCOLARIS_DATA, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `scolaris_sauvegarde_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            alert('Sauvegarde t√©l√©charg√©e avec succ√®s !');
        }
        
        function restaurerSauvegarde() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(event) {
                const file = event.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        const donnees = JSON.parse(e.target.result);
                        
                        if (!donnees.system || !donnees.utilisateurs) {
                            throw new Error('Format de fichier invalide');
                        }
                        
                        if (confirm('Voulez-vous vraiment restaurer cette sauvegarde ? Toutes les donn√©es actuelles seront perdues.')) {
                            localStorage.setItem('SCOLARIS_DATA', JSON.stringify(donnees));
                            alert('Sauvegarde restaur√©e avec succ√®s ! Red√©marrage n√©cessaire.');
                            location.reload();
                        }
                    } catch (error) {
                        alert('Erreur : Le fichier n\'est pas une sauvegarde valide de SCOLARIS');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        function reinitialiserDonnees() {
            if (!confirm('ATTENTION : Cette action supprimera TOUTES les donn√©es (utilisateurs, √©l√®ves, classes, notes, etc.) et r√©initialisera le syst√®me. Cette action est irr√©versible. Continuer ?')) {
                return;
            }
            
            if (!confirm('√ätes-vous ABSOLUMENT s√ªr ? Toutes vos donn√©es seront perdues.')) {
                return;
            }
            
            // Garder seulement l'administrateur principal
            const admin = SCOLARIS_DATA.utilisateurs.find(u => u.id === 1);
            const etablissement = SCOLARIS_DATA.system.etablissement;
            
            SCOLARIS_DATA = {
                system: {
                    nom: "SCOLARIS",
                    version: "5.0.0",
                    etablissement: etablissement,
                    config: SCOLARIS_DATA.system.config || {}
                },
                
                utilisateurs: [admin],
                roles: SCOLARIS_DATA.roles,
                classes: [],
                eleves: [],
                matieres: SCOLARIS_DATA.matieres,
                notes: [],
                absences: [],
                retards: [],
                devoirs: [],
                emploi_du_temps: [],
                messages: [],
                documents: []
            };
            
            sauvegarderDonnees();
            alert('Donn√©es r√©initialis√©es avec succ√®s !');
            location.reload();
        }
        
        // ============================================
        // FONCTIONS DE PLACEHOLDER POUR LES AUTRES MODULES
        // ============================================
        
        function afficherGestionNotes() {
            document.getElementById('contenuPrincipal').innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h1 style="color: var(--couleur-principale);">Gestion des notes</h1>
                    <button class="btn btn-primary" onclick="ouvrirModalSaisieNotes()">
                        <i class="fas fa-plus"></i> Saisir des notes
                    </button>
                </div>
                
                <div class="form-container">
                    <h3 class="form-title">Module de gestion des notes</h3>
                    <p>Ce module permet la saisie, la consultation et l'export des notes des √©l√®ves.</p>
                    
                    <div style="margin-top: 20px;">
                        <h4 style="color: var(--couleur-principale); margin-bottom: 15px;">Fonctionnalit√©s disponibles :</h4>
                        <ul style="color: #666; line-height: 1.6;">
                            <li>Saisie des notes par classe et mati√®re</li>
                            <li>Calcul automatique des moyennes</li>
                            <li>G√©n√©ration des bulletins scolaires</li>
                            <li>Export des relev√©s de notes</li>
                            <li>Statistiques par mati√®re et par classe</li>
                        </ul>
                    </div>
                    
                    <div style="margin-top: 30px; text-align: center;">
                        <button class="btn btn-primary" onclick="ouvrirModalSaisieNotes()">
                            <i class="fas fa-play"></i> Commencer la saisie des notes
                        </button>
                    </div>
                </div>
            `;
            
            setActiveMenu('notes');
        }
        
        function ouvrirModalSaisieNotes() {
            const modalHtml = `
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">üìù Saisie des notes</div>
                        <button class="modal-close" onclick="fermerModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <div style="text-align: center; padding: 30px;">
                            <i class="fas fa-graduation-cap" style="font-size: 3rem; color: #ddd; margin-bottom: 20px;"></i>
                            <h3 style="color: #666; margin-bottom: 15px;">Module en d√©veloppement</h3>
                            <p style="color: #888;">La saisie des notes sera disponible dans la prochaine version.</p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="fermerModal()">Fermer</button>
                    </div>
                </div>
            `;
            
            ouvrirModal(modalHtml);
        }
        
        function afficherGestionAbsences() {
            document.getElementById('contenuPrincipal').innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h1 style="color: var(--couleur-principale);">Gestion des absences</h1>
                    <button class="btn btn-primary" onclick="ouvrirModalNouvelleAbsence()">
                        <i class="fas fa-user-times"></i> D√©clarer une absence
                    </button>
                </div>
                
                <div class="cards-container" style="margin-bottom: 30px;">
                    <div class="card">
                        <div class="card-title">Absences aujourd'hui</div>
                        <div class="card-value">${SCOLARIS_DATA.absences.filter(a => a.date === new Date().toISOString().split('T')[0]).length}</div>
                        <div class="card-subtitle">√âl√®ves absents</div>
                    </div>
                    <div class="card">
                        <div class="card-title">Taux d'absent√©isme</div>
                        <div class="card-value">3.2%</div>
                        <div class="card-subtitle">Moyenne cette semaine</div>
                    </div>
                    <div class="card">
                        <div class="card-title">Retards ce mois</div>
                        <div class="card-value">${SCOLARIS_DATA.retards.length}</div>
                        <div class="card-subtitle">Retards enregistr√©s</div>
                    </div>
                </div>
                
                <div class="form-container">
                    <h3 class="form-title">Module de gestion des absences</h3>
                    <p>Ce module permet la d√©claration, le suivi et l'export des absences et retards.</p>
                    
                    <div style="margin-top: 20px;">
                        <h4 style="color: var(--couleur-principale); margin-bottom: 15px;">Statistiques :</h4>
                        <div class="table-content">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Classe</th>
                                        <th>Absences</th>
                                        <th>Retards</th>
                                        <th>Taux</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${SCOLARIS_DATA.classes.map(classe => {
                                        const elevesClasse = SCOLARIS_DATA.eleves.filter(e => e.classe_id === classe.id);
                                        const absencesClasse = SCOLARIS_DATA.absences.filter(a => 
                                            elevesClasse.find(e => e.id === a.eleve_id)
                                        ).length;
                                        
                                        return `
                                            <tr>
                                                <td>${classe.nom}</td>
                                                <td>${absencesClasse}</td>
                                                <td>${SCOLARIS_DATA.retards.filter(r => 
                                                    elevesClasse.find(e => e.id === r.eleve_id)
                                                ).length}</td>
                                                <td>${elevesClasse.length > 0 ? ((absencesClasse / elevesClasse.length) * 100).toFixed(1) : 0}%</td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
            
            setActiveMenu('absences');
        }
        
        function afficherEmploiDuTemps() {
            document.getElementById('contenuPrincipal').innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h1 style="color: var(--couleur-principale);">Emploi du temps</h1>
                    <button class="btn btn-primary" onclick="genererEmploiDuTemps()">
                        <i class="fas fa-calendar-plus"></i> G√©n√©rer un emploi du temps
                    </button>
                </div>
                
                <div class="form-container">
                    <h3 class="form-title">Module d'emploi du temps</h3>
                    <p>Ce module permet la cr√©ation, la modification et la consultation des emplois du temps.</p>
                    
                    <div style="margin-top: 20px;">
                        <h4 style="color: var(--couleur-principale); margin-bottom: 15px;">Fonctionnalit√©s :</h4>
                        <ul style="color: #666; line-height: 1.6;">
                            <li>Cr√©ation d'emplois du temps par classe</li>
                            <li>Affectation des enseignants aux cr√©neaux</li>
                            <li>Gestion des salles de classe</li>
                            <li>Export PDF des emplois du temps</li>
                            <li>Consultation par les √©l√®ves et parents</li>
                        </ul>
                    </div>
                    
                    <div style="margin-top: 30px; text-align: center;">
                        <button class="btn btn-primary" onclick="genererEmploiDuTemps()">
                            <i class="fas fa-magic"></i> G√©n√©rer automatiquement
                        </button>
                    </div>
                </div>
            `;
            
            setActiveMenu('emploi_temps');
        }
        
        // ============================================
        // FONCTIONS AUXILIAIRES
        // ============================================
        
        function changerOngletUtilisateurs(tab) {
            // Impl√©mentation des onglets utilisateurs
        }
        
        function changerOngletParametres(tab) {
            // Impl√©mentation des onglets param√®tres
        }
        
        function rechercherEleves(term) {
            // Impl√©mentation de la recherche
        }
        
        function filtrerElevesParClasse(classeId) {
            // Impl√©mentation du filtrage
        }
        
        function exporterUtilisateurs() {
            alert('Export des utilisateurs au format CSV (simulation)');
        }
        
        function exporterEnseignants() {
            alert('Export des enseignants au format CSV (simulation)');
        }
        
        function exporterEleves() {
            alert('Export des √©l√®ves au format CSV (simulation)');
        }
        
        function exporterClasses() {
            alert('Export des classes au format CSV (simulation)');
        }
        
        function exporterMatieres() {
            alert('Export des mati√®res au format CSV (simulation)');
        }
        
        function genererEmploiDuTemps() {
            alert('G√©n√©ration automatique de l\'emploi du temps (simulation)');
        }
        
        function genererListeClasse(classeId) {
            alert('G√©n√©ration de la liste de classe au format PDF (simulation)');
        }
        
        function genererFicheElevePDF(eleveId) {
            alert('G√©n√©ration de la fiche √©l√®ve au format PDF (simulation)');
        }
        
        function voirNotesEleve(eleveId) {
            alert('Affichage des notes de l\'√©l√®ve (simulation)');
        }
        
        function affecterElevesClasse(classeId) {
            alert('Affectation d\'√©l√®ves √† la classe (simulation)');
        }
        
        function importerEleves() {
            alert('Import d\'√©l√®ves depuis un fichier CSV (simulation)');
        }
        
        function ouvrirModalNouvelleAbsence() {
            alert('Ouverture du formulaire de d√©claration d\'absence (simulation)');
        }
    </script>
</body>
</html>
